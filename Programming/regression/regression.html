<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Regression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="regression_files/libs/clipboard/clipboard.min.js"></script>
<script src="regression_files/libs/quarto-html/quarto.js"></script>
<script src="regression_files/libs/quarto-html/popper.min.js"></script>
<script src="regression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="regression_files/libs/quarto-html/anchor.min.js"></script>
<link href="regression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="regression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="regression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="regression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="regression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="regression_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="regression_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="regression_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link active" data-scroll-target="#simple-linear-regression">Simple Linear Regression</a>
  <ul class="collapse">
  <li><a href="#exploring-data" id="toc-exploring-data" class="nav-link" data-scroll-target="#exploring-data">1. exploring data</a></li>
  <li><a href="#fit-simple-regression" id="toc-fit-simple-regression" class="nav-link" data-scroll-target="#fit-simple-regression">2. fit simple regression</a></li>
  <li><a href="#การแปลความหมายพารามเตอรในโมเดล" id="toc-การแปลความหมายพารามเตอรในโมเดล" class="nav-link" data-scroll-target="#การแปลความหมายพารามเตอรในโมเดล">3. การแปลความหมายพารามิเตอร์ในโมเดล</a></li>
  </ul></li>
  <li><a href="#multiple-regression" id="toc-multiple-regression" class="nav-link" data-scroll-target="#multiple-regression">Multiple Regression</a></li>
  <li><a href="#regression-with-interaction" id="toc-regression-with-interaction" class="nav-link" data-scroll-target="#regression-with-interaction">Regression with Interaction</a>
  <ul class="collapse">
  <li><a href="#two-way-interaction-effect" id="toc-two-way-interaction-effect" class="nav-link" data-scroll-target="#two-way-interaction-effect">Two-way interaction effect</a></li>
  </ul></li>
  <li><a href="#polynomial-regression" id="toc-polynomial-regression" class="nav-link" data-scroll-target="#polynomial-regression">Polynomial Regression</a>
  <ul class="collapse">
  <li><a href="#ปญหา-multicollinearity-ใน-polynomial-regression" id="toc-ปญหา-multicollinearity-ใน-polynomial-regression" class="nav-link" data-scroll-target="#ปญหา-multicollinearity-ใน-polynomial-regression">ปัญหา Multicollinearity ใน Polynomial Regression</a></li>
  </ul></li>
  <li><a href="#regression-diagnostics" id="toc-regression-diagnostics" class="nav-link" data-scroll-target="#regression-diagnostics">Regression Diagnostics</a>
  <ul class="collapse">
  <li><a href="#linearity" id="toc-linearity" class="nav-link" data-scroll-target="#linearity">Linearity</a></li>
  <li><a href="#normality" id="toc-normality" class="nav-link" data-scroll-target="#normality">Normality</a></li>
  <li><a href="#homogeneity-of-variance" id="toc-homogeneity-of-variance" class="nav-link" data-scroll-target="#homogeneity-of-variance">homogeneity of variance</a></li>
  <li><a href="#homoscedasticity" id="toc-homoscedasticity" class="nav-link" data-scroll-target="#homoscedasticity">homoscedasticity</a></li>
  <li><a href="#no-multicollinearity" id="toc-no-multicollinearity" class="nav-link" data-scroll-target="#no-multicollinearity">No Multicollinearity</a></li>
  <li><a href="#no-influential-outliers" id="toc-no-influential-outliers" class="nav-link" data-scroll-target="#no-influential-outliers">No influential outliers</a></li>
  <li><a href="#กจกรรมตรวจสอบขอตกลงเบองตน" id="toc-กจกรรมตรวจสอบขอตกลงเบองตน" class="nav-link" data-scroll-target="#กจกรรมตรวจสอบขอตกลงเบองตน">กิจกรรมตรวจสอบข้อตกลงเบื้องต้น</a></li>
  </ul></li>
  <li><a href="#regression-remedials" id="toc-regression-remedials" class="nav-link" data-scroll-target="#regression-remedials">Regression Remedials</a>
  <ul class="collapse">
  <li><a href="#linearity-2" id="toc-linearity-2" class="nav-link" data-scroll-target="#linearity-2">Linearity</a></li>
  <li><a href="#normality-1" id="toc-normality-1" class="nav-link" data-scroll-target="#normality-1">Normality</a></li>
  <li><a href="#homoscedasticity-1" id="toc-homoscedasticity-1" class="nav-link" data-scroll-target="#homoscedasticity-1">Homoscedasticity</a></li>
  <li><a href="#multicollinearity" id="toc-multicollinearity" class="nav-link" data-scroll-target="#multicollinearity">Multicollinearity</a></li>
  <li><a href="#no-influential-ouliers" id="toc-no-influential-ouliers" class="nav-link" data-scroll-target="#no-influential-ouliers">No Influential Ouliers</a></li>
  </ul></li>
  <li><a href="#model-selection" id="toc-model-selection" class="nav-link" data-scroll-target="#model-selection">Model Selection</a>
  <ul class="collapse">
  <li><a href="#กจกรรมท-1-ทำลองวเคราะหการถดถอย" id="toc-กจกรรมท-1-ทำลองวเคราะหการถดถอย" class="nav-link" data-scroll-target="#กจกรรมท-1-ทำลองวเคราะหการถดถอย">กิจกรรมที่ 1 ทำลองวิเคราะห์การถดถอย</a></li>
  <li><a href="#filter-methods" id="toc-filter-methods" class="nav-link" data-scroll-target="#filter-methods">Filter Methods</a></li>
  <li><a href="#wrapper-methods" id="toc-wrapper-methods" class="nav-link" data-scroll-target="#wrapper-methods">Wrapper Methods</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Regression</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Regression เป็นวิธีการทางสถิติที่ใช้วิเคราะห์ความสัมพันธ์ระหว่างตัวแปรตาม (Dependent Variable) และตัวแปรอิสระ (Independent Variables) หนึ่งตัวหรือมากกว่า ซึ่งจะช่วยให้เราเข้าใจว่าตัวแปรตามมีการเปลี่ยนแปลงอย่างไรเมื่อมีการเปลี่ยนแปลงในตัวแปรอิสระ</p>
<p>วัตถุประสงค์ของการวิเคราะห์ regression หลัก ๆ มี 2 ข้อ</p>
<p>คือการสร้างโมเดลทางสถิติที่สามารถใช้</p>
<ol type="1">
<li><p>อธิบายความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระ</p></li>
<li><p>ทำนายแนวโน้มของตัวแปรตามเมื่อกำหนดตัวแปรอิสระ</p></li>
</ol>
<p>การวิเคราะห์การถดถอยมีหลายประเภท</p>
<ul>
<li><p>Simple regression</p></li>
<li><p>Multiple regression</p></li>
<li><p>Polynomial regression</p></li>
<li><p>Logistic regression</p></li>
</ul>
<p>…</p>
<section id="simple-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="simple-linear-regression">Simple Linear Regression</h2>
<p>เป็นโมเดลพื้นฐานใช้อธิบายความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระที่เป็นตัวแปรเดียว ทางสังคมศาสตร์อาจไม่ค่อยใช้โมเดลนี้ในทางปฏิบัติเท่าไหร่ แต่มักใช้เป็นโมเดลแรกในการอธิบาย concept เกี่ยวกับ regression</p>
<p>อย่างที่บอกว่า regression analysis จะทำการอธิบายและทำนายตัวแปรตามด้วยตัวแปรอิสระ ผ่านโมเดลทางสถิติ สำหรับ simple regression หรือเรียกเต็ม ๆ ว่า simple linear regression จะมีโมเดลเป็นสมการเส้นตรงที่มีส่วนประกอบจำแนกเป็นสองส่วนได้แก่</p>
<ul>
<li><p>ส่วนที่เป็นความสัมพันธ์เชิงฟังก์ชัน</p></li>
<li><p>ส่วน noise หรือ error</p></li>
</ul>
<p><span class="math display">\[
Y_i = \beta_0 + \beta_1X_i + \epsilon_i
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/choat/Downloads/exam.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 387
Columns: 5
$ ach                  &lt;dbl&gt; 52.159780, 30.784999, 39.607737, 55.985351, 31.80…
$ learning_performance &lt;dbl&gt; 32.666667, 10.666667, 28.000000, 52.666667, 15.55…
$ ontime_class         &lt;chr&gt; "used to late", "used to late", "never late", "us…
$ engage               &lt;chr&gt; "no engage", "much engage", "much engage", "much …
$ practice             &lt;chr&gt; "do practice", "do not praction", "do not practio…</code></pre>
</div>
</div>
<p>สมมุติว่าวัตถุประสงค์การวิเคราะห์ เพื่อวิเคราะห์ความสัมพันธ์ระหว่าง ach กับ learning_performance โดยใช้ simple linear regression</p>
<section id="exploring-data" class="level3">
<h3 class="anchored" data-anchor-id="exploring-data">1. exploring data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ach, learning_performance) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           ach learning_performance
ach                  1.0000000            0.8457081
learning_performance 0.8457081            1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> learning_performance, <span class="at">y =</span> ach))<span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fit-simple-regression" class="level3">
<h3 class="anchored" data-anchor-id="fit-simple-regression">2. fit simple regression</h3>
<p>การประมาณค่าพารามิเตอร์ใน linear regression ทุกโมเดลจะใช้ ordinary least squares (OLS)</p>
<p>วิธีการประมาณนี้จะพยายามหาค่าพารามิเตอร์ intercept และ slope ที่ทำให้ sum squared error น้อยที่สุด —&gt; แปลว่าต้องการโมเดล regression ที่ทำนายได้แม่นยำมากที่สุด หรือ bias น้อยที่สุด</p>
<p><span class="math display">\[
Q = \sum_{i=1}^n (Y_i - \hat{Y}_i)^2 = \sum_{i=1}^n (Y_i - \hat{\beta}_0 - \hat{\beta}_1X_i)^2
\]</span> ตอนประมาณค่าพารามิเตอร์จะใช้การหาอนุพันธ์ของ SSE เทียบกับพารามิเตอร์ intercept และ slope</p>
<p><span class="math display">\[
\frac{\partial Q}{\partial \beta_0}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>simple_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(ach <span class="sc">~</span> learning_performance, <span class="at">data =</span> data)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ach ~ learning_performance, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-29.1638  -5.8006   0.6043   6.8305  23.2356 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          17.70386    0.95723    18.5   &lt;2e-16 ***
learning_performance  0.56536    0.01818    31.1   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.277 on 385 degrees of freedom
Multiple R-squared:  0.7152,    Adjusted R-squared:  0.7145 
F-statistic: 966.9 on 1 and 385 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> learning_performance, <span class="at">y =</span> ach))<span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">17.7039</span> , <span class="at">slope =</span> <span class="fl">0.5654</span> , <span class="at">col =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">2</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> learning_performance, <span class="at">y =</span> ach))<span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">/</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ach         learning_performance ontime_class          engage         
 Min.   :-1.576   Min.   : 2.667       Length:387         Length:387        
 1st Qu.:31.132   1st Qu.:22.556       Class :character   Class :character  
 Median :43.873   Median :47.556       Mode  :character   Mode  :character  
 Mean   :43.607   Mean   :45.817                                            
 3rd Qu.:56.870   3rd Qu.:68.222                                            
 Max.   :83.415   Max.   :96.000                                            
   practice        
 Length:387        
 Class :character  
 Mode  :character  
                   
                   
                   </code></pre>
</div>
</div>
</section>
<section id="การแปลความหมายพารามเตอรในโมเดล" class="level3">
<h3 class="anchored" data-anchor-id="การแปลความหมายพารามเตอรในโมเดล">3. การแปลความหมายพารามิเตอร์ในโมเดล</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="dv">86</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9.273618</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(simple_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ach ~ learning_performance, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-29.1638  -5.8006   0.6043   6.8305  23.2356 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          17.70386    0.95723    18.5   &lt;2e-16 ***
learning_performance  0.56536    0.01818    31.1   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.277 on 385 degrees of freedom
Multiple R-squared:  0.7152,    Adjusted R-squared:  0.7145 
F-statistic: 966.9 on 1 and 385 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(simple_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: ach
                      Df Sum Sq Mean Sq F value    Pr(&gt;F)    
learning_performance   1  83212   83212  966.93 &lt; 2.2e-16 ***
Residuals            385  33132      86                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fl">966.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31.09502</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dv">83212</span><span class="sc">/</span> (<span class="dv">33132</span> <span class="sc">+</span><span class="dv">83212</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7152238</code></pre>
</div>
</div>
<ul>
<li>Residual standard error –&gt; square root ของ MSE ดัชนีตัวนี้ใช้บอกว่า ค่าทำนายของ regression model ของเรามีความคลาดเคลื่อนไปจากค่าจริงโดยเฉลี่ยกี่หน่วย (คะแนน)</li>
</ul>
<p>การแปลความหมายพารามิเตอร์หลัก ๆ ดูที่ intercept และ slope</p>
<ul>
<li>slope คือ อัตราการเปลี่ยนแปลงของ y เมื่อเทียบกับ –&gt; delta_y/delta_x</li>
</ul>
<p>ถ้า slope = 0.57 แปลว่า ถ้านักเรียนมี learning performance สูงขึ้น 1 หน่วย แล้ว ach ของนักเรียนมีแนวโน้มที่จะเพิ่มขึ้นโดยเฉลี่ย 0.57 คะแนน</p>
<ul>
<li>intercept คือ จุดตัดแกน y –&gt; ค่าของ y เมื่อ x = 0</li>
</ul>
<p>ถ้าเด็กไม่มี learning performance เลย (LP = 0) เด็กมีแนวโน้มที่จะมีคะแนน ach โดยเฉลี่ย 17.7 คะแนน</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fit_simreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(ach <span class="sc">~</span> learning_performance, <span class="at">data =</span> data)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_simreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ach ~ learning_performance, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-29.1638  -5.8006   0.6043   6.8305  23.2356 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          17.70386    0.95723    18.5   &lt;2e-16 ***
learning_performance  0.56536    0.01818    31.1   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.277 on 385 degrees of freedom
Multiple R-squared:  0.7152,    Adjusted R-squared:  0.7145 
F-statistic: 966.9 on 1 and 385 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
</section>
<section id="multiple-regression" class="level2">
<h2 class="anchored" data-anchor-id="multiple-regression">Multiple Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">count</span>(engage)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  engage              n
  &lt;chr&gt;           &lt;int&gt;
1 little engage      67
2 moderate engage    84
3 much engage       212
4 no engage          24</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(engage = factor(engage, levels=c("no engage","little engage",</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#                                         "moderate engage","much engage"))) %&gt;% </span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">mutate</span>(<span class="at">engage =</span> <span class="fu">fct_relevel</span>(engage, <span class="st">"no engage"</span>,<span class="st">"little engage"</span>,  <span class="st">"moderate engage"</span>,<span class="st">"much engage"</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(<span class="fu">lm</span>(ach <span class="sc">~</span> learning_performance <span class="sc">+</span> engage)) <span class="ot">-&gt;</span> fit_mulreg</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mulreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ach ~ learning_performance + engage)

Residuals:
     Min       1Q   Median       3Q      Max 
-27.6449  -5.9326   0.4239   6.4016  24.7260 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           18.48425    1.99161   9.281   &lt;2e-16 ***
learning_performance   0.55225    0.01961  28.164   &lt;2e-16 ***
engagelittle engage   -2.21254    2.20469  -1.004    0.316    
engagemoderate engage -0.37247    2.15557  -0.173    0.863    
engagemuch engage      0.51921    2.04122   0.254    0.799    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.265 on 382 degrees of freedom
Multiple R-squared:  0.7181,    Adjusted R-squared:  0.7152 
F-statistic: 243.3 on 4 and 382 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ul>
<li><p>เมื่อควบคุมให้ตัวแปรอิสระอื่น ๆ คงที่ ถ้านักเรียนมี LP สูงขึ้น 1 คะแนน นักเรียนมีแนวโน้มที่จะมีค่าเฉลี่ย ach สูงขึ้น 0.55 คะแนน</p></li>
<li><p>เมื่อควบคุมให้ตัวแปรอิสระอื่น ๆ คงที่ นักเรียนที่มีส่วนร่วมในการเรียนน้อยมีแนวโน้มที่จะมี ach โดยเฉลี่ยต่ำกว่านักเรียนที่ไม่มีส่วนร่วมในการเรียน 2.21 คะแนน อย่างไรก็ตามความแตกต่างดังกล่าวไม่พบนัยสำคัญทางสถิติที่ระดับ .05</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fit_mulreg <span class="ot">&lt;-</span> <span class="fu">lm</span>(ach <span class="sc">~</span> learning_performance <span class="sc">+</span> engage, <span class="at">data =</span> data)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_mulreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ach ~ learning_performance + engage, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-27.6449  -5.9326   0.4239   6.4016  24.7260 

Coefficients:
                      Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)           16.27171    1.26921  12.820   &lt;2e-16 ***
learning_performance   0.55225    0.01961  28.164   &lt;2e-16 ***
engagemoderate engage  1.84006    1.54118   1.194   0.2332    
engagemuch engage      2.73175    1.38438   1.973   0.0492 *  
engageno engage        2.21254    2.20469   1.004   0.3162    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.265 on 382 degrees of freedom
Multiple R-squared:  0.7181,    Adjusted R-squared:  0.7152 
F-statistic: 243.3 on 4 and 382 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="regression-with-interaction" class="level2">
<h2 class="anchored" data-anchor-id="regression-with-interaction">Regression with Interaction</h2>
<p>อิทธิพลปฏิสัมพันธ์ (interaction effect) คืออิทธิพลรวมกันระหว่างตัวแปรอิสระอย่างน้อย 2 ตัวแปร ที่มีผลต่อตัวแปรตาม ที่เมื่อเกิดอิทธิพลของตัวแปรอิสระดังกล่าวจะมีแนวโน้มเปลี่ยนแปลงไปตามค่าของตัวแปรอิสระอื่น ๆ ที่อยู่ในกลุ่มปฏิสัมพันธ์เดียวกัน</p>
<p><img src="https://datakruroo.github.io/Programming/data_analysis/img/interaction.png" class="img-fluid"></p>
<section id="two-way-interaction-effect" class="level3">
<h3 class="anchored" data-anchor-id="two-way-interaction-effect">Two-way interaction effect</h3>
<ul>
<li><p><del>ตัวแปรอิสระทั้งสองเป็นตัวแปรจัดประเภท</del></p></li>
<li><p>ตัวแปรอิสระเป็นตัวแปรจัดประเภทและตัวแปรอิสระเชิงปริมาณ</p></li>
<li><p>ตัวแปรอิสระทั้งสองเป็นตัวแปรเชิงปริมาณ</p></li>
</ul>
<section id="ตวแปรอสระเปนตวแปรจดประเภทและตวแปรอสระเชงปรมาณ" class="level4">
<h4 class="anchored" data-anchor-id="ตวแปรอสระเปนตวแปรจดประเภทและตวแปรอสระเชงปรมาณ">ตัวแปรอิสระเป็นตัวแปรจัดประเภทและตัวแปรอิสระเชิงปริมาณ</h4>
<p>ใช้ชุดข้อมูล <a href="TeacherSalaryData.csv">teachersalary.csv</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"TeacherSalaryData.csv"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 397
Columns: 7
$ ...1          &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
$ rank          &lt;chr&gt; "Prof", "Prof", "AsstProf", "Prof", "Prof", "AssocProf",…
$ discipline    &lt;chr&gt; "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "…
$ yrs.since.phd &lt;dbl&gt; 19, 20, 4, 45, 40, 6, 30, 45, 21, 18, 12, 7, 1, 2, 20, 1…
$ yrs.service   &lt;dbl&gt; 18, 16, 3, 39, 41, 6, 23, 45, 20, 18, 8, 2, 1, 0, 18, 3,…
$ sex           &lt;chr&gt; "Male", "Male", "Male", "Male", "Male", "Male", "Male", …
$ salary        &lt;dbl&gt; 139750, 173200, 79750, 115000, 141500, 97000, 175000, 14…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fit_interac1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> yrs.service<span class="sc">*</span>discipline, <span class="at">data =</span> data)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_interac1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ yrs.service * discipline, data = data)

Residuals:
   Min     1Q Median     3Q    Max 
-86326 -19779  -4999  16091 102274 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              98038.0     3626.9   27.03  &lt; 2e-16 ***
yrs.service                526.8      150.1    3.51 0.000499 ***
disciplineB                857.4     4750.7    0.18 0.856873    
yrs.service:disciplineB    695.2      215.9    3.22 0.001388 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 27540 on 393 degrees of freedom
Multiple R-squared:  0.1795,    Adjusted R-squared:  0.1733 
F-statistic: 28.67 on 3 and 393 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>fit_interac2 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">fct_relevel</span>(rank, <span class="st">"AsstProf"</span>, <span class="st">"AssocProf"</span>, <span class="st">"Prof"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(salary<span class="sc">~</span> yrs.service <span class="sc">+</span> discipline <span class="sc">+</span> yrs.service<span class="sc">:</span>discipline))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_interac2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ yrs.service + discipline + yrs.service:discipline)

Residuals:
   Min     1Q Median     3Q    Max 
-86326 -19779  -4999  16091 102274 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              98038.0     3626.9   27.03  &lt; 2e-16 ***
yrs.service                526.8      150.1    3.51 0.000499 ***
disciplineB                857.4     4750.7    0.18 0.856873    
yrs.service:disciplineB    695.2      215.9    3.22 0.001388 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 27540 on 393 degrees of freedom
Multiple R-squared:  0.1795,    Adjusted R-squared:  0.1733 
F-statistic: 28.67 on 3 and 393 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>การอ่านผล</p>
<ol type="1">
<li>เราสามารถประเมินอิทธิพลของ main effect ที่ไม่เกี่ยวข้องกับ interaction term ได้เลย</li>
</ol>
<ul>
<li><p>เมื่อควบคุมให้ตัวแปรอิสระอื่นคงที่ อาจารย์ที่เป็นรองศาสตราจารย์มีแนวโน้มจะมีเงินเดือนสูงกว่า ผศ. ประมาณ 14000 บท อย่างมีนัยสำคัญทางสถิติที่ระดับ .05 ()</p></li>
<li><p>เมื่อควบคุมให้ตัวแปรอิสระอื่นคงที่ ศาสตราจารย์ของมหาลัยมีแนวโน้มจะมีเงินเดือนสูงกว่า ผศ. ประมาณ 50000 บาท อย่างมีนัยสำคัญทางสถิติที่ระดับ .05</p></li>
</ul>
<ol start="2" type="1">
<li>พิจารณาส่วนปฏิสัมพันธ์</li>
</ol>
<ul>
<li><p>พิจารณา term ปฏิสัมพันธ์ก่อนว่ามีนัยสำคัญรึเปล่า (เชิงสถิติ/เชิงปฏฺิบัติ) ถ้าพบนัยสำคัญทางสถิติเราจะไม่อ่านผลที่ main effect</p></li>
<li><p>เราต้องไปประเมิน simple effect แทน</p>
<ul>
<li><p>ประเมินผลของ yrs.service ที่มีต่อ ach จำแนกตาม discipline A และ B &lt;– การวิเคราะห์ simple slope</p></li>
<li><p>ประเมินผลของ discipline ที่มีต่อ ach จำแนกตาม yrs.service</p></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>yrs.service))<span class="sc">+</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="การวเคราะห-simple-slope-ของ-yrs.service-จำแนกตาม-discipline" class="level5">
<h5 class="anchored" data-anchor-id="การวเคราะห-simple-slope-ของ-yrs.service-จำแนกตาม-discipline">การวิเคราะห์ simple slope ของ yrs.service จำแนกตาม discipline</h5>
<p>วิเคราะห์อิทธิพลของ yrs.service ต่อ ach จำแนกตาม discipline</p>
<p>เราจะดู simple slope ของ cont. จำแนกตาม cat.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>simple_slopes <span class="ot">&lt;-</span> <span class="fu">emtrends</span>(fit_interac2, <span class="at">var =</span> <span class="st">"yrs.service"</span>, <span class="at">spec =</span> <span class="st">"discipline"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="do">## slope ของ yrs.service จำแนกตาม discipline</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>simple_slopes </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> discipline yrs.service.trend  SE  df lower.CL upper.CL
 A                        527 150 393      232      822
 B                       1222 155 393      917     1527

Confidence level used: 0.95 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ความแตกต่างของ slope ของ yrs.service ระหว่าง 2 discipline</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(simple_slopes, <span class="at">method =</span> <span class="st">"pairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast estimate  SE  df t.ratio p.value
 A - B        -695 216 393  -3.220  0.0014</code></pre>
</div>
</div>
<p>ลองใช้ <code>simple_slopes &lt;- emmeans(fit_interac1, pairwise ~ discipline | yrs.service)</code> ผลลัพธ์ที่ได้แตกต่างกันอย่างไร</p>
</section>
<section id="วเคราะห-simple-effect-ของ-discipline-บน-yrs.service" class="level5">
<h5 class="anchored" data-anchor-id="วเคราะห-simple-effect-ของ-discipline-บน-yrs.service">วิเคราะห์ simple effect ของ discipline บน yrs.service</h5>
<p>simple effect ของ discipline ที่วิเคราะห์ได้แต่ละค่าของ yrs.service</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ...1         rank            discipline        yrs.since.phd  
 Min.   :  1   Length:397         Length:397         Min.   : 1.00  
 1st Qu.:100   Class :character   Class :character   1st Qu.:12.00  
 Median :199   Mode  :character   Mode  :character   Median :21.00  
 Mean   :199                                         Mean   :22.31  
 3rd Qu.:298                                         3rd Qu.:32.00  
 Max.   :397                                         Max.   :56.00  
  yrs.service        sex                salary      
 Min.   : 0.00   Length:397         Min.   : 57800  
 1st Qu.: 7.00   Class :character   1st Qu.: 91000  
 Median :16.00   Mode  :character   Median :107300  
 Mean   :17.61                      Mean   :113706  
 3rd Qu.:27.00                      3rd Qu.:134185  
 Max.   :60.00                      Max.   :231545  </code></pre>
</div>
</div>
<p>ในทำนองเดียวกับ anova เราสามารถวิเคราะห์ simple effect ของ discipline แต่ในกรณีนี้จะเป็นการจำแนกตามระดับของ yrs.service ซึ่งมีจำนวนได้มากมาย</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ...1         rank            discipline        yrs.since.phd  
 Min.   :  1   Length:397         Length:397         Min.   : 1.00  
 1st Qu.:100   Class :character   Class :character   1st Qu.:12.00  
 Median :199   Mode  :character   Mode  :character   Median :21.00  
 Mean   :199                                         Mean   :22.31  
 3rd Qu.:298                                         3rd Qu.:32.00  
 Max.   :397                                         Max.   :56.00  
  yrs.service        sex                salary      
 Min.   : 0.00   Length:397         Min.   : 57800  
 1st Qu.: 7.00   Class :character   1st Qu.: 91000  
 Median :16.00   Mode  :character   Median :107300  
 Mean   :17.61                      Mean   :113706  
 3rd Qu.:27.00                      3rd Qu.:134185  
 Max.   :60.00                      Max.   :231545  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(fit_interac2, pairwise <span class="sc">~</span> yrs.service <span class="sc">|</span> discipline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$emmeans
discipline = A:
 yrs.service emmean   SE  df lower.CL upper.CL
        17.6 107318 2077 393   103235   111401

discipline = B:
 yrs.service emmean   SE  df lower.CL upper.CL
        17.6 120420 1898 393   116688   124153

Confidence level used: 0.95 

$contrasts
discipline = A:
 contrast  estimate SE df z.ratio p.value
 (nothing)   nonEst NA NA      NA      NA

discipline = B:
 contrast  estimate SE df z.ratio p.value
 (nothing)   nonEst NA NA      NA      NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>emmeans <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(fit_interac2, pairwise <span class="sc">~</span> yrs.service <span class="sc">|</span> discipline, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">at =</span> <span class="fu">list</span>(<span class="at">yrs.service =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="dv">8</span>,<span class="dv">27</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>emmeans<span class="sc">$</span>emmeans <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>emmean, <span class="at">y=</span><span class="fu">factor</span>(yrs.service), <span class="at">col =</span>discipline ))<span class="sc">+</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower.CL, <span class="at">xmax =</span> upper.CL), <span class="at">width =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>เราอาจ plot แผนภาพแสดงความสัมพันธ์แบบ interaction ได้ง่าย ๆ ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>fit_interac2 <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ yrs.service + discipline + yrs.service:discipline)

Residuals:
   Min     1Q Median     3Q    Max 
-86326 -19779  -4999  16091 102274 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              98038.0     3626.9   27.03  &lt; 2e-16 ***
yrs.service                526.8      150.1    3.51 0.000499 ***
disciplineB                857.4     4750.7    0.18 0.856873    
yrs.service:disciplineB    695.2      215.9    3.22 0.001388 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 27540 on 393 degrees of freedom
Multiple R-squared:  0.1795,    Adjusted R-squared:  0.1733 
F-statistic: 28.67 on 3 and 393 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">## partial dependence plot (pdp)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="do">### 1. สร้าง grid ที่เป็น combination ระหว่างตัวแปรอิสระที่ interact กันก่อน</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="do">### สร้าง grid ของ yrs.service</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>yrs_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data<span class="sc">$</span>yrs.service), <span class="fu">max</span>(data<span class="sc">$</span>yrs.service), <span class="dv">2</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="do">### สร้าง grid ของ discipline</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>dis_grid <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="do">### combination ของ grid</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="fu">expand_grid</span>(<span class="at">yrs.service =</span> yrs_grid, <span class="at">discipline =</span> dis_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 62 × 2
   yrs.service discipline
         &lt;dbl&gt; &lt;chr&gt;     
 1           0 A         
 2           0 B         
 3           2 A         
 4           2 B         
 5           4 A         
 6           4 B         
 7           6 A         
 8           6 B         
 9           8 A         
10           8 B         
# ℹ 52 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">### ทำหน้าที่เป็นค่าของตัวแปรอิสระที่ต้องการนำไปหาค่าทำนาย</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>grid_pred <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(<span class="at">yrs.service =</span> yrs_grid,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">discipline =</span> <span class="fu">unique</span>(data<span class="sc">$</span>discipline))</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit_interac2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6         7         8 
120891.33 118447.34 102561.41 146553.21 148997.20 106227.40 127001.30 153885.18 
        9        10        11        12        13        14        15        16 
123335.32 120891.33 108671.39 101339.42 100117.42  98895.43 120891.33 102561.41 
       17        18        19        20        21        22        23        24 
123335.32 115950.24 110155.11 117003.90 111735.60 114369.75 113842.92 108047.80 
       25        26        27        28        29        30        31        32 
102252.68 102252.68 110155.11 102561.41  98895.43 108671.39 103783.41 101339.42 
       33        34        35        36        37        38        39        40 
109893.38 101339.42 101339.42  98895.43 124557.31 103783.41 136777.26 109893.38 
       41        42        43        44        45        46        47        48 
101339.42 127001.30 131889.28 145331.22 122113.32 117225.35 133111.27 122113.32 
       49        50        51        52        53        54        55        56 
129445.29 100117.42 133111.27 112337.37 102561.41 109893.38 112337.37 105005.40 
       57        58        59        60        61        62        63        64 
124557.31 108671.39 109893.38 102561.41 108671.39 101339.42 136777.26 112337.37 
       65        66        67        68        69        70        71        72 
102561.41 108671.39 113559.36 136777.26 119669.34 142887.23 101339.42 153885.18 
       73        74        75        76        77        78        79        80 
122113.32 140443.24 127001.30 102561.41 102561.41 122113.32 100117.42 101339.42 
       81        82        83        84        85        86        87        88 
133111.27 118447.34 123335.32 101339.42 120891.33 116003.35 144109.22 101339.42 
       89        90        91        92        93        94        95        96 
129445.29 107449.39 105005.40 107449.39 107449.39 145331.22 123335.32  98895.43 
       97        98        99       100       101       102       103       104 
113559.36 107449.39 116003.35 130667.28 129445.29 127001.30 105005.40 116003.35 
      105       106       107       108       109       110       111       112 
103306.33 112789.26 102252.68 102252.68 102252.68 114369.75 106467.31 106467.31 
      113       114       115       116       117       118       119       120 
 98564.87 117530.73  98038.04 102779.50 113316.09 117003.90  98564.87  99618.53 
      121       122       123       124       125       126       127       128 
105413.65 114896.58 109628.29 109628.29 109628.29 123852.68 111735.60  98038.04 
      129       130       131       132       133       134       135       136 
113842.92  99091.70 102779.50 128067.31 102252.68  98564.87 111208.77 107520.97 
      137       138       139       140       141       142       143       144 
105413.65 105413.65 101725.85 107520.97 102252.68 103306.33 103833.16 102561.41 
      145       146       147       148       149       150       151       152 
131889.28 133111.27 103783.41 131889.28 130667.28 102561.41 113559.36 103783.41 
      153       154       155       156       157       158       159       160 
109893.38 111115.37  98895.43 124557.31 120891.33  98895.43 106227.40 118447.34 
      161       162       163       164       165       166       167       168 
101339.42 122113.32 107449.39 102561.41  98895.43 108671.39 118447.34 122113.32 
      169       170       171       172       173       174       175       176 
106227.40 120891.33 105005.40 122113.32 128223.30 123335.32 106227.40 129445.29 
      177       178       179       180       181       182       183       184 
107449.39 109893.38 116003.35 102561.41 112337.37 105005.40 108671.39 125779.31 
      185       186       187       188       189       190       191       192 
127001.30 135555.26 111115.37 111115.37 133111.27 122113.32 109893.38 125779.31 
      193       194       195       196       197       198       199       200 
120891.33 122113.32 163661.13 107449.39 103783.41 103783.41 139221.25 125779.31 
      201       202       203       204       205       206       207       208 
103783.41 147775.21 119669.34 119669.34 105005.40 101339.42 139221.25 120891.33 
      209       210       211       212       213       214       215       216 
101339.42 123335.32 102561.41 146553.21 107449.39 122113.32 100117.42 112337.37 
      217       218       219       220       221       222       223       224 
112337.37 125779.31 107449.39 112337.37 124557.31 111115.37 106227.40 123335.32 
      225       226       227       228       229       230       231       232 
116477.07 108574.63  98564.87 101725.85 103833.16 118057.55 112262.43 110681.94 
      233       234       235       236       237       238       239       240 
108047.80 108047.80  99618.53 106994.14 111208.77 101199.02 119111.21 101199.02 
      241       242       243       244       245       246       247       248 
 99618.53 113842.92 117530.73 110155.11 110155.11 103833.16 110155.11 107520.97 
      249       250       251       252       253       254       255       256 
110155.11 101725.85 118584.38 102252.68 104359.99  99091.70 101725.85 102252.68 
      257       258       259       260       261       262       263       264 
109628.29 110155.11  99618.53 113842.92 115423.41 121745.36 111735.60 114369.75 
      265       266       267       268       269       270       271       272 
116477.07 113842.92 120691.70 103306.33 121218.53 101725.85 119111.21 107520.97 
      273       274       275       276       277       278       279       280 
 98564.87 100145.36  99618.53 101199.02 123325.85 112262.43 107520.97 122272.19 
      281       282       283       284       285       286       287       288 
118057.55 112262.43 124906.34 120691.70 101199.02 123852.68 112262.43  98038.04 
      289       290       291       292       293       294       295       296 
112262.43 100672.19 101725.85 112789.26 102779.50  98564.87 101725.85 117003.90 
      297       298       299       300       301       302       303       304 
107520.97 103833.16 120691.70 118584.38 117003.90 106467.31 104886.82 100145.36 
      305       306       307       308       309       310       311       312 
121218.53 114369.75 100145.36 112789.26  98038.04 105940.48 101725.85 102779.50 
      313       314       315       316       317       318       319       320 
108047.80 116477.07 101199.02 102561.41 109893.38 153885.18 118447.34 117225.35 
      321       322       323       324       325       326       327       328 
127001.30 109893.38 112337.37 117225.35 136777.26 103783.41 117225.35 144109.22 
      329       330       331       332       333       334       335       336 
111115.37 127001.30 172215.10 109893.38 111115.37 122113.32 106227.40 145331.22 
      337       338       339       340       341       342       343       344 
127001.30 113559.36 129445.29 117225.35 112337.37 119669.34 145331.22 136777.26 
      345       346       347       348       349       350       351       352 
141665.23 111115.37 131889.28 139221.25 102561.41 133111.27 158773.16 145331.22 
      353       354       355       356       357       358       359       360 
131889.28 123335.32 100117.42 124557.31 119111.21 116477.07 105413.65 100145.36 
      361       362       363       364       365       366       367       368 
103833.16 105940.48 113842.92 106994.14 120691.70 119111.21 103306.33  98564.87 
      369       370       371       372       373       374       375       376 
113842.92 114369.75 102252.68 108574.63 101725.85 111735.60 108047.80 111735.60 
      377       378       379       380       381       382       383       384 
 98564.87  99618.53 118057.55 102252.68  99618.53 110155.11 100672.19 121218.53 
      385       386       387       388       389       390       391       392 
109101.46 102779.50 112262.43 105940.48 117003.90 107520.97 108047.80 108047.80 
      393       394       395       396       397 
113842.92 108047.80 111208.77 105940.48 100145.36 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit_interac2, <span class="at">newdata =</span> grid_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6         7         8 
 98895.43  98038.04 101339.42  99091.70 103783.41 100145.36 106227.40 101199.02 
        9        10        11        12        13        14        15        16 
108671.39 102252.68 111115.37 103306.33 113559.36 104359.99 116003.35 105413.65 
       17        18        19        20        21        22        23        24 
118447.34 106467.31 120891.33 107520.97 123335.32 108574.63 125779.31 109628.29 
       25        26        27        28        29        30        31        32 
128223.30 110681.94 130667.28 111735.60 133111.27 112789.26 135555.26 113842.92 
       33        34        35        36        37        38        39        40 
137999.25 114896.58 140443.24 115950.24 142887.23 117003.90 145331.22 118057.55 
       41        42        43        44        45        46        47        48 
147775.21 119111.21 150219.20 120164.87 152663.18 121218.53 155107.17 122272.19 
       49        50        51        52        53        54        55        56 
157551.16 123325.85 159995.15 124379.51 162439.14 125433.16 164883.13 126486.82 
       57        58        59        60        61        62 
167327.12 127540.48 169771.11 128594.14 172215.10 129647.80 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>grid_pred <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">predict</span>(fit_interac2, <span class="at">newdata =</span> grid_pred)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> yrs.service, <span class="at">y =</span> pred, <span class="at">color =</span> discipline)) <span class="sc">+</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>simple_slopes </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> discipline yrs.service.trend  SE  df lower.CL upper.CL
 A                        527 150 393      232      822
 B                       1222 155 393      917     1527

Confidence level used: 0.95 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>yrs.service, <span class="at">y=</span>salary))<span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>yrs.service, <span class="at">y=</span>salary, <span class="at">col =</span> discipline))<span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">/</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="ตวแปรอสระทงสองเปนตวแปรเชงปรมาณ" class="level4">
<h4 class="anchored" data-anchor-id="ตวแปรอสระทงสองเปนตวแปรเชงปรมาณ">ตัวแปรอิสระทั้งสองเป็นตัวแปรเชิงปริมาณ</h4>
<p><img src="img/interaction2.png" class="img-fluid" style="width:50.0%"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"eff.csv"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 100
Columns: 4
$ id    &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 1…
$ seef  &lt;dbl&gt; 5.7599470, 3.7773884, 5.4455399, 13.5313592, 9.4946747, 2.341611…
$ motiv &lt;dbl&gt; 5.472301, 3.966361, 4.874800, 5.928663, 5.868340, 4.150825, 4.61…
$ eff   &lt;dbl&gt; 39, 28, 41, 40, 38, 31, 20, 33, 42, 61, 33, 33, 24, 23, 41, 47, …</code></pre>
</div>
</div>
<p><span class="math display">\[
eff = \beta_0 + \beta_1motiv + \beta_2seef + \beta_3motiv \times seef + \epsilon
\]</span></p>
<p>$$ eff = _0 + _1motiv + (_2seef + _3motiv seef) + </p>
<p>$$</p>
<p>$$ eff = _0 + _1motiv + (_2 + _3motiv)seef + </p>
<p>$$</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id              seef             motiv            eff       
 Min.   :  1.00   Min.   : 0.3818   Min.   :2.371   Min.   :18.00  
 1st Qu.: 25.75   1st Qu.: 3.3801   1st Qu.:4.209   1st Qu.:28.00  
 Median : 50.50   Median : 6.2057   Median :5.062   Median :34.50  
 Mean   : 50.50   Mean   : 6.2896   Mean   :5.048   Mean   :35.77  
 3rd Qu.: 75.25   3rd Qu.: 8.1899   3rd Qu.:5.954   3rd Qu.:41.00  
 Max.   :100.00   Max.   :15.4602   Max.   :7.448   Max.   :77.00  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>fit_interac3 <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(eff <span class="sc">~</span> motiv <span class="sc">+</span> seef <span class="sc">+</span> motiv<span class="sc">:</span>seef))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_interac3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = eff ~ motiv + seef + motiv:seef)

Residuals:
     Min       1Q   Median       3Q      Max 
-11.4653  -3.3952  -0.9439   3.2766  12.9369 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  13.6969     4.9097   2.790  0.00636 ** 
motiv         1.6534     0.9545   1.732  0.08644 .  
seef          7.7468     0.7112  10.893  &lt; 2e-16 ***
motiv:seef   -1.0891     0.1356  -8.034 2.41e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.958 on 96 degrees of freedom
Multiple R-squared:  0.8065,    Adjusted R-squared:  0.8004 
F-statistic: 133.3 on 3 and 96 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>ดังนั้นเราสรุปได้ว่า</p>
<p>อิทธิพลของ seef ที่มีต่อ eff อธิบายได้ด้วยสมการ 7.75 - 1.09 x motiv</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>motiv<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>slope_seef <span class="ot">&lt;-</span> <span class="fl">7.75</span> <span class="sc">-</span> <span class="fl">1.09</span><span class="sc">*</span>motiv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>motiv<span class="ot">&lt;-</span><span class="fl">5.048</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>slope_seef <span class="ot">&lt;-</span> <span class="fl">7.75</span> <span class="sc">-</span> <span class="fl">1.09</span><span class="sc">*</span>motiv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>seef, <span class="at">y=</span>eff))<span class="sc">+</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> F)<span class="sc">+</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">13.6969</span>,<span class="at">slope =</span> <span class="fl">4.48</span>, <span class="at">col =</span><span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">13.6969</span>,<span class="at">slope =</span> <span class="fl">2.24768</span>, <span class="at">col =</span><span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">13.6969</span>,<span class="at">slope =</span> <span class="fl">0.12</span>, <span class="at">col =</span><span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">80</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>simple_slope_seef <span class="ot">&lt;-</span> <span class="fu">emtrends</span>(fit_interac3, <span class="at">var=</span><span class="st">"seef"</span>, <span class="at">spec =</span> <span class="st">"motiv"</span>,</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">at =</span> <span class="fu">list</span>(<span class="at">motiv=</span> <span class="fu">c</span>(<span class="fl">4.209</span>,<span class="fl">5.062</span>,<span class="fl">5.954</span>)))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>simple_slope_seef <span class="sc">%&gt;%</span> <span class="fu">contrast</span>(<span class="at">method =</span> <span class="st">"pairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate    SE df t.ratio p.value
 motiv4.209 - motiv5.062    0.929 0.116 96   8.034  &lt;.0001
 motiv4.209 - motiv5.954    1.901 0.237 96   8.034  &lt;.0001
 motiv5.062 - motiv5.954    0.972 0.121 96   8.034  &lt;.0001

P value adjustment: tukey method for comparing a family of 3 estimates </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>simple_slope_seef <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  motiv seef.trend        SE df  lower.CL upper.CL
1 4.209   3.162659 0.1894318 96 2.7866394 3.538678
2 5.062   2.233633 0.1414366 96 1.9528832 2.514382
3 5.954   1.262131 0.1788933 96 0.9070302 1.617231</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>seef, <span class="at">y=</span>eff))<span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> ,<span class="at">slope =</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("ggeffects")</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeffects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpredict</span>(fit_interac3, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">"seef"</span>, <span class="st">"motiv"</span>)) <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       id              seef             motiv            eff       
 Min.   :  1.00   Min.   : 0.3818   Min.   :2.371   Min.   :18.00  
 1st Qu.: 25.75   1st Qu.: 3.3801   1st Qu.:4.209   1st Qu.:28.00  
 Median : 50.50   Median : 6.2057   Median :5.062   Median :34.50  
 Mean   : 50.50   Mean   : 6.2896   Mean   :5.048   Mean   :35.77  
 3rd Qu.: 75.25   3rd Qu.: 8.1899   3rd Qu.:5.954   3rd Qu.:41.00  
 Max.   :100.00   Max.   :15.4602   Max.   :7.448   Max.   :77.00  </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="polynomial-regression" class="level2">
<h2 class="anchored" data-anchor-id="polynomial-regression">Polynomial Regression</h2>
<p>สมการถดถอยพหุนาม</p>
<p>ความสัมพันธ์ระหว่างตัวแปรบนโลก อาจจำแนกได้เป็น 2 ลักษณะ</p>
<ul>
<li><p>linear relationship</p></li>
<li><p>non-linear relationship</p></li>
</ul>
<p>โมเดลการวิเคราะห์ความสัมพันธ์ระหว่างตัวแปรอาจจำแนกได้เป็น 2 ลักษณะเช่นกัน</p>
<ul>
<li><p>linear (in parameters) model</p></li>
<li><p>non-linear model</p></li>
</ul>
<p><span class="math display">\[
y = mx + c
\]</span> <span class="math display">\[
y = ax^2+bx+c
\]</span></p>
<p><span class="math display">\[
y = \frac{exp(ax+b)}{1+exp(ax+b)}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp))<span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>)<span class="sc">+</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>การสร้าง term polynomial อาจทำได้สองวิธีการ วิธีการแรกคือการใช้ฟังก์ชัน identity function (<code>I()</code>) และวิธีการที่สองคือการใช้ <code>poly()</code> ความแตกต่างระหว่างการสร้างเทอมพหุนามของทั้งสองวิธีการคือ</p>
<ul>
<li><p><code>I()</code> เป็นวิธีการสร้างพหุนามโดยตรง โดยเราจะใส่ตัวแปรที่ต้องการยกกำลังในฟังก์ชันนี้ ตัวอย่างเช่น I(x^2) หมายถึงการสร้างเทอม x^2 ที่ใช้ในโมเดลการถดถอย ดังนั้นการแปลความหมาย slope ของตัวแปรที่เป็นพหุนามนี้สามารถทำได้อย่างตรงไปตรงมา เพราะตัวแปรต่าง ๆ อยู่ในสเกลต้นฉบับ</p></li>
<li><p>ปัญหาหนึ่งของการใช้ <code>I()</code> คือ multicollinearity!!!</p></li>
<li><p><code>poly()</code> จะสร้างเทอมพหุนามที่เรียกว่า orthogonal polynomial ซึ่งจะทำให้เราไม่ต้องกังวลเรื่อง multicollinearity แต่ต้องแลกมาด้วยการแปลความหมายความสัมพันธ์ที่ยาก เพราะตัวแปรที่ถูกแปลงเป็น orthogonal polynomial จะอยู่คนละสเกลกับตัวแปรเดิม การแปลงลักษณะนี้จึงเหมาะกับวัตถุประสงค์ในการทำนายมากกว่าอธิบายความสัมพันธ์ื</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>cubic_fit <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(lifeExp <span class="sc">~</span> gdpPercap <span class="sc">+</span> <span class="fu">I</span>(gdpPercap<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(gdpPercap<span class="sc">^</span><span class="dv">3</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math display">\[
lifeExp = (5.296e+01) + (2.734e-03)gdpPercap - (9.270e-08)gdpPercap^2 + (1.009e-12)gdpPercap^3
\]</span><br>
</p>
<section id="ปญหา-multicollinearity-ใน-polynomial-regression" class="level3">
<h3 class="anchored" data-anchor-id="ปญหา-multicollinearity-ใน-polynomial-regression">ปัญหา Multicollinearity ใน Polynomial Regression</h3>
<p>variance inflation factor –&gt; เป็นดัชนีที่ใช้วัด multicollinearity ของตัวแปรอิสระในโมเดล regression ถ้าค่า VIF มีค่ามากกว่า 10 แสดงว่ามี multicollinearity ในโมเดล</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("car")</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(cubic_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     gdpPercap I(gdpPercap^2) I(gdpPercap^3) 
      50.24411      260.77975      101.25863 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> gdpPercap,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">x2 =</span>gdpPercap<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x3 =</span> gdpPercap<span class="sc">^</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x,x2,x3) <span class="sc">%&gt;%</span> <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           x        x2        x3
x  1.0000000 0.9578118 0.8872893
x2 0.9578118 1.0000000 0.9792936
x3 0.8872893 0.9792936 1.0000000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="do">## correlation matrix between centering variables</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> gdpPercap,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x2 =</span>gdpPercap<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x3 =</span> gdpPercap<span class="sc">^</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x_center =</span> x<span class="sc">-</span><span class="fu">mean</span>(x),</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">x_center2 =</span> x_center<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">x_center3 =</span> x_center<span class="sc">^</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x_center, x_center2,x_center3) <span class="sc">%&gt;%</span> <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           x_center x_center2 x_center3
x_center  1.0000000 0.7993676 0.8129349
x_center2 0.7993676 1.0000000 0.9654560
x_center3 0.8129349 0.9654560 1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="do">## scatter plot</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> gdpPercap,</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x2 =</span>gdpPercap<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x3 =</span> gdpPercap<span class="sc">^</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x_center =</span> x<span class="sc">-</span><span class="fu">mean</span>(x),</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">x_center2 =</span> x_center<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">x_center3 =</span> x_center<span class="sc">^</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x_center, x_center2,x_center3) <span class="sc">%&gt;%</span> </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x_center,x_center3 ))<span class="sc">+</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>cubic_fit <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(lifeExp <span class="sc">~</span> <span class="fu">poly</span>(gdpPercap, <span class="dv">3</span>)))</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>cubic_fit <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lifeExp ~ poly(gdpPercap, 3))

Residuals:
    Min      1Q  Median      3Q     Max 
-23.954  -3.373   1.044   4.933  15.151 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)          67.0074     0.6425 104.295  &lt; 2e-16 ***
poly(gdpPercap, 3)1  97.2925     7.6560  12.708  &lt; 2e-16 ***
poly(gdpPercap, 3)2 -48.2958     7.6560  -6.308 3.58e-09 ***
poly(gdpPercap, 3)3  25.7821     7.6560   3.368 0.000983 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.656 on 138 degrees of freedom
Multiple R-squared:  0.6064,    Adjusted R-squared:  0.5979 
F-statistic: 70.88 on 3 and 138 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
</section>
<section id="regression-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="regression-diagnostics">Regression Diagnostics</h2>
<p>regression เป็นโมเดลทางสถิติแบบ parametric ที่การใช้งานจะต้องอยู่ภายใต้ข้อตกลงเบื้องต้นของโมเดลที่ค่อนข้าง strict (แต่ก็ไม่ได้แปลว่าต้อง strict มาก ๆ )</p>
<ul>
<li><p>Independence</p></li>
<li><p>Linearity (no misspecification)</p></li>
<li><p>Normality</p></li>
<li><p>Homoscedasticity</p></li>
<li><p>No Missing Values</p></li>
<li><p>No Influential Outlier</p>
<ul>
<li>Outlier คือ ค่าสังเกตที่ทำนายไม่ได้หรือมีประสิทธิภาพการทำนายด้วย regression ต่ำ (กล่าวคือมีค่าสัมบูรณ์ของ residual ที่มากเกินไป)</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/choat/Downloads/exam.csv"</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 387
Columns: 5
$ ach                  &lt;dbl&gt; 52.159780, 30.784999, 39.607737, 55.985351, 31.80…
$ learning_performance &lt;dbl&gt; 32.666667, 10.666667, 28.000000, 52.666667, 15.55…
$ ontime_class         &lt;chr&gt; "used to late", "used to late", "never late", "us…
$ engage               &lt;chr&gt; "no engage", "much engage", "much engage", "much …
$ practice             &lt;chr&gt; "do practice", "do not praction", "do not practio…</code></pre>
</div>
</div>
<p>เรา fit multiple regression ตามกรอบแนวคิดของการวิเคราะห์ก่อน</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>simple_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(ach <span class="sc">~</span> learning_performance , <span class="at">data=</span>data)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>y<span class="ot">&lt;-</span><span class="fl">0.5+0.1</span><span class="sc">*</span>x<span class="fl">+0.08</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">101</span>,<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(x,y) <span class="sc">%&gt;%</span> </span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y))<span class="sc">+</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se=</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(x,y)<span class="ot">-&gt;</span>temp</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>simple_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>temp)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">y_truth =</span> y, <span class="at">pred =</span> <span class="fu">predict</span>(simple_reg)) <span class="sc">%&gt;%</span> </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residual =</span> y_truth<span class="sc">-</span>pred) <span class="sc">%&gt;%</span> </span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pred, <span class="at">y=</span>residual))<span class="sc">+</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()<span class="sc">+</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"residual plot"</span>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>simple_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x, <span class="at">data=</span>temp)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>poly_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(y<span class="sc">~</span>x<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data=</span> temp)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(simple_reg , poly_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: y ~ x
Model 2: y ~ x + I(x^2)
  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1     99 563880                                  
2     98 177112  1    386768 214.01 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>multi_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(ach <span class="sc">~</span> . , <span class="at">data=</span>data)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(multi_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = ach ~ ., data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-28.2350  -5.8607   0.3238   6.3497  24.0758 

Coefficients:
                         Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)              15.89207    1.32524  11.992   &lt;2e-16 ***
learning_performance      0.55155    0.02043  26.998   &lt;2e-16 ***
ontime_classused to late  1.03293    0.98764   1.046   0.2963    
engagemoderate engage     1.82258    1.54333   1.181   0.2384    
engagemuch engage         2.68749    1.38797   1.936   0.0536 .  
engageno engage           2.28433    2.21548   1.031   0.3032    
practicedo practice       0.28692    1.17647   0.244   0.8075    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.275 on 380 degrees of freedom
Multiple R-squared:  0.719, Adjusted R-squared:  0.7146 
F-statistic: 162.1 on 6 and 380 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<section id="linearity" class="level3">
<h3 class="anchored" data-anchor-id="linearity">Linearity</h3>
<p>ความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระจะต้องเป็นความสัมพันธ์เชิงเส้นตรง วิธีการหนึ่งที่มีประโยชน์มากในการตรวจสอบ linearity assumption ระหว่างตัวแปรตามกับตัวแปรอิสระหลาย ๆ ตัว คือการพิจารณา error ของโมเดล เรียกการวิเคราะห์นี้ว่า การวิเคราะห์เศษเหลือ (residual analysis)</p>
<p>เศษเหลือคืออะไร???</p>
<p>กำหนดให้ สมการถดถอยที่ประมาณได้มีสมการเป็น <span class="math inline">\(\hat{y} = b0+b1x1+b2x2+...+bpxp\)</span></p>
<p><span class="math display">\[
e_i = y_i - \hat{y}_i
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ค่าทำนายของ y จาก multiple regression ข้างต้น (y_hat)</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(multi_reg) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       1        2        3        4        5        6        7        8 
37.51367 25.49574 34.02306 48.94790 28.19222 68.55868 29.90816 27.45681 
       9       10       11       12       13       14       15       16 
57.36326 50.29614 23.04439 29.72626 27.21801 35.66883 35.05599 31.86924 
      17       18       19       20       21       22       23       24 
42.81953 39.53859 33.70775 60.10153 58.83407 61.16917 52.58313 60.67258 
      25       26       27       28       29       30       31       32 
52.13465 62.45869 70.64233 50.62205 52.21543 36.89450 71.81560 71.28355 
      33       34       35       36       37       38       39       40 
58.58893 26.22420 64.34798 68.86705 44.07358 66.87112 47.75960 44.68642 
      41       42       43       44       45       46       47       48 
41.49967 71.13260 66.17750 48.97628 63.80693 48.89550 44.80899 57.59779 
      49       50       51       52       53       54       55       56 
46.32159 43.58331 48.97628 47.13777 64.66491 62.58126 61.96842 29.37449 
      57       58       59       60       61       62       63       64 
26.54645 39.66116 34.88103 66.17750 26.54645 58.04627 67.11625 61.15224 
      65       66       67       68       69       70       71       72 
47.50547 21.27605 54.00154 19.56909 58.29140 53.63384 50.07939 59.93717 
      73       74       75       76       77       78       79       80 
38.85558 38.55805 44.44129 47.38290 58.03933 54.98208 31.57171 41.74480 
      81       82       83       84       85       86       87       88 
63.97129 41.98994 52.28560 64.54234 35.30113 30.39843 47.38290 38.73301 
      89       90       91       92       93       94       95       96 
45.10652 56.86238 34.81086 33.95127 59.39451 49.80587 34.68829 34.63590 
      97       98       99      100      101      102      103      104 
55.34978 48.28266 44.57284 63.19410 34.81086 30.95193 56.13758 55.34978 
     105      106      107      108      109      110      111      112 
67.15804 55.97161 21.93434 26.66901 44.68642 70.18044 25.19127 42.63763 
     113      114      115      116      117      118      119      120 
47.98880 39.84511 22.05691 39.30245 51.54326 65.45271 70.88746 60.59180 
     121      122      123      124      125      126      127      128 
43.02287 71.20277 57.43343 35.41309 32.79045 71.45157 46.61218 68.87399 
     129      130      131      132      133      134      135      136 
46.77007 50.48194 46.94503 57.15991 37.57751 51.30506 42.40310 23.49125 
     137      138      139      140      141      142      143      144 
57.89532 52.15609 51.52181 61.89825 35.02053 38.85558 61.60072 49.31560 
     145      146      147      148      149      150      151      152 
53.48289 48.60858 46.55978 43.39058 35.85463 50.29614 28.39395 31.66589 
     153      154      155      156      157      158      159      160 
47.38290 43.93162 32.43867 52.25028 68.83220 55.60391 58.88485 53.59838 
     161      162      163      164      165      166      167      168 
38.31292 38.10957 46.92748 55.22028 56.12698 58.21062 64.62958 30.89769 
     169      170      171      172      173      174      175      176 
28.75266 46.28612 54.53727 32.85877 53.51760 59.31740 36.10670 55.27267 
     177      178      179      180      181      182      183      184 
56.46188 59.06860 31.31964 38.07677 47.74367 57.85353 43.02287 67.89345 
     185      186      187      188      189      190      191      192 
52.20849 56.57546 23.29851 48.57326 35.90703 31.37897 41.49967 44.85445 
     193      194      195      196      197      198      199      200 
46.85731 23.05338 28.01032 42.84791 28.22693 56.62092 56.98862 34.38382 
     201      202      203      204      205      206      207      208 
55.40218 26.35371 64.87458 22.30205 65.57527 51.12131 51.10538 63.11699 
     209      210      211      212      213      214      215      216 
39.65422 60.67258 43.14544 62.14339 31.44220 35.29419 51.60259 27.76518 
     217      218      219      220      221      222      223      224 
45.78259 62.50048 47.79240 30.95193 45.66002 70.34480 26.78464 65.93237 
     225      226      227      228      229      230      231      232 
52.89150 34.03205 51.92689 44.08257 62.45175 52.29459 60.25248 57.18136 
     233      234      235      236      237      238      239      240 
59.51014 54.11717 54.13310 31.09043 23.85629 50.16649 58.94603 50.16649 
     241      242      243      244      245      246      247      248 
44.28326 33.03558 44.43435 28.63009 49.59811 25.61669 23.17594 30.58423 
     249      250      251      252      253      254      255      256 
34.39076 24.59436 24.27905 35.62542 19.07883 19.69166 47.98880 26.60783 
     257      258      259      260      261      262      263      264 
51.80432 23.73639 20.71399 23.49125 58.01788 62.55288 20.95380 26.18773 
     265      266      267      268      269      270      271      272 
32.47147 22.37222 17.36288 30.10989 19.37636 29.97833 26.53951 21.76632 
     273      274      275      276      277      278      279      280 
22.80824 24.42734 27.19413 31.32658 19.69166 36.85110 19.98919 19.00865 
     281      282      283      284      285      286      287      288 
19.81423 26.24013 26.66901 58.81652 35.86157 67.48396 43.82845 34.38382 
     289      290      291      292      293      294      295      296 
35.82611 33.47161 53.18903 53.07340 53.07340 46.44415 43.39956 24.27905 
     297      298      299      300      301      302      303      304 
52.81766 58.04627 27.90368 24.49765 29.67202 63.59665 56.73981 57.06573 
     305      306      307      308      309      310      311      312 
38.98714 22.53657 47.34758 44.60931 36.27473 21.28504 19.37636 25.09257 
     313      314      315      316      317      318      319      320 
28.06271 52.01208 58.65910 45.05412 57.96549 70.72310 41.10358 51.11232 
     321      322      323      324      325      326      327      328 
66.38085 66.67838 67.15804 61.28542 21.29298 66.10733 55.51414 62.09099 
     329      330      331      332      333      334      335      336 
26.17181 26.17181 52.15609 49.63457 55.39157 48.77293 28.50753 28.68249 
     337      338      339      340      341      342      343      344 
58.58893 58.83407 36.51986 24.34023 23.59789 60.37505 46.93442 24.64675 
     345      346      347      348      349      350      351      352 
22.12708 18.71112 28.38496 49.01807 38.77480 62.73868 28.87523 35.30113 
     353      354      355      356      357      358      359      360 
50.93736 46.77007 62.45869 32.06198 30.59117 23.12355 38.96754 21.39168 
     361      362      363      364      365      366      367      368 
61.47815 43.95102 33.49733 21.51425 43.94408 27.08911 21.24059 21.24059 
     369      370      371      372      373      374      375      376 
65.27774 31.53625 30.55571 34.51333 27.08749 26.42388 19.69166 22.80824 
     377      378      379      380      381      382      383      384 
22.86943 45.05412 44.80899 32.92894 53.74947 23.35970 34.14563 22.83396 
     385      386      387 
22.09856 27.27491 26.17875 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ค่าจริงของ y</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>ach</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 52.159780 30.784999 39.607737 55.985351 31.800255 70.544232 21.153590
  [8]  9.963093 65.028104 61.423482 14.158104 29.131224 19.246805 31.566105
 [15] 25.048183 20.244099 40.828556 36.332986 46.742625 66.304324 62.449263
 [22] 66.015826 48.727004 64.040506 57.483179 62.591741 78.382666 56.778988
 [29] 50.250194 40.991311 77.102606 75.104048 62.338120 28.622395 69.627446
 [36] 75.121712 50.194450 69.170199 44.172282 41.376205 30.019246 71.456394
 [43] 58.758231 64.209985 56.074985 39.152925 37.733248 64.015246 51.034486
 [50] 44.634737 55.853736 46.939940 54.989688 63.740542 59.107009 26.200015
 [57] 43.873145 22.100319 34.259831 66.461050 32.162707 58.365416 83.414677
 [64] 62.701549 30.956524 21.851733 58.775803 13.652267 53.825437 49.410834
 [71] 37.053727 53.280283 38.677377 50.593266 43.748650 46.067695 75.109772
 [78] 45.427755 45.626542 30.503778 77.445374 45.643483 60.622359 56.835232
 [85] 33.327661 27.784317 56.888530 50.461564 49.933358 55.340994 50.887105
 [92] 15.133796 56.835426 46.046210  6.453335 34.214203 66.149144 44.499339
 [99] 42.697130 65.974096 43.254268 35.658121 44.935297 48.099891 61.750784
[106] 57.868442 30.761188 41.999791 38.840754 65.887166 35.707178 35.507200
[113] 49.100709 36.318975 22.355916 38.026119 35.804370 50.911634 75.021971
[120] 54.064800 51.889430 65.228950 52.851567 37.275190 13.821305 57.457202
[127] 22.061439 56.852451 40.024283 50.740190 31.850431 41.138200 28.476372
[134] 34.960741 44.887023 23.997759 58.155935 47.359959 37.669322 59.758422
[141] 41.681319 27.254943 64.881954 48.565652 39.621925 49.987031 31.404050
[148] 32.254133 30.471432 37.540283 14.857692  8.775116 49.111824 53.570274
[155] 23.832523 52.873493 72.204089 66.837116 56.445136 50.464240 46.902832
[162] 39.359723 42.730307 62.396606 49.526841 66.743900 76.485153 31.837708
[169] 47.889315 42.519219 61.230313 24.254402 61.744853 56.143639 34.491855
[176] 58.595600 53.014102 78.282790 33.885158 41.210304 36.605234 53.084875
[183] 50.931677 60.301155 64.463870 55.116632 42.239084 51.485406 32.725641
[190] 32.683710 31.133709 43.249440 43.313191 14.222776 42.406885 31.748585
[197] 23.596056 64.481467 55.381013 42.313398 50.508336 23.335141 63.220976
[204] 28.981081 77.229266 60.107249 66.404280 68.368183 34.418131 73.302312
[211] 41.822497 68.120110 41.915937 49.977550 59.180179 23.282042 41.042072
[218] 70.732889 49.425920 38.570078 56.095645 71.486747 14.683723 78.023473
[225] 53.918175  7.134282 50.825690 54.410973 62.451924 57.541582 54.018752
[232] 45.298130 59.804928 43.324704 51.363519 28.273272 24.113266 55.881960
[239] 64.906012 55.142469 33.701291 47.520497 46.841390 37.643333 59.791786
[246] 21.722665 31.465894 33.017200 35.689278 21.051837 28.400471 30.394915
[253] 29.078974 20.737224 47.651567 33.561586 51.189638  8.627494 35.217834
[260] 24.199900 63.115875 75.414644 32.476183  8.308901 33.544572 32.348799
[267] 11.355064 38.317478 16.405277 25.710983 28.886049 12.463117 16.043602
[274] 31.130925 19.103720 36.898098 28.683384 36.756780 17.165950  3.523936
[281]  4.104578 28.787424 25.572049 67.400627 33.433171 65.625006 48.700585
[288] 47.570969 27.611006 25.583903 59.882999 57.971862 56.152910 58.409910
[295] 52.001565 41.641811 55.656791 50.260517 33.866946 20.548251 29.525051
[302] 66.370251 73.963743 59.119187 25.112639  9.983790 51.034396 44.577051
[309] 40.190718 12.832670 43.452167 25.832618 33.534645 57.879993 62.285026
[316] 31.360606 52.089733 66.334289 51.842048 54.756749 58.143628 66.552569
[323] 60.607715 57.928153 12.430458 69.995842 49.603018 69.705728 18.791411
[330]  8.238568 29.615403 24.805120 62.073011 45.535498 46.463795  6.769625
[337] 57.353560 69.222212 45.088006 13.881842 29.331037 61.639197 28.315896
[344] -1.575576 15.606012 17.003194 34.484268 56.211766 17.045757 59.087025
[351] 46.070195 22.170878 54.252386 45.018613 66.718427 39.925445 29.588151
[358] 37.419969 40.289666 22.949017 79.967639 54.075336 34.158403 25.935650
[365] 43.331507 26.623358 32.058265 27.463084 57.828346 21.705117 15.515806
[372] 37.283463 44.287377 35.389668 31.583689 29.702664 23.223320 42.136068
[379] 37.005496 46.590159 38.282243 29.641562 40.898818 16.407469 31.738276
[386] 24.129012 32.661737</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="do">## เศษเหลือจากการทำนาย y ด้วย yhat</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>e <span class="ot">=</span> data<span class="sc">$</span>ach <span class="sc">-</span> <span class="fu">predict</span>(multi_reg)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">ach_truth =</span> data<span class="sc">$</span>ach, <span class="at">pred =</span> <span class="fu">predict</span>(multi_reg), <span class="at">e =</span> e) <span class="sc">%&gt;%</span> </span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">std_res =</span> e<span class="sc">-</span><span class="fu">mean</span>(e)<span class="sc">/</span><span class="fu">sd</span>(e)) <span class="sc">%&gt;%</span> </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pred, <span class="at">y=</span>std_res))<span class="sc">+</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Residual plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(multi_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            1             2             3             4             5 
 1.464611e+01  5.289263e+00  5.584679e+00  7.037454e+00  3.608036e+00 
            6             7             8             9            10 
 1.985552e+00 -8.754572e+00 -1.749372e+01  7.664846e+00  1.112734e+01 
           11            12            13            14            15 
-8.886284e+00 -5.950368e-01 -7.971200e+00 -4.102725e+00 -1.000781e+01 
           16            17            18            19            20 
-1.162514e+01 -1.990972e+00 -3.205605e+00  1.303487e+01  6.202794e+00 
           21            22            23            24            25 
 3.615196e+00  4.846652e+00 -3.856126e+00  3.367928e+00  5.348529e+00 
           26            27            28            29            30 
 1.330477e-01  7.740341e+00  6.156936e+00 -1.965234e+00  4.096807e+00 
           31            32            33            34            35 
 5.287002e+00  3.820502e+00  3.749188e+00  2.398193e+00  5.279463e+00 
           36            37            38            39            40 
 6.254664e+00  6.120866e+00  2.299079e+00 -3.587313e+00 -3.310216e+00 
           41            42            43            44            45 
-1.148042e+01  3.237985e-01 -7.419273e+00  1.523371e+01 -7.731950e+00 
           46            47            48            49            50 
-9.742576e+00 -7.075741e+00  6.417459e+00  4.712899e+00  1.051422e+00 
           51            52            53            54            55 
 6.877456e+00 -1.978291e-01 -9.675219e+00  1.159282e+00 -2.861415e+00 
           56            57            58            59            60 
-3.174471e+00  1.732670e+01 -1.756084e+01 -6.211992e-01  2.835457e-01 
           61            62            63            64            65 
 5.616260e+00  3.191487e-01  1.629842e+01  1.549308e+00 -1.654895e+01 
           66            67            68            69            70 
 5.756838e-01  4.774260e+00 -5.916827e+00 -4.465965e+00 -4.223007e+00 
           71            72            73            74            75 
-1.302566e+01 -6.656891e+00 -1.782055e-01  1.203521e+01 -6.926368e-01 
           76            77            78            79            80 
-1.315209e+00  1.707044e+01 -9.554328e+00  1.405483e+01 -1.124103e+01 
           81            82            83            84            85 
 1.347408e+01  3.653544e+00  8.336759e+00 -7.707107e+00 -1.973466e+00 
           86            87            88            89            90 
-2.614115e+00  9.505626e+00  1.172855e+01  4.826839e+00 -1.521388e+00 
           91            92            93            94            95 
 1.607625e+01 -1.881747e+01 -2.559083e+00 -3.759659e+00 -2.823496e+01 
           96            97            98            99           100 
-4.216926e-01  1.079936e+01 -3.783325e+00 -1.875713e+00  2.779999e+00 
          101           102           103           104           105 
 8.443410e+00  4.706186e+00 -1.120229e+01 -7.249894e+00 -5.407259e+00 
          106           107           108           109           110 
 1.896831e+00  8.826845e+00  1.533078e+01 -5.845668e+00 -4.293274e+00 
          111           112           113           114           115 
 1.051591e+01 -7.130426e+00  1.111906e+00 -3.526135e+00  2.990057e-01 
          116           117           118           119           120 
-1.276326e+00 -1.573889e+01 -1.454107e+01  4.134510e+00 -6.526999e+00 
          121           122           123           124           125 
 8.866556e+00 -5.973817e+00 -4.581864e+00  1.862102e+00 -1.896914e+01 
          126           127           128           129           130 
-1.399437e+01 -2.455074e+01 -1.202154e+01 -6.745784e+00  2.582514e-01 
          131           132           133           134           135 
-1.509460e+01 -1.602171e+01 -9.101141e+00 -1.634432e+01  2.483925e+00 
          136           137           138           139           140 
 5.065077e-01  2.606180e-01 -4.796135e+00 -1.385249e+01 -2.139830e+00 
          141           142           143           144           145 
 6.660789e+00 -1.160064e+01  3.281232e+00 -7.499475e-01 -1.386097e+01 
          146           147           148           149           150 
 1.378453e+00 -1.515573e+01 -1.113644e+01 -5.383198e+00 -1.275586e+01 
          151           152           153           154           155 
-1.353625e+01 -2.289078e+01  1.728919e+00  9.638651e+00 -8.606148e+00 
          156           157           158           159           160 
 6.232153e-01  3.371891e+00  1.123321e+01 -2.439709e+00 -3.134138e+00 
          161           162           163           164           165 
 8.589915e+00  1.250152e+00 -4.197177e+00  7.176327e+00 -6.600137e+00 
          166           167           168           169           170 
 8.533277e+00  1.185557e+01  9.400170e-01  1.913665e+01 -3.766905e+00 
          171           172           173           174           175 
 6.693044e+00 -8.604367e+00  8.227254e+00 -3.173759e+00 -1.614849e+00 
          176           177           178           179           180 
 3.322926e+00 -3.447778e+00  1.921419e+01  2.565521e+00  3.133533e+00 
          181           182           183           184           185 
-1.113843e+01 -4.768653e+00  7.908803e+00 -7.592292e+00  1.225538e+01 
          186           187           188           189           190 
-1.458826e+00  1.894057e+01  2.912150e+00 -3.181385e+00  1.304739e+00 
          191           192           193           194           195 
-1.036596e+01 -1.605006e+00 -3.544121e+00 -8.830601e+00  1.439657e+01 
          196           197           198           199           200 
-1.109933e+01 -4.630872e+00  7.860551e+00 -1.607605e+00  7.929576e+00 
          201           202           203           204           205 
-4.893844e+00 -3.018567e+00 -1.653602e+00  6.679036e+00  1.165399e+01 
          206           207           208           209           210 
 8.985939e+00  1.529890e+01  5.251195e+00 -5.236089e+00  1.262973e+01 
          211           212           213           214           215 
-1.322944e+00  5.976723e+00  1.047373e+01  1.468336e+01  7.577588e+00 
          216           217           218           219           220 
-4.483141e+00 -4.740517e+00  8.232406e+00  1.633525e+00  7.618143e+00 
          221           222           223           224           225 
 1.043562e+01  1.141952e+00 -1.210092e+01  1.209110e+01  1.026677e+00 
          226           227           228           229           230 
-2.689776e+01 -1.101197e+00  1.032840e+01  1.696575e-04  5.246993e+00 
          231           232           233           234           235 
-6.233729e+00 -1.188323e+01  2.947910e-01 -1.079247e+01 -2.769581e+00 
          236           237           238           239           240 
-2.817158e+00  2.569754e-01  5.715469e+00  5.959984e+00  4.975978e+00 
          241           242           243           244           245 
-1.058196e+01  1.448492e+01  2.407042e+00  9.013240e+00  1.019368e+01 
          246           247           248           249           250 
-3.894021e+00  8.289949e+00  2.432968e+00  1.298518e+00 -3.542520e+00 
          251           252           253           254           255 
 4.121420e+00 -5.230508e+00  1.000015e+01  1.045562e+00 -3.372357e-01 
          256           257           258           259           260 
 6.953755e+00 -6.146813e-01 -1.510889e+01  1.450384e+01  7.086483e-01 
          261           262           263           264           265 
 5.097991e+00  1.286177e+01  1.152238e+01 -1.787883e+01  1.073101e+00 
          266           267           268           269           270 
 9.976582e+00 -6.007817e+00  8.207588e+00 -2.971078e+00 -4.267351e+00 
          271           272           273           274           275 
 2.346540e+00 -9.303202e+00 -6.764640e+00  6.703586e+00 -8.090414e+00 
          276           277           278           279           280 
 5.571523e+00  8.991722e+00 -9.431718e-02 -2.823242e+00 -1.548472e+01 
          281           282           283           284           285 
-1.570965e+01  2.547295e+00 -1.096965e+00  8.584105e+00 -2.428398e+00 
          286           287           288           289           290 
-1.858950e+00  4.872135e+00  1.318715e+01 -8.215100e+00 -7.887702e+00 
          291           292           293           294           295 
 6.693970e+00  4.898462e+00  3.079510e+00  1.196576e+01  8.602001e+00 
          296           297           298           299           300 
 1.736276e+01  2.839133e+00 -7.785750e+00  5.963268e+00 -3.949401e+00 
          301           302           303           304           305 
-1.469661e-01  2.773601e+00  1.722393e+01  2.053459e+00 -1.387450e+01 
          306           307           308           309           310 
-1.255278e+01  3.686813e+00 -3.226000e-02  3.915990e+00 -8.452368e+00 
          311           312           313           314           315 
 2.407581e+01  7.400467e-01  5.471932e+00  5.867911e+00  3.625922e+00 
          316           317           318           319           320 
-1.369352e+01 -5.875756e+00 -4.388816e+00  1.073846e+01  3.644427e+00 
          321           322           323           324           325 
-8.237223e+00 -1.258111e-01 -6.550328e+00 -3.357262e+00 -8.862524e+00 
          326           327           328           329           330 
 3.888510e+00 -5.911123e+00  7.614737e+00 -7.380395e+00 -1.793324e+01 
          331           332           333           334           335 
-2.254069e+01 -2.482945e+01  6.681438e+00 -3.237436e+00  1.795627e+01 
          336           337           338           339           340 
-2.191286e+01 -1.235373e+00  1.038815e+01  8.568143e+00 -1.045839e+01 
          341           342           343           344           345 
 5.733146e+00  1.264150e+00 -1.861853e+01 -2.622233e+01 -6.521070e+00 
          346           347           348           349           350 
-1.707929e+00  6.099310e+00  7.193697e+00 -2.172905e+01 -3.651653e+00 
          351           352           353           354           355 
 1.719497e+01 -1.313025e+01  3.315028e+00 -1.751454e+00  4.259733e+00 
          356           357           358           359           360 
 7.863465e+00 -1.003020e+00  1.429642e+01  1.322123e+00  1.557339e+00 
          361           362           363           364           365 
 1.848948e+01  1.012432e+01  6.610770e-01  4.421404e+00 -6.125711e-01 
          366           367           368           369           370 
-4.657549e-01  1.081768e+01  6.222497e+00 -7.449398e+00 -9.831130e+00 
          371           372           373           374           375 
-1.503990e+01  2.770135e+00  1.719988e+01  8.965788e+00  1.189203e+01 
          376           377           378           379           380 
 6.894421e+00  3.538949e-01 -2.918056e+00 -7.803493e+00  1.366122e+01 
          381           382           383           384           385 
-1.546723e+01  6.281867e+00  6.753192e+00 -6.426494e+00  9.639718e+00 
          386           387 
-3.145901e+00  6.482992e+00 </code></pre>
</div>
</div>
</section>
<section id="normality" class="level3">
<h3 class="anchored" data-anchor-id="normality">Normality</h3>
<p>ข้อตกลงเบื้องต้นระบุอยู่บน noise ของโมเดล แสดงว่าถ้าต้องการตรวจสอบว่าโมเดลมีข้อตกลงเบื้องต้นนี้จริง ๆ ก็จะตรวจสอบผ่าน residual ได้เหมือนกัน</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fu">residuals</span>(multi_reg) <span class="sc">%&gt;%</span> </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">residual =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>residual))<span class="sc">+</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span><span class="fu">residuals</span>(multi_reg) <span class="sc">%&gt;%</span> </span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">residual =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> residual)) <span class="sc">+</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>()<span class="sc">+</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>()</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">/</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(multi_reg) <span class="sc">%&gt;%</span> <span class="fu">shapiro.test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  .
W = 0.99166, p-value = 0.02849</code></pre>
</div>
</div>
</section>
<section id="homogeneity-of-variance" class="level3">
<h3 class="anchored" data-anchor-id="homogeneity-of-variance">homogeneity of variance</h3>
<p>ความแปรปรวนของความคลาดเคลื่อนสุ่มมีความเป็นเอกพันธ์กันระหว่างกลุ่มของตัวแปรอิสระ</p>
</section>
<section id="homoscedasticity" class="level3">
<h3 class="anchored" data-anchor-id="homoscedasticity">homoscedasticity</h3>
<p>ความแปรปรวนของความคลาดเคลื่อนสุ่มมีความเป็นเอกพันธ์ในทุกค่า x ที่เป็นไปได้ (ในทุกระดับของค่าทำนายที่เป็นไปได้)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">ach_truth =</span> data<span class="sc">$</span>ach, <span class="at">pred =</span> <span class="fu">predict</span>(multi_reg), <span class="at">e =</span> e) <span class="sc">%&gt;%</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">std_res =</span> e<span class="sc">-</span><span class="fu">mean</span>(e)<span class="sc">/</span><span class="fu">sd</span>(e)) <span class="sc">%&gt;%</span> </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pred, <span class="at">y=</span>std_res))<span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)<span class="sc">+</span></span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Residual plot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span class="math display">\[
e_i = y_i - \hat{y}_i
\]</span></p>
<p>อยากหาความแปรปรวนของความคลาดเคลื่อนสุ่ม</p>
<p><span class="math display">\[
var(e) = \frac{\sum(e^2)}{n-1}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">ach_truth =</span> data<span class="sc">$</span>ach, <span class="at">pred =</span> <span class="fu">predict</span>(multi_reg), <span class="at">e =</span> e) <span class="sc">%&gt;%</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e2 =</span> e<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span>  <span class="do">## -- sufficient estimator of residual variance</span></span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pred, <span class="at">y=</span>e2))<span class="sc">+</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Breuch-Pagan Test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">ach_truth =</span> data<span class="sc">$</span>ach, <span class="at">pred =</span> <span class="fu">predict</span>(multi_reg), <span class="at">e =</span> e) <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e2 =</span> e<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(e2 <span class="sc">~</span> pred)) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = e2 ~ pred)

Residuals:
    Min      1Q  Median      3Q     Max 
-113.14  -69.86  -40.81   24.84  701.64 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 138.7443    19.1008   7.264 2.11e-12 ***
pred         -1.2445     0.4151  -2.998  0.00289 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 120 on 385 degrees of freedom
Multiple R-squared:  0.02282,   Adjusted R-squared:  0.02028 
F-statistic: 8.991 on 1 and 385 DF,  p-value: 0.00289</code></pre>
</div>
</div>
<p>White’s Test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">ach_truth =</span> data<span class="sc">$</span>ach, <span class="at">pred =</span> <span class="fu">predict</span>(multi_reg), <span class="at">e =</span> e) <span class="sc">%&gt;%</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e2 =</span> e<span class="sc">^</span><span class="dv">2</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(e2 <span class="sc">~</span> pred <span class="sc">+</span> <span class="fu">I</span>(pred<span class="sc">^</span><span class="dv">2</span>))) <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = e2 ~ pred + I(pred^2))

Residuals:
    Min      1Q  Median      3Q     Max 
-106.67  -71.30  -38.77   23.38  699.25 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) 108.06665   56.37206   1.917    0.056 .
pred          0.33310    2.75868   0.121    0.904  
I(pred^2)    -0.01800    0.03112  -0.578    0.563  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 120.2 on 384 degrees of freedom
Multiple R-squared:  0.02367,   Adjusted R-squared:  0.01858 
F-statistic: 4.655 on 2 and 384 DF,  p-value: 0.01006</code></pre>
</div>
</div>
</section>
<section id="no-multicollinearity" class="level3">
<h3 class="anchored" data-anchor-id="no-multicollinearity">No Multicollinearity</h3>
<p>ในการวิเคราะห์การถดถอยใช้การประมาณค่าพารามิเตอร์ด้วยระบบสมการหลายตัวแปร (simutaneous equation)</p>
<p>ตัวแปรอิสระในโมเดลจะต้องไม่มีความสัมพันธ์ิเชิงเส้นตรงต่อกันมากเกินไป การตรวจสอบข้อตกลงเบื้องต้นนี้สามารถทำได้หลายวิธีการ แต่ละวิธีการก็จะ based on การวิเคราะห์สหสัมพันธ์ระหว่างตัวแปรอิสระ</p>
<ul>
<li><p>correlation matrix ระหว่างตัวแปรอิสระ โดยปกติจะคัดกรองตัวแปรอิสระที่มีแนวโน้มจะมีปัญหาจาก cut-off ของค่า correlation ที่สูงเกินไป 0.7, 0.8, 0.9</p></li>
<li><p>ใช้ดัชนีที่เรียกว่าค่า VIF (variance inflation factor)</p></li>
</ul>
<p><span class="math display">\[
VIF_j = \frac{1}{1-R^2_j}
\]</span></p>
<p><span class="math inline">\(R^2_j\)</span> เป็นค่า R2 ที่คำนวณจากสมการถดถอย โดยตัวแปรตามเป็นตัวแปรอิสระตัวที่ j</p>
<p>โดยปกติการประเมินว่าในโมเดลการวิเคราะห์มีปัญหา multicollinearity หรือไม่จาก vif ก็จะมี cut-off ที่มาประกอบ 2, 4, 10, 20, …</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="do">## vif ach model</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(multi_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         GVIF Df GVIF^(1/(2*Df))
learning_performance 1.262982  1        1.123825
ontime_class         1.006740  1        1.003364
engage               1.178168  3        1.027704
practice             1.111233  1        1.054150</code></pre>
</div>
</div>
</section>
<section id="no-influential-outliers" class="level3">
<h3 class="anchored" data-anchor-id="no-influential-outliers">No influential outliers</h3>
<p>ค่าผิดปกติ</p>
<ul>
<li><p>anomaly data —&gt; anomaly detection</p></li>
<li><p>outlier ค่าสังเกตที่มีความแตกต่างไปจากค่าสังเกตโดยปกติ</p>
<ul>
<li><p>no influential outlier</p></li>
<li><p>influential outlier</p></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gdpPercap))<span class="sc">+</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp))<span class="sc">+</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()<span class="sc">+</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ellipse</span>(<span class="at">data =</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">filter</span>(lifeExp <span class="sc">&lt;</span> <span class="dv">60</span> <span class="sc">&amp;</span> gdpPercap <span class="sc">&gt;</span> <span class="dv">8000</span>),</span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x0 =</span> <span class="fu">mean</span>(gdpPercap), <span class="at">y0 =</span> <span class="fu">mean</span>(lifeExp), </span>
<span id="cb116-13"><a href="#cb116-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">a =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(gdpPercap), <span class="at">b =</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sd</span>(lifeExp), <span class="at">angle =</span> <span class="dv">0</span>),</span>
<span id="cb116-14"><a href="#cb116-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">'maroon'</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Leverage value คือ combination ของค่าสังเกตของตัวแปรอิสระที่ผิดปกติ กล่าวคือเป็น outlier ใน feature space ค่า leverage ไม่จำเป็นต้องมีผลต่อค่าของเส้นถดถอยเสมอไป มันเพียงแค่บอกว่าจุดนั้นอยู่ห่างไกลและมีศักยภาพที่จะส่งผลกระทบต่อโมเดล</li>
</ul>
<p><span class="math display">\[
h_{ii} = x_i^T (X^T X)^{-1} x_i
\]</span></p>
<p>ค่า <span class="math inline">\(h_{ii}\)</span></p>
<p>มีค่าอยู่ในช่วง [0,1] ถ้ามีค่าใกล้ 1.0 แสดงว่าค่าสังเกตของตัวแปรอิสระนั้นมีแนวโน้มอยู่ใกล้จากแนวโน้มส่วนใหญ่</p>
<ul>
<li>Influential observation คือค่าสังเกตที่มีอิทธิพลต่อการประมาณค่าพารามิเตอร์ในโมเดลมากกว่าปกติ การประเมินค่าสังเกตประเภทนี้ทำได้ด้วยสถิติ Cook’s distance</li>
</ul>
<p><span class="math display">\[
D_i = \frac{(e_i^2)}{p \cdot MSE} \left( \frac{h_{ii}}{(1 - h_{ii})^2} \right)
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp))<span class="sc">+</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year<span class="sc">==</span><span class="st">"2007"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gdpPercap <span class="sc">&lt;</span> <span class="dv">10000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> gdpPercap, <span class="at">y=</span>lifeExp))<span class="sc">+</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">/</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="กจกรรมตรวจสอบขอตกลงเบองตน" class="level3">
<h3 class="anchored" data-anchor-id="กจกรรมตรวจสอบขอตกลงเบองตน">กิจกรรมตรวจสอบข้อตกลงเบื้องต้น</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>teacher_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/choat/Documents/GitHub/datakruroo.github.io/Programming/regression/TeacherSalaryData.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>teacher_reg <span class="ot">&lt;-</span> teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(salary <span class="sc">~</span>. <span class="sc">-</span>id, <span class="at">data =</span> .))</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(teacher_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-52-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-52-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-52-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="linearity-1" class="level4">
<h4 class="anchored" data-anchor-id="linearity-1">linearity</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="at">pred =</span> <span class="fu">predict</span>(teacher_reg),</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="at">res =</span> <span class="fu">residuals</span>(teacher_reg)) <span class="sc">%&gt;%</span> </span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>pred, <span class="at">y=</span>res))<span class="sc">+</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()<span class="sc">+</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="at">pred =</span> <span class="fu">predict</span>(teacher_reg),</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="at">res =</span> <span class="fu">residuals</span>(teacher_reg)) <span class="sc">%&gt;%</span> </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> res))<span class="sc">+</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq</span>()<span class="sc">+</span></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-53-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="at">pred =</span> <span class="fu">predict</span>(teacher_reg),</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="at">res =</span> <span class="fu">residuals</span>(teacher_reg)) <span class="sc">%&gt;%</span> </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> res))<span class="sc">+</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-53-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>multi_reg <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-54-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-54-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-54-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>teacher_reg <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-54-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-54-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-54-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-54-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cooks.distance</span>(teacher_reg) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">cook =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cook <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          cook
250 0.05085794
331 0.06105387</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">250</span>,<span class="dv">331</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
     id rank  discipline yrs.since.phd yrs.service sex   salary
  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
1   250 Prof  A                     29           7 Male  204000
2   331 Prof  B                     49          60 Male  192253</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="regression-remedials" class="level2">
<h2 class="anchored" data-anchor-id="regression-remedials">Regression Remedials</h2>
<section id="linearity-2" class="level3">
<h3 class="anchored" data-anchor-id="linearity-2">Linearity</h3>
<ul>
<li><p>เพิ่ม polynomial หรือ interaction terms เพื่อเพิ่มความซับซ้อนของโมเดล</p></li>
<li><p>แปลงข้อมูลด้วยการใช้ log, square root, หรือการแปลงเชิงเส้นตรงแบบอื่น ๆ</p></li>
<li><p>ใช้ Multivariate Adaptive Regression Splines (MARs) Generalized Additive Models (GAMs) เพื่อจับความสัมพันธ์ที่ไม่เป็นเชิงเส้น</p></li>
</ul>
</section>
<section id="normality-1" class="level3">
<h3 class="anchored" data-anchor-id="normality-1">Normality</h3>
<ul>
<li><p>โดยส่วนเกือบใหญ่ปัญหา nonnormality มักเกิดจาก heteroscedasticity</p></li>
<li><p>ปัญหา heteroscedasticity ส่วนนึงที่เกือบใหญ่ เกิดจาก model ที่เลือกไม่สอดคล้องกับธรรมชาติของข้อมูล เช่น ลืม interaction term ที่สำคัญในโมเดล</p></li>
<li><p>เพิ่มตัวแปรอิสระหรือเทอมของตัวแปรอิสระที่อาจหายไปเพื่อปรับปรุงการกระจายของ residuals</p></li>
<li><p>แปลงข้อมูล (log-transformation, square root, Box-Cox) เพื่อให้ residuals เป็นปกติมากขึ้น</p></li>
<li><p>ใช้ robust regression เพื่อทนทานต่อผลกระทบของ outliers</p></li>
<li><p>bootstraping regression</p></li>
</ul>
<section id="log-transformation" class="level4">
<h4 class="anchored" data-anchor-id="log-transformation">log-transformation</h4>
<p>ตัวอย่างต่อไปนี้ทดลอง take-log ให้ตัวแปรตามคือ salary ในชุดข้อมูล teacher salary ลองพิจารณาเปรียบเทียบผลลัพธ์ที่ได้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="do">### log-transformation</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>teacher_reg_log <span class="ot">&lt;-</span> teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_salary =</span> <span class="fu">log</span>(salary)) <span class="sc">%&gt;%</span> </span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(log_salary <span class="sc">~</span>. <span class="sc">-</span>id, <span class="at">data =</span> .))</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>teacher_reg <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ . - id, data = .)

Residuals:
   Min     1Q Median     3Q    Max 
-65248 -13211  -1775  10384  99592 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    78862.8     4990.3  15.803  &lt; 2e-16 ***
rankAsstProf  -12907.6     4145.3  -3.114  0.00198 ** 
rankProf       32158.4     3540.6   9.083  &lt; 2e-16 ***
disciplineB    14417.6     2342.9   6.154 1.88e-09 ***
yrs.since.phd    535.1      241.0   2.220  0.02698 *  
yrs.service     -489.5      211.9  -2.310  0.02143 *  
sexMale         4783.5     3858.7   1.240  0.21584    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22540 on 390 degrees of freedom
Multiple R-squared:  0.4547,    Adjusted R-squared:  0.4463 
F-statistic:  54.2 on 6 and 390 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>teacher_reg_log <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = log_salary ~ . - id, data = .)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.199958 -0.014702  0.004479  0.021986  0.065011 

Coefficients:
                Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)    1.070e+01  9.306e-03 1149.336  &lt; 2e-16 ***
rankAsstProf  -5.200e-02  6.110e-03   -8.511 3.79e-16 ***
rankProf       4.209e-02  5.674e-03    7.417 7.57e-13 ***
disciplineB    1.818e-02  3.573e-03    5.087 5.66e-07 ***
yrs.since.phd -9.306e-04  3.531e-04   -2.636  0.00874 ** 
yrs.service   -5.766e-05  3.107e-04   -0.186  0.85286    
sexMale        7.862e-03  5.630e-03    1.397  0.16333    
salary         7.886e-06  7.373e-08  106.951  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.03282 on 389 degrees of freedom
Multiple R-squared:  0.9844,    Adjusted R-squared:  0.9841 
F-statistic:  3500 on 7 and 389 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>teacher_reg <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">main =</span> <span class="st">"Original Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-56-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-56-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-56-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>teacher_reg_log <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="at">main =</span> <span class="st">"Log-Transformed Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-56-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-56-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-56-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-56-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="box-cox-transformation" class="level4">
<h4 class="anchored" data-anchor-id="box-cox-transformation">Box-Cox Transformation</h4>
<p>ฟังก์ชันนี้จะพยายามช่วยเราหา lambda (power parameter) ที่ทำให้ log-likelihood ของโมเดลมีค่าสูงสุด</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Box-Cox transformation</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="do">### คำนวณ output</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>boxcox_res <span class="ot">&lt;-</span> <span class="fu">boxcox</span>(teacher_reg,  <span class="at">data=</span>teacher_data <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">id =</span> <span class="dv">1</span>),</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">lambda =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="fl">0.1</span>)) <span class="do">## box-cox power parameter</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="do">### ประเมินค่า lambda ที่ทำให้ log-likelihood มีค่าสูงสุด</span></span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">lambda =</span> boxcox_res<span class="sc">$</span>x, </span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">log_likelihood =</span> boxcox_res<span class="sc">$</span>y) <span class="sc">%&gt;%</span> </span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(log_likelihood <span class="sc">==</span> <span class="fu">max</span>(log_likelihood))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      lambda log_likelihood
1 -0.8282828      -491.7217</code></pre>
</div>
</div>
<p>เมื่อได้ค่า lambda จะนำค่า lambda นี้ไปใช้ในการ transform ตัวแปรตาม เราสามารถเขียนสูตรเองก็ได้ ดูสูตรจากในนี้ –&gt; <a href="https://www.statisticshowto.com/probability-and-statistics/normal-distributions/box-cox-transformation/">https://www.statisticshowto.com/probability-and-statistics/normal-distributions/box-cox-transformation/</a></p>
<p>หรือใช้ฟังก์ชันสำเร็จรูปช่วยในการคำนวณจาก library-car</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>teacher_data<span class="sc">$</span>salary <span class="sc">%&gt;%</span> <span class="fu">hist</span>()</span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">bcPower</span>(teacher_data<span class="sc">$</span>salary, <span class="at">lambda =</span> <span class="sc">-</span><span class="fl">0.8282828</span>) <span class="sc">%&gt;%</span> <span class="fu">hist</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>ลองไป fit multiple regression ใหม่</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>teacher_reg_bc <span class="ot">&lt;-</span> teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">salary_bc =</span> car<span class="sc">::</span><span class="fu">bcPower</span>(teacher_data<span class="sc">$</span>salary, <span class="at">lambda =</span> <span class="sc">-</span><span class="fl">0.8282828</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>salary) <span class="sc">%&gt;%</span> </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(salary_bc <span class="sc">~</span>. <span class="sc">-</span>id, <span class="at">data=</span>.))</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>teacher_reg_bc <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary_bc ~ . - id, data = .)

Residuals:
       Min         1Q     Median         3Q        Max 
-5.505e-05 -6.282e-06 -1.010e-07  7.931e-06  3.345e-05 

Coefficients:
                Estimate Std. Error    t value Pr(&gt;|t|)    
(Intercept)    1.207e+00  2.583e-06 467271.476  &lt; 2e-16 ***
rankAsstProf  -1.263e-05  2.146e-06     -5.884 8.61e-09 ***
rankProf       2.045e-05  1.833e-06     11.157  &lt; 2e-16 ***
disciplineB    9.221e-06  1.213e-06      7.602 2.20e-13 ***
yrs.since.phd  1.534e-07  1.248e-07      1.229   0.2197    
yrs.service   -2.499e-07  1.097e-07     -2.277   0.0233 *  
sexMale        3.449e-06  1.998e-06      1.727   0.0850 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.167e-05 on 390 degrees of freedom
Multiple R-squared:  0.5655,    Adjusted R-squared:  0.5588 
F-statistic: 84.59 on 6 and 390 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>teacher_reg_bc <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-59-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-59-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-59-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><p>จะเห็นว่าปัญหาหายไปเกือบหมดนอกจาก nonnormality แล้วยังช่วยแก้ปัญหา heteroscedasticity อีกด้วย สะท้อนว่าปัญหาทั้งสองมีความสัมพันธ์กันจริง ๆ</p></li>
<li><p>แต่การแปลผล coefficient ของ regression ให้มีความหมายทำได้ค่อนข้างยาก</p></li>
</ul>
</section>
<section id="เพม-interaction-term-ในโมเดล" class="level4">
<h4 class="anchored" data-anchor-id="เพม-interaction-term-ในโมเดล">เพิ่ม interaction term ในโมเดล</h4>
<p>บางครั้งปัญหา nonnormality เกิดจากการละเมิดข้อตกลงเบื้องต้นข้ออื่นโดยเฉพาะ heteroscedasticity และสาเหตุของการเกิด heteroscedasticity บางครั้งก็เกิดจาก misspecification ของโมเดล เช่น การละเลย iteraction term ที่สำคัญ ดังนั้นหากมีเหตุผลหรือข้อมูล support การเพิ่ม interaction term ที่เหมาะสมอาจช่วยให้โมเดลมีคุณสมบัติที่ดีขึ้น</p>
<p>รูปด้านล่างแสดงให้เห็นว่าการเพิ่ม interaction มีแนวโน้มจะลดปัญหา heteroscedasticity ได้บ้าง เพราะเรามีโมเดลที่ซับซ้อนขึ้น และมีความสามารถในการทำนาย/อธิบายหน่วยข้อมูลคืออาจารย์มหาวิทยาลัยที่มีประสบกาณ์ทำงานสูงได้ดีขึ้นบ้างแต่ก็ไม่ได้ดีมากในกรณีนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>yrs.since.phd, <span class="at">y=</span>salary))<span class="sc">+</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span> <span class="st">"lm"</span>, <span class="fu">aes</span>(<span class="at">col =</span> discipline))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>ทดลองใส่ interaction term ลงในโมเดล อย่างไรก็ตามการแก้ปัญหาในกรณีนี้ไม่ได้มีผลอะไรมากเท่าไหร่</p>
<p>ืnote: การวิเคราะห์ด้านล่างเน้นโชว์ให้ดูความแตกต่างระหว่างโมเดลที่มีกับไม่มี interaction ดังนั้นการใส่ตัวแปรแบบนี้ไม่ได้ makesense</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="do">## witjout interaction</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(salary <span class="sc">~</span> yrs.since.phd <span class="sc">+</span> discipline <span class="sc">+</span> rank<span class="sc">+</span>sex <span class="sc">-</span>id, <span class="at">data =</span> .)) <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="do">## with interaction</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">id =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">lm</span>(salary <span class="sc">~</span> yrs.since.phd<span class="sc">*</span>discipline<span class="sc">*</span>rank<span class="sc">*</span>sex <span class="sc">-</span>id, <span class="at">data =</span> .)) <span class="sc">%&gt;%</span> <span class="fu">plot</span>(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-61-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="homoscedasticity-1" class="level3">
<h3 class="anchored" data-anchor-id="homoscedasticity-1">Homoscedasticity</h3>
<ul>
<li><p>แปลงค่าตัวแปรตาม (เช่น log, square root) เพื่อลดความแปรปรวน</p></li>
<li><p>ควรหาสาเหตุของการละเมิด hetero ว่าเกิดจาก misspecification ส่วนไหนรึเปล่า —&gt; ลืม interaction term ที่สำคัญ</p></li>
<li><p>ใช้ Weighted Least Squares (WLS), Generalized Least Squares (GLS), เพื่อปรับน้ำหนักให้กับจุดข้อมูลที่มีความแปรปรวนต่างกัน</p></li>
<li><p>ใช้ heteroscedasticity-robust standard errors เพื่อปรับ standard errors ของโมเดล</p></li>
</ul>
<section id="robust-standard-error" class="level4">
<h4 class="anchored" data-anchor-id="robust-standard-error">Robust Standard Error</h4>
<p>ดังที่ได้กล่าวไว้ในคาบเรียนว่า ปัญหา nonnormality และ heteroscedasticity มีความสัมพันธ์กันและทั้งสองปัญหามีผลกระทบต่อการอนุมานเชิงสถิติของโมเดล ได้แก่ การทดสอบสมมุติฐาน และการประมาณช่วงความเชื่อมั่นของค่าพารามิเตอร์ต่าง ๆ</p>
<ul>
<li><p>nonnormality อาจทำให้ sampling distribution ของสถิติทดสอบ t-test และ F-test สำหรับ regression รวมทั้ง linear model ไม่เป็นไปตามทฤษฎีควบคุม type I error ที่ต้องการไม่ได้</p></li>
<li><p>heteroscedasticity ทำให้การประมาณค่า MSE ของโมเดลคลาดเคลื่อนค่าประมาณที่ได้ไม่เป็นตัวแทนของความแปรปรวรของความคลาดเคลื่อนสุ่มของโมเดล ค่า MSE เป็นส่วนประกอบสำคัญในการประมาณค่า standard error ของค่าประมาณพารามิเตอร์ในโมเดล ปัญหาดังกล่าวจึงกระทบโดยตรงต่อการอนุมานเชิงสถิติ</p></li>
</ul>
<p>การแก้ปัญหา heteroscedasticity ในเชิงที่มองว่ามันทำให้การประมาณค่า standard error คลาดเคลื่อนคือการใช้สูตรการประมาณ standard error ใหม่เราเรียกมันว่า robust standard error เมื่อประมาณ SE ได้ดีขึ้น การอนุมานภายใต้การละเมิดข้อตกลงเบื้องต้นนี้ก็จะมีความถูกต้องมากขึ้นไปด้วย</p>
<p>การอนุมานเชิงสถิติด้วย robust standard error ใน R สามารถทำได้ดังนี้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="do">##install.packages("sandwich")</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="do">##install.packages("lmtest")</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>?coef.coeftest <span class="do">## &lt;-- ลองเรียก help แล้วอ่านดู ตัวประมาณ robust SE มักเรียกว่า sandwich estimator เพราะมีการสอดไส้ในสูตรการประมาณ SE เหมือนทำ sandwich</span></span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>?vcovHC <span class="do">## &lt;-- อ่านอันนี้ด้วย</span></span>
<span id="cb145-7"><a href="#cb145-7" aria-hidden="true" tabindex="-1"></a>teacher_reg <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ . - id, data = .)

Residuals:
   Min     1Q Median     3Q    Max 
-65248 -13211  -1775  10384  99592 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    78862.8     4990.3  15.803  &lt; 2e-16 ***
rankAsstProf  -12907.6     4145.3  -3.114  0.00198 ** 
rankProf       32158.4     3540.6   9.083  &lt; 2e-16 ***
disciplineB    14417.6     2342.9   6.154 1.88e-09 ***
yrs.since.phd    535.1      241.0   2.220  0.02698 *  
yrs.service     -489.5      211.9  -2.310  0.02143 *  
sexMale         4783.5     3858.7   1.240  0.21584    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22540 on 390 degrees of freedom
Multiple R-squared:  0.4547,    Adjusted R-squared:  0.4463 
F-statistic:  54.2 on 6 and 390 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>teacher_reg <span class="sc">%&gt;%</span> <span class="fu">coeftest</span>(., <span class="at">vcov =</span> <span class="fu">vcovHC</span>(., <span class="at">type =</span> <span class="st">"HC1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

               Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)    78862.82    3869.22 20.3821 &lt; 2.2e-16 ***
rankAsstProf  -12907.59    2205.67 -5.8520  1.03e-08 ***
rankProf       32158.41    2324.74 13.8331 &lt; 2.2e-16 ***
disciplineB    14417.63    2316.31  6.2244  1.25e-09 ***
yrs.since.phd    535.06     312.46  1.7124   0.08762 .  
yrs.service     -489.52     306.82 -1.5955   0.11142    
sexMale         4783.49    2395.92  1.9965   0.04657 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>ผลการวิเคราะห์ข้างต้นจะเห็นว่าเมื่อใช้ robust SE จะมีการปรับการคำนวณทำให้ SE ที่ได้แตกต่างออกไป นัยสำคัญที่วิเคราะห์ได้ก็จะแตกต่างไปจากเดิม</p>
<p>การแก้ปัญหาด้วยวิธีนี้เป็นการแก้ปัญหาเฉพาะเจาะจงไม่ได้แก้ปัญหาอย่างเป็นระบบหรือที่สาเหตุของปัญหาอย่างแท้จริง โดยปกติมักใช้เมื่อเราจะไม่วิเคราะห์โมเดลอื่นแล้ว และวัตถุประสงค์หลักเป็นการอนุมานเกี่ยวกับพารามิเตอร์ของโมเดลเป็นหลัก</p>
</section>
</section>
<section id="multicollinearity" class="level3">
<h3 class="anchored" data-anchor-id="multicollinearity">Multicollinearity</h3>
<p>ปัญหานี้เกิดเมื่อตัวแปรอิสระในโมเดลมีความสัมพันธ์ซึ่งกันและกันสูงเกินไป ส่งผลต่อความเสถียรหรือความน่าเชื่อถือของค่าพารามิเตอร์ regression coefficient ในโมเดล รวมไปถึงการอนุมานเชิงสถิติด้วย ปัญหานี้ร้ายแรงหากตรวจพบควรแก้ไขให้ได้</p>
<p>การแก้ปัญหาสามารถทำได้หลายวิธีการ ได้แก่</p>
<section id="ลบตวแปรอสระทมคา-vif-มากเกนไป-และสงผลกระทบตอการวเคราะห" class="level4">
<h4 class="anchored" data-anchor-id="ลบตวแปรอสระทมคา-vif-มากเกนไป-และสงผลกระทบตอการวเคราะห">ลบตัวแปรอิสระที่มีค่า VIF มากเกินไป และส่งผลกระทบต่อการวิเคราะห์</h4>
<p>ตัวอย่างด้านล่างแสดงการลบตัวแปรออกจากโมเดลจะเห็นว่าค่าพารามิเตอร์ที่เกี่ยวข้องมีการเปลี่ยนแปลงอย่างมากเมื่อมีการลบตัวแปรออกไป สะท้อนปัญหา multicollinearity ที่ค่อนข้างรุนแรง</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>teacher_reg_no_phd <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">-</span>yrs.since.phd, <span class="at">data =</span> teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                           dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>teacher_reg_no_ser <span class="ot">&lt;-</span> <span class="fu">lm</span>(salary <span class="sc">~</span> . <span class="sc">-</span>yrs.service, <span class="at">data =</span> teacher_data <span class="sc">%&gt;%</span> </span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                           dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>))</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(teacher_reg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ . - id, data = .)

Residuals:
   Min     1Q Median     3Q    Max 
-65248 -13211  -1775  10384  99592 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    78862.8     4990.3  15.803  &lt; 2e-16 ***
rankAsstProf  -12907.6     4145.3  -3.114  0.00198 ** 
rankProf       32158.4     3540.6   9.083  &lt; 2e-16 ***
disciplineB    14417.6     2342.9   6.154 1.88e-09 ***
yrs.since.phd    535.1      241.0   2.220  0.02698 *  
yrs.service     -489.5      211.9  -2.310  0.02143 *  
sexMale         4783.5     3858.7   1.240  0.21584    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22540 on 390 degrees of freedom
Multiple R-squared:  0.4547,    Adjusted R-squared:  0.4463 
F-statistic:  54.2 on 6 and 390 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(teacher_reg_no_phd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ . - yrs.since.phd, data = teacher_data %&gt;% 
    dplyr::select(-1))

Residuals:
   Min     1Q Median     3Q    Max 
-64202 -14255  -1533  10571  99163 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   82912.07    4668.39  17.760  &lt; 2e-16 ***
rankAsstProf -14560.40    4098.32  -3.553 0.000428 ***
rankProf      34599.24    3382.52  10.229  &lt; 2e-16 ***
disciplineB   13473.38    2315.50   5.819 1.24e-08 ***
yrs.service     -88.78     111.64  -0.795 0.426958    
sexMale        4771.25    3878.00   1.230 0.219311    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22650 on 391 degrees of freedom
Multiple R-squared:  0.4478,    Adjusted R-squared:  0.4407 
F-statistic: 63.41 on 5 and 391 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(teacher_reg_no_ser)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = salary ~ . - yrs.service, data = teacher_data %&gt;% 
    dplyr::select(-1))

Residuals:
   Min     1Q Median     3Q    Max 
-67451 -13860  -1549  10716  97023 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    80988.47    4931.84  16.422  &lt; 2e-16 ***
rankAsstProf  -13104.15    4167.31  -3.145  0.00179 ** 
rankProf       32928.40    3544.40   9.290  &lt; 2e-16 ***
disciplineB    13937.47    2346.53   5.940 6.32e-09 ***
yrs.since.phd     61.01     127.01   0.480  0.63124    
sexMale         4349.37    3875.39   1.122  0.26242    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22660 on 391 degrees of freedom
Multiple R-squared:  0.4472,    Adjusted R-squared:  0.4401 
F-statistic: 63.27 on 5 and 391 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(teacher_reg_no_ser)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  GVIF Df GVIF^(1/(2*Df))
rank          1.987205  2        1.187301
discipline    1.055727  1        1.027486
yrs.since.phd 2.065517  1        1.437191
sex           1.028359  1        1.014080</code></pre>
</div>
</div>
<p>อย่างไรก็ตาม regression coeffcient ของ yrs.service ยังมีค่าติดลบ ข้อสังเกตนี้สะท้อนว่าอาจมีปัญหาอื่นเกี่ยวกับการระบุโมเดลที่ผิดพลาดได้ เช่น อาจลืมตัวแปรอิสระที่สำคัญ หรือ interaction term เป็นต้น</p>
</section>
<section id="ทำ-feature-extraction-รวมผสาน-ตวแปรอสระทมแนวโนมจะเกดปญหา-multi-เขาดวยกนเปนตวแปรใหม" class="level4">
<h4 class="anchored" data-anchor-id="ทำ-feature-extraction-รวมผสาน-ตวแปรอสระทมแนวโนมจะเกดปญหา-multi-เขาดวยกนเปนตวแปรใหม">ทำ feature extraction รวม/ผสาน ตัวแปรอิสระที่มีแนวโน้มจะเกิดปัญหา multi เข้าด้วยกันเป็นตัวแปรใหม่</h4>
<p>วิธีการนี้คือการสร้างตัวแปรใหม่ที่รวมตัวแปรอิสระที่มีความสัมพันธ์สูง ๆ เข้าด้วยกัน เช่น การหาค่าเฉลี่ย การบวก หรือการใช้อัลกอริทึมเช่น PCA เข้ามาช่วย เรียกกระบวนการนี้รวม ๆ ว่าการสกัดตัวแปร (feature extraction)</p>
<p>การรวมตัวแปรด้วยตัวผู้วิเคราะห์ควรพิจารณาเหตุผลในเชิงทฤษฎี หรืออย่างน้อยก็ดูว่าเมื่อนำตัวแปรสองตัวหรือมากกว่านั้นมารวมกัน จะแปลความหมายของตัวแปรใหม่ได้อย่างไร เช่น เงินเดือนพ่อ + เงินเดือนแม่ = รายได้ต่อเดือนของครอบครัว หรือ จำนวนครู/ห้องเรียน = อัตราส่วนครูต่อห้องเรียน</p>
<p>ส่วนการรวมด้วยอัลกอริทึม เช่น PCA การแปลความหมายตัวแปรใหม่ (องค์ประกอบหลัก) จะพิจารณาจากค่าสถิติ การใช้ PCA ในการวิเคราะห์ regression จะเรียกโมเดลการวิเคราะห์นี้ว่า PCR หรือ Principal component regression นอกจากนี้ยังมีวิธีการอื่นในคล้ายกับ PCR เช่น PLS == partial least square regression อีกด้วย</p>
<p>การทำ PCR สามารถทำได้ง่าย ๆ คือ</p>
<ol type="1">
<li><p>ทำ PCA กับตัวแปรอิสระทั้งหมด แล้วคัดเลือกองค์ประกอบหลักที่จำเป็น</p></li>
<li><p>แปลความหมายองค์ประกอบหลักที่เลือกมาให้ได้</p></li>
<li><p>ประมาณ factor score หรือ component score แล้วเอาคะแนนดังกล่าวไปเป็นตัวแปรอิสระใน regression model</p></li>
</ol>
</section>
</section>
<section id="no-influential-ouliers" class="level3">
<h3 class="anchored" data-anchor-id="no-influential-ouliers">No Influential Ouliers</h3>
<p>อย่างที่บอกในห้องเรียนว่า outlier ที่มีอิทธิพลสูงอาจบิดเบือนการประมาณค่าสัมประสิทธิ์ต่าง ๆ ในการวิเคราะห์การถดถอย การวิเคราะห์และตรวจจับค่าสังเกตที่มีอิทธิพลจะช่วยให้ผู้วิเคราะห์ทราบสถานะของค่าสังเกตในชุดข้อมูลว่า</p>
<ol type="1">
<li><p>ค่าใดมีแนวโน้มจะเป็นค่าผิดปกติ (ผิดปกติใน y หรือ x)</p></li>
<li><p>ค่าผิดปกติใดมีอิทธิพลต่อการประมาณในโมเดล</p></li>
</ol>
<p>เมื่อคัดกรองค่าผิดปกติที่มีอิทธิพลได้แล้ว ผู้วิเคราะห์ควรลองวิเคราะห์เปรียบเทียบว่าการมี หรือไม่มีค่าสังเกตที่ผิดปกติดังกล่าว ทำให้การประมาณค่าพารามิเตอร์ในโมเดลหรือประสิทธิภาพการทำนายของโมเดลมีการเปลี่ยนแปลงไปมากแค่ไหน มีนัยสำคัญต่อการวิเคราะห์หรือไม่ แล้วจึงพิจารณาว่าจะแก้หรือไม่แก้ปัญหาดังกล่าว</p>
<p>การแก้ปัญหาค่าผิดปกติที่มีอิทธิพลนี้สามารถทำได้หลัก ๆ อาจจะ 3 วิธีการ</p>
<ol type="1">
<li><p>ลบหรือปรับค่าสังเกตที่ถูกระบุว่าเป็น influential outiers อันนี้ง่าย ๆ คัดกรองค่าที่มี cook’s distance สูงเกินเกณฑ์ที่กำหนด และลบออก</p></li>
<li><p>ทำ bining กล่าวคือหาก influential outlier ที่เกิดขึ้น เกิดขึ้นในตัวแปรอิสระเราอาจแปลงค่าตัวแปรอิสระเชิงปริมาณให้เป็นตัวแปรจัดประเภท โดยการแบ่งค่าที่เป็นไปได้ออกเป็นอันครภาคชั้น วิธีการนี้ช่วยลดผลกระทบของ influential outlier ได้อย่างมีนัยสำคัญ</p></li>
<li><p>มองค่าผิดปกติดังกล่าวเป็น missing value จากนั้น impute มันด้วย algorithm ที่เหมาะสม</p></li>
<li><p>ใช้ Robust Regression เช่น quantile regression ที่มีความไวต่อค่าผิดปกติน้อยกว่า</p></li>
</ol>
<p>… อื่น ๆ</p>
</section>
</section>
<section id="model-selection" class="level2">
<h2 class="anchored" data-anchor-id="model-selection">Model Selection</h2>
<p>ในบริบทของการวิเคราะห์การถดถอย โดยปกติการคัดเลือกโมเดลส่วนหลัก ๆ จะเกี่ยวข้องกับการคัดเลือกตัวแปรอิสระเข้าสู่โมเดล และอีกส่วนหนึ่งคือการกำหนด functional form ของโมเดล ในบทเรียนนี้จะกล่าวถึงส่วน feature selection</p>
<p>การทำ feature selection คือการคัดกรองตัวแปรที่ไม่มีสาระสำคัญหรือมีความสำคัญน้อยในการพัฒนาโมเดลออกไป</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD

F1--&gt;X1((X))
F2--&gt;A[F2]
F3--&gt;B[F3]
F4--&gt;X2((X))
F5--&gt;X3((X))
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>การคัดเลือกตัวแปรอิสระเข้าสู่โมเดลมีหลายขั้นตอน อาจจะจำแนกออกเป็นสองประเภทใหญ่ ได้แก่ theory-driven และ data-driven โดยที่ theory-driven จะใช้ความรู้ที่มีอยู่จากงานวิจัยหรือทฤษฎีที่เกี่ยวข้องเพื่อกำหนดและคัดเลือกตัวแปร ในขณะที่ data-driven จะใช้ข้อมูลที่มีอยู่เพื่อคัดเลือกตัวแปรอิสระที่มีความเหมาะสมและมีประสิทธิภาพในการทำนายเข้าสู่โมเดล</p>
<ul>
<li><p>filter methods</p></li>
<li><p>wrapper methods</p></li>
<li><p>embedded methods</p></li>
</ul>
<section id="กจกรรมท-1-ทำลองวเคราะหการถดถอย" class="level3">
<h3 class="anchored" data-anchor-id="กจกรรมท-1-ทำลองวเคราะหการถดถอย">กิจกรรมที่ 1 ทำลองวิเคราะห์การถดถอย</h3>
<p>ลองทำ regression analysis เพื่อสร้างโมเดลทำนาย student_outcome_online แล้วพิจารณาผลลัพธ์ที่ได้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>large_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"/Users/choat/Downloads/onlinelearning_miss.csv"</span>)</span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>large_data <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 50
$ ...1                                       &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, …
$ X                                          &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, …
$ `ประเภทสถานศึกษา`                           &lt;chr&gt; "โรงเรียนมัธยมศึกษา", "โรงเรียน…
$ `ที่ตั้งสถานศึกษา`                              &lt;chr&gt; "กลาง", "กลาง", "กลาง", "กล…
$ `จำนวนรายวิชาที่ลงทะเบียน`                     &lt;dbl&gt; 8, 8, 8, 7, 7, 7, 8, 7, 8, …
$ `จำนวนรายวิชาonline`                        &lt;dbl&gt; 4, 8, 8, 7, 7, 7, 3, 7, 1, …
$ `จำนวนรายวิชาonsite`                        &lt;dbl&gt; 4, 0, 0, 0, 0, 0, 5, 0, 7, …
$ `ระดับความพร้อมสถานศึกษา`                     &lt;dbl&gt; 1, 3, 2, 3, 2, 2, 3, 3, 3, …
$ videoConference                            &lt;dbl&gt; 0, 1, 1, 0, 0, 0, 1, 0, 1, …
$ Live                                       &lt;dbl&gt; 0, 1, 1, 1, 0, 0, 0, 1, 0, …
$ LMS                                        &lt;dbl&gt; 1, 1, 0, 1, 1, 1, 1, 1, 0, …
$ groupChat                                  &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 1, 0, 1, …
$ email                                      &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 1, …
$ collapApps                                 &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ clipVideo                                  &lt;dbl&gt; 0, 1, 1, 1, 0, 1, 1, 1, 1, …
$ `อายุเฉลี่ยผู้สอน`                              &lt;dbl&gt; 1, 1, 2, 1, 1, 1, 1, 1, 1, …
$ `ภาพรวมความสามารถในการใช้สื่อเทคโนโลยีของผู้สอน` &lt;dbl&gt; 2, 2, 3, 3, 2, 3, 3, 3, 3, …
$ climate.online1                            &lt;dbl&gt; 3, 5, 3, 5, 5, 4, 4, NA, 3,…
$ climate.online2                            &lt;dbl&gt; 3, 5, 2, 5, 3, 5, 5, 5, 2, …
$ climate.online3                            &lt;dbl&gt; 2, 3, 5, 5, NA, NA, 5, 3, 3…
$ climate.onsite1                            &lt;dbl&gt; 1, 4, 5, 2, 4, 3, 1, 5, NA,…
$ climate.onsite2                            &lt;dbl&gt; 1, 2, 3, 4, 5, 3, 1, 5, 1, …
$ climate.onsite3                            &lt;dbl&gt; 1, 3, NA, 2, 4, 2, 1, 5, 1,…
$ `เพศผู้เรียน`                                 &lt;dbl&gt; 2, 1, 2, 1, 1, 2, 1, 1, 1, …
$ `ระดับชั้น`                                   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ `ภูมิลำเนา`                                  &lt;chr&gt; "กลาง", "กลาง", "กลาง", "กล…
$ `สไตล์การเรียนที่ชอบ`                          &lt;dbl&gt; 2, 2, 2, 1, 1, 2, 1, 1, 2, …
$ smartphone                                 &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ ipad                                       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, …
$ computer                                   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ `ความพร้อมของinternet`                      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, …
$ `บรรยากาศที่พักอาศัย`                          &lt;dbl&gt; 1, 1, 1, 1, NA, 2, 1, 1, 1,…
$ `ความสามารถผู้เรียนในการใช้เทคโนโลยี`           &lt;dbl&gt; 1, 1, 2, 1, 2, 2, 1, 1, 2, …
$ `ความคิดเห็นต่อการเรียน`                       &lt;dbl&gt; 1, 2, 2, 3, 3, 3, 3, 2, 3, …
$ interaction.online1                        &lt;dbl&gt; 2, 3, 3, 2, 2, 3, 3, 4, NA,…
$ interaction.online2                        &lt;dbl&gt; NA, 3, 3, 2, 2, 2, 3, 3, 3,…
$ interaction.online3                        &lt;dbl&gt; 2, 3, 3, NA, 3, 3, 3, 3, 3,…
$ interaction.onsite1                        &lt;dbl&gt; 1, 2, 2, 2, 2, 3, 2, 2, 2, …
$ interaction.onsite2                        &lt;dbl&gt; 1, 2, 2, 2, 2, 1, 2, 2, 2, …
$ interaction.onsite3                        &lt;dbl&gt; 2, 2, 1, 2, 2, 2, 2, 2, 2, …
$ `ความเครียดขณะเรียนonline`                   &lt;dbl&gt; 5, 5, 1, 4, 5, 4, 2, 5, 5, …
$ `ความเครียดขณะเรียนonsite`                   &lt;dbl&gt; 1, 3, 3, 5, 1, NA, 5, 3, 4,…
$ outcome.online1                            &lt;dbl&gt; 2, 3, 2, 1, 2, 2, 1, 2, 2, …
$ outcome.online2                            &lt;dbl&gt; 2, 2, 2, 1, 2, 2, 1, 5, 2, …
$ outcome.online3                            &lt;dbl&gt; 1, 2, 3, 2, 1, 1, 2, 3, 1, …
$ outcome.online4                            &lt;dbl&gt; 39.75234, 46.50444, 40.6486…
$ outcome.onsite1                            &lt;dbl&gt; 1, 2, 1, 3, 1, 1, 2, 3, 3, …
$ outcome.onsite2                            &lt;dbl&gt; 1, 1, 1, 2, 2, 2, 1, 2, 2, …
$ outcome.onsite3                            &lt;dbl&gt; 1, 1, 1, 2, 1, 1, 1, 2, 1, …
$ outcome.onsite4                            &lt;dbl&gt; 41.34332, 22.67131, 43.0961…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>large_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="do">### ปรับชื่อตัวแปรใหม่</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">student_id =</span> X,</span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">school_type =</span> <span class="dv">2</span>,</span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">school_location =</span> <span class="dv">3</span>,</span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">num_subject =</span> <span class="dv">4</span>,</span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">num_online =</span> <span class="dv">5</span>,</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">num_onsite =</span> <span class="dv">6</span>,</span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">school_readiness =</span> <span class="dv">7</span>,</span>
<span id="cb159-10"><a href="#cb159-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">avg_teacher_age =</span> <span class="dv">15</span>,</span>
<span id="cb159-11"><a href="#cb159-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">avg_teacher_techcomp =</span> <span class="dv">16</span>,</span>
<span id="cb159-12"><a href="#cb159-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_gender =</span> <span class="dv">23</span>,</span>
<span id="cb159-13"><a href="#cb159-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_level =</span> <span class="dv">24</span>,</span>
<span id="cb159-14"><a href="#cb159-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_location =</span> <span class="dv">25</span>,</span>
<span id="cb159-15"><a href="#cb159-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_learningstyle =</span> <span class="dv">26</span>,</span>
<span id="cb159-16"><a href="#cb159-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_internet_readiness =</span> <span class="dv">30</span>,</span>
<span id="cb159-17"><a href="#cb159-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_home_climate =</span> <span class="dv">31</span>,</span>
<span id="cb159-18"><a href="#cb159-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_techcomp =</span> <span class="dv">32</span>,</span>
<span id="cb159-19"><a href="#cb159-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_learning_attitude =</span> <span class="dv">33</span>,</span>
<span id="cb159-20"><a href="#cb159-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_stress_online =</span> <span class="dv">40</span>,</span>
<span id="cb159-21"><a href="#cb159-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_stress_onsite =</span> <span class="dv">41</span></span>
<span id="cb159-22"><a href="#cb159-22" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb159-23"><a href="#cb159-23" aria-hidden="true" tabindex="-1"></a><span class="do">### สร้างตัวแปรใหม่</span></span>
<span id="cb159-24"><a href="#cb159-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb159-25"><a href="#cb159-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb159-26"><a href="#cb159-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_climate_online =</span> <span class="fu">mean</span>(<span class="fu">c</span>(climate.online1, climate.online2, climate.online3)),</span>
<span id="cb159-27"><a href="#cb159-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_climate_onsite =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"climate.onsite"</span>))),</span>
<span id="cb159-28"><a href="#cb159-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_interaction_online =</span> <span class="fu">mean</span>(<span class="fu">c</span>(interaction.online1, interaction.online2, interaction.online3)),</span>
<span id="cb159-29"><a href="#cb159-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_interaction_onsite =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"interaction.onsite"</span>))),</span>
<span id="cb159-30"><a href="#cb159-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_outcome_online =</span> (outcome.online1<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> outcome.online2<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> outcome.online3<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span>outcome.online4)<span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb159-31"><a href="#cb159-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_outcome_onsite =</span> (outcome.onsite1<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> outcome.onsite2<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> outcome.onsite3<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span>outcome.onsite4)<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb159-32"><a href="#cb159-32" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span></span>
<span id="cb159-33"><a href="#cb159-33" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"interaction"</span>), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"outcome"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb159-34"><a href="#cb159-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"climate"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb159-35"><a href="#cb159-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">student_num_device =</span> <span class="fu">sum</span>(<span class="fu">c</span>(smartphone,ipad,computer),<span class="at">na.rm =</span> T))  <span class="sc">%&gt;%</span> </span>
<span id="cb159-36"><a href="#cb159-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,000 × 36
   student_id school_type     school_location num_subject num_online num_onsite
        &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;                 &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1          1 โรงเรียนมัธยมศึกษา กลาง                      8          4          4
 2          2 โรงเรียนมัธยมศึกษา กลาง                      8          8          0
 3          3 โรงเรียนมัธยมศึกษา กลาง                      8          8          0
 4          4 โรงเรียนมัธยมศึกษา กลาง                      7          7          0
 5          5 โรงเรียนมัธยมศึกษา กลาง                      7          7          0
 6          6 โรงเรียนมัธยมศึกษา กลาง                      7          7          0
 7          7 โรงเรียนมัธยมศึกษา กลาง                      8          3          5
 8          8 โรงเรียนมัธยมศึกษา กลาง                      7          7          0
 9          9 โรงเรียนมัธยมศึกษา กลาง                      8          1          7
10         10 โรงเรียนมัธยมศึกษา กลาง                      8          8          0
# ℹ 990 more rows
# ℹ 30 more variables: school_readiness &lt;dbl&gt;, videoConference &lt;dbl&gt;,
#   Live &lt;dbl&gt;, LMS &lt;dbl&gt;, groupChat &lt;dbl&gt;, email &lt;dbl&gt;, collapApps &lt;dbl&gt;,
#   clipVideo &lt;dbl&gt;, avg_teacher_age &lt;dbl&gt;, avg_teacher_techcomp &lt;dbl&gt;,
#   student_gender &lt;dbl&gt;, student_level &lt;dbl&gt;, student_location &lt;chr&gt;,
#   student_learningstyle &lt;dbl&gt;, smartphone &lt;dbl&gt;, ipad &lt;dbl&gt;, computer &lt;dbl&gt;,
#   student_internet_readiness &lt;dbl&gt;, student_home_climate &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>ผลการวิเคราะห์ที่ได้มีข้อสังเกตอะไรบ้าง</p>
</section>
<section id="filter-methods" class="level3">
<h3 class="anchored" data-anchor-id="filter-methods">Filter Methods</h3>
<p>Filter Methods เป็นหนึ่งในเทคนิคการคัดเลือกตัวแปร (Feature Selection) ที่ใช้ คุณสมบัติทางสถิติของตัวแปร ในการคัดกรองตัวแปรที่มีความสำคัญต่อการสร้างโมเดล โดยกระบวนการนี้จะไม่พึ่งพาโมเดลใด ๆ ในการประเมิน แต่จะใช้สถิติพื้นฐาน เช่น ความสัมพันธ์ (correlation) ระหว่างตัวแปรอิสระกับตัวแปรตาม และค่าสถิติอื่น ๆ เช่น Chi-square, ANOVA, Mutual Information เพื่อกรองตัวแปรที่มีความสำคัญสูงไว้</p>
<ul>
<li><p>filter zero or near-zero variance</p></li>
<li><p>correlation-based filtering</p></li>
</ul>
<p>จุดเด่นของวิธีการนี้คือทำได้อย่างรวดเร็ว แต่เป็นการวิเคราะห์ที่อาจจะละเลยความสัมพันธ์ที่ซับซ้อนระหว่างตัวแปรอิสระกับตัวแปรตาม นอกจากนี้ผลลัพธ์ที่ได้อาจจะไม่ได้เป็นผลลัพธ์ที่ดีที่สุดที่เป็นไปได้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="do">### create predictor matrix</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>use_data <span class="ot">&lt;-</span> large_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a><span class="do">### ปรับชื่อตัวแปรใหม่</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">student_id =</span> X,</span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">school_type =</span> <span class="dv">2</span>,</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">school_location =</span> <span class="dv">3</span>,</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">num_subject =</span> <span class="dv">4</span>,</span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">num_online =</span> <span class="dv">5</span>,</span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">num_onsite =</span> <span class="dv">6</span>,</span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">school_readiness =</span> <span class="dv">7</span>,</span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">avg_teacher_age =</span> <span class="dv">15</span>,</span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">avg_teacher_techcomp =</span> <span class="dv">16</span>,</span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_gender =</span> <span class="dv">23</span>,</span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_level =</span> <span class="dv">24</span>,</span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_location =</span> <span class="dv">25</span>,</span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_learningstyle =</span> <span class="dv">26</span>,</span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_internet_readiness =</span> <span class="dv">30</span>,</span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_home_climate =</span> <span class="dv">31</span>,</span>
<span id="cb161-19"><a href="#cb161-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_techcomp =</span> <span class="dv">32</span>,</span>
<span id="cb161-20"><a href="#cb161-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_learning_attitude =</span> <span class="dv">33</span>,</span>
<span id="cb161-21"><a href="#cb161-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_stress_online =</span> <span class="dv">40</span>,</span>
<span id="cb161-22"><a href="#cb161-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_stress_onsite =</span> <span class="dv">41</span></span>
<span id="cb161-23"><a href="#cb161-23" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span> </span>
<span id="cb161-24"><a href="#cb161-24" aria-hidden="true" tabindex="-1"></a><span class="do">### สร้างตัวแปรใหม่</span></span>
<span id="cb161-25"><a href="#cb161-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb161-26"><a href="#cb161-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb161-27"><a href="#cb161-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_climate_online =</span> <span class="fu">mean</span>(<span class="fu">c</span>(climate.online1, climate.online2, climate.online3)),</span>
<span id="cb161-28"><a href="#cb161-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_climate_onsite =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"climate.onsite"</span>))),</span>
<span id="cb161-29"><a href="#cb161-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_interaction_online =</span> <span class="fu">mean</span>(<span class="fu">c</span>(interaction.online1, interaction.online2, interaction.online3)),</span>
<span id="cb161-30"><a href="#cb161-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_interaction_onsite =</span> <span class="fu">rowMeans</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"interaction.onsite"</span>))),</span>
<span id="cb161-31"><a href="#cb161-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_outcome_online =</span> (outcome.online1<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> outcome.online2<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> outcome.online3<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span>outcome.online4)<span class="sc">/</span><span class="dv">4</span>,</span>
<span id="cb161-32"><a href="#cb161-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">student_outcome_onsite =</span> (outcome.onsite1<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> outcome.onsite2<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span> outcome.onsite3<span class="sc">*</span><span class="dv">20</span> <span class="sc">+</span>outcome.onsite4)<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb161-33"><a href="#cb161-33" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">%&gt;%</span></span>
<span id="cb161-34"><a href="#cb161-34" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"interaction"</span>), <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"outcome"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb161-35"><a href="#cb161-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"climate"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb161-36"><a href="#cb161-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">student_num_device =</span> <span class="fu">sum</span>(<span class="fu">c</span>(smartphone,ipad,computer),<span class="at">na.rm =</span> T))  <span class="sc">%&gt;%</span> </span>
<span id="cb161-37"><a href="#cb161-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>แบ่งชุดข้อมูล online learning</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>online_data <span class="ot">&lt;-</span> use_data <span class="sc">%&gt;%</span> </span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"onsite"</span>))</span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(online_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 31
$ student_id                 &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, …
$ school_type                &lt;chr&gt; "โรงเรียนมัธยมศึกษา", "โรงเรียนมัธยมศึกษา", "โรงเ…
$ school_location            &lt;chr&gt; "กลาง", "กลาง", "กลาง", "กลาง", "กลาง", "กล…
$ num_subject                &lt;dbl&gt; 8, 8, 8, 7, 7, 7, 8, 7, 8, 8, 8, 9, 8, 9, 8…
$ num_online                 &lt;dbl&gt; 4, 8, 8, 7, 7, 7, 3, 7, 1, 8, 0, 9, 1, 8, 5…
$ school_readiness           &lt;dbl&gt; 1, 3, 2, 3, 2, 2, 3, 3, 3, 3, 1, 3, 1, 3, 2…
$ videoConference            &lt;dbl&gt; 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1…
$ Live                       &lt;dbl&gt; 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1…
$ LMS                        &lt;dbl&gt; 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0…
$ groupChat                  &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1…
$ email                      &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0…
$ collapApps                 &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1…
$ clipVideo                  &lt;dbl&gt; 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0…
$ avg_teacher_age            &lt;dbl&gt; 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ avg_teacher_techcomp       &lt;dbl&gt; 2, 2, 3, 3, 2, 3, 3, 3, 3, 3, 3, 3, 2, 2, 3…
$ student_gender             &lt;dbl&gt; 2, 1, 2, 1, 1, 2, 1, 1, 1, 2, 1, 1, 2, 1, 2…
$ student_level              &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ student_location           &lt;chr&gt; "กลาง", "กลาง", "กลาง", "กลาง", "กลาง", "กล…
$ student_learningstyle      &lt;dbl&gt; 2, 2, 2, 1, 1, 2, 1, 1, 2, 2, 1, 1, 2, 1, 2…
$ smartphone                 &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1…
$ ipad                       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0…
$ computer                   &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1…
$ student_internet_readiness &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ student_home_climate       &lt;dbl&gt; 1, 1, 1, 1, NA, 2, 1, 1, 1, 1, 1, 1, 2, 1, …
$ student_techcomp           &lt;dbl&gt; 1, 1, 2, 1, 2, 2, 1, 1, 2, 1, 2, 1, 1, 3, 2…
$ student_learning_attitude  &lt;dbl&gt; 1, 2, 2, 3, 3, 3, 3, 2, 3, 1, 3, 2, 1, 2, 3…
$ student_stress_online      &lt;dbl&gt; 5, 5, 1, 4, 5, 4, 2, 5, 5, 5, 1, 1, 3, 2, 2…
$ student_climate_online     &lt;dbl&gt; 2.666667, 4.333333, 3.333333, 5.000000, NA,…
$ student_interaction_online &lt;dbl&gt; NA, 3.000000, 3.000000, NA, 2.333333, 2.666…
$ student_outcome_online     &lt;dbl&gt; 34.93808, 46.62611, 45.16217, 28.26696, 34.…
$ student_num_device         &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 3, 2, 0, 2, 2, 2, 3, 2…</code></pre>
</div>
</div>
<section id="near-zero-variance" class="level4">
<h4 class="anchored" data-anchor-id="near-zero-variance">Near-Zero Variance</h4>
<p>สร้างชุดข้อมูล predictor matrix ของ online learning</p>
<ul>
<li><p><code>freqCut</code> เปรียบเทียบความถี่ของค่าที่พบมากที่สุดกับค่าที่พบมากที่สุดเป็นอันดับสอง เพื่อดูว่าคอลัมน์นั้นมีการกระจายตัวของค่ามากน้อยเพียงใด</p></li>
<li><p><code>uniqueCut</code> เปรียบเทียบจำนวนค่าที่ไม่ซ้ำกันกับจำนวนตัวอย่างทั้งหมดในคอลัมน์</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>predictor_online <span class="ot">&lt;-</span> online_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>student_outcome_online)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages("caret")</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a><span class="fu">nearZeroVar</span>(predictor_online, <span class="at">freqCut =</span> <span class="dv">95</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">uniqueCut =</span> <span class="dv">10</span>, <span class="at">saveMetrics =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           freqRatio percentUnique zeroVar   nzv
student_id                  1.000000         100.0   FALSE FALSE
school_type                 1.277904           0.2   FALSE FALSE
school_location             1.400000           0.4   FALSE FALSE
num_subject                 1.242424           0.8   FALSE FALSE
num_online                  1.282895           1.1   FALSE FALSE
school_readiness            1.142384           0.5   FALSE FALSE
videoConference             1.873563           0.2   FALSE FALSE
Live                        1.500000           0.2   FALSE FALSE
LMS                         1.237136           0.2   FALSE FALSE
groupChat                   3.081633           0.2   FALSE FALSE
email                       1.070393           0.2   FALSE FALSE
collapApps                  1.840909           0.2   FALSE FALSE
clipVideo                   1.118644           0.2   FALSE FALSE
avg_teacher_age             1.061162           0.3   FALSE FALSE
avg_teacher_techcomp        1.000000           0.3   FALSE FALSE
student_gender              1.188184           0.2   FALSE FALSE
student_level               2.660606           0.5   FALSE FALSE
student_location            1.697161           0.4   FALSE FALSE
student_learningstyle       1.041475           0.3   FALSE FALSE
smartphone                  9.326316           0.2   FALSE FALSE
ipad                        3.139241           0.2   FALSE FALSE
computer                   18.816327           0.2   FALSE FALSE
student_internet_readiness  3.358407           0.2   FALSE FALSE
student_home_climate        2.127796           0.2   FALSE FALSE
student_techcomp            1.333333           0.3   FALSE FALSE
student_learning_attitude   1.702422           0.3   FALSE FALSE
student_stress_online       1.080508           0.5   FALSE FALSE
student_climate_online      1.054054           1.3   FALSE FALSE
student_interaction_online  1.028986           1.3   FALSE FALSE
student_num_device          3.463918           0.4   FALSE FALSE</code></pre>
</div>
</div>
</section>
<section id="correlation-based-method" class="level4">
<h4 class="anchored" data-anchor-id="correlation-based-method">Correlation-based method</h4>
</section>
</section>
<section id="wrapper-methods" class="level3">
<h3 class="anchored" data-anchor-id="wrapper-methods">Wrapper Methods</h3>
<ul>
<li><p>สร้างโมเดลทำนายหลายชุด: ทดลองชุดของตัวแปรหลายชุด โดยเลือกเพิ่มหรือลบตัวแปรทีละตัว</p></li>
<li><p>ใช้เกณฑ์การประเมินโมเดลเช่น AIC, BIC, AUC, F1-score, RMSE, MAE, หรือค่าสถิติอื่น ๆ ในการประเมินความสามารถของโมเดล</p></li>
<li><p>เลือกชุดตัวแปรที่ดีที่สุด: ชุดตัวแปรที่ให้ประสิทธิภาพดีที่สุดจะถูกเลือกเพื่อใช้ในการสร้างโมเดลสุดท้าย</p></li>
</ul>
<section id="best-subset-regression" class="level4">
<h4 class="anchored" data-anchor-id="best-subset-regression">Best Subset Regression</h4>
<ul>
<li><p>วิธีการหนึ่งที่ใช้ค้นหาโมเดลที่ดีที่สุดคือ best subset regression ซึ่งจะทำการสร้างโมเดลทุกโมเดลที่เป็นไปได้จากตัวแปรอิสระที่มี จากนั้นเปรียบเทียบ empirical fit ระหว่างโมเดลดังกล่าว</p></li>
<li><p>อย่างไรก็ตามวิธีการดังกล่าวจะใช้ทรัพยากรค่อนข้างเยอะ เพราะจะต้องสร้างโมเดลจากทุกความเป็นไปได้ ยกตัวอย่างเช่น หากมีตัวแปรอิสระทั้งหมด p ตัว โมเดลที่มีเฉพาะ main effect ที่เป็นไปได้จะมีทั้งหมด 2^p โมเดล เทคนิคนี้จึงเหมาะสำหรับสถานการณ์ที่มีข้อมูลที่ขนาดไม่ใหญ่มากเกินไป</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("leaps")</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaps)</span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>reg_model <span class="ot">&lt;-</span> <span class="fu">regsubsets</span>(student_outcome_online <span class="sc">~</span> . <span class="sc">-</span>student_id, <span class="at">data=</span>online_data , <span class="at">nbest =</span><span class="dv">1</span>, <span class="at">nvmax =</span> <span class="dv">10</span>,</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">method =</span> <span class="st">"exhaustive"</span>)</span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(reg_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>ข้อมูลตัวอย่างสำหรับหัวข้อนี้คือ TeacherSalaryData.csv</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"TeacherSalaryData.csv"</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 397
Columns: 7
$ ...1          &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1…
$ rank          &lt;chr&gt; "Prof", "Prof", "AsstProf", "Prof", "Prof", "AssocProf",…
$ discipline    &lt;chr&gt; "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "B", "…
$ yrs.since.phd &lt;dbl&gt; 19, 20, 4, 45, 40, 6, 30, 45, 21, 18, 12, 7, 1, 2, 20, 1…
$ yrs.service   &lt;dbl&gt; 18, 16, 3, 39, 41, 6, 23, 45, 20, 18, 8, 2, 1, 0, 18, 3,…
$ sex           &lt;chr&gt; "Male", "Male", "Male", "Male", "Male", "Male", "Male", …
$ salary        &lt;dbl&gt; 139750, 173200, 79750, 115000, 141500, 97000, 175000, 14…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="do">### visualize numeric variables</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>p1<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(is.numeric) <span class="sc">%&gt;%</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(value))<span class="sc">+</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>)<span class="sc">+</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a><span class="do">### visualize categorical variables</span></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>p2<span class="ot">&lt;-</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_if</span>(is.character) <span class="sc">%&gt;%</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value))<span class="sc">+</span></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>)<span class="sc">+</span></span>
<span id="cb169-16"><a href="#cb169-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scales =</span> <span class="st">"free"</span>)<span class="sc">+</span></span>
<span id="cb169-17"><a href="#cb169-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span>
<span id="cb169-18"><a href="#cb169-18" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">/</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="regression_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>