---
title: "Diagnostic Analytics"
subtitle: "Why did this happen?"
author: "ผศ.ดร.สิวะโชติ ศรีสุทธิยากร"
institute: "ภาควิชาวิจัยและจิตวิทยาการศึกษา <br> คณะครุศาสตร์ จุฬาลงกรณ์มหาวิทยาลัย"
date: 2024-09-30
format:
  revealjs:
    margin: 0.1 # ตัวอย่างของการตั้งค่า margin เป็น 10%
    code-fold: false
    slide-number: c/t
    footer: "2758501 สถิติและสารสนเทศทางการศึกษา <br>
            ผศ.ดร.สิวะโชติ ศรีสุทธิยากร"
    logo: https://github.com/ssiwacho/picture/blob/main/datakruroo.png?raw=true
    theme: theme.scss
    css: my_css.css
    scrollable: true
    transition: fade
    background-transition: fade
    highlight-style: github
    mermaid:
      theme: default
    title-slide-attributes:
      data-background-image: https://d2jx2rerrg6sh3.cloudfront.net/image-handler/ts/20221007084404/ri/1000/src/images/Article_Images/ImageForArticle_23176_16651466437256686.jpg
      data-background-opacity: 20%
      data-background-size: full
code-link: true
execute:
  echo: false
  message: false
  freeze: auto
  progress: true
---

## Type of Data Analytics

```{r echo = F}
library(tidyverse)
data <- read_csv("/Users/choat/Documents/GitHub/datakruroo.github.io/Programming/dimensionality_reduction/learning_data_secondary.csv")
```

![](https://datakruroo.github.io/IPST/PPT/img/typeofanalytic.png)

# Outline

- Introduction to Diagnostic Analytics

- Process in Diagnostic Analysis

- Identify the Problem

- Frame the Problem

- Analyze & Validate Causes

# Introduction to Diagnostic Analytics


## What's Diagnostic Analysis? {.smaller}

- การวิเคราะห์เชิงวินิจฉัย (Diagnostic Analytics) คือ กระบวนการวิเคราะห์ข้อมูล เพื่อระบุ สาเหตุหรือปัจจัยที่มีความสัมพันธ์กับปัญหาหรือสถานการณ์ที่เกิดขึ้น


- เป็นขั้นตอนต่อเนื่องจากการใช้การวิเคราะห์เชิงพรรณนา (Descriptive Analytics)


:::: {.columns}

::: {.column width=50%}

![](img/sale_down.jpg){width="70%"}

![](img/images.jpeg)
:::

::: {.column width=50%}

![](img/health.jpg)
:::

::::


## Diagnostic Analysis in Classroom {.smaller}

- การวิเคราะห์ข้อมูลเพื่อระบุสาเหตุหรือปัจจัยที่มีความสัมพันธ์กับปัญหาหรือสถานการณ์ที่เกิดขึ้นในห้องเรียน

- ครูมะเป็นผู้รับผิดชอบสอนรายวิชาสถิติให้กับนักเรียนชั้นมัธยมศึกษา โดยในช่วงแรกของการจัดการเรียนรู้ นักเรียนจะได้รับมอบหมายให้ทำการบ้านเกี่ยวกับหัวข้อที่เรียนไป เมื่อผ่านไป 3 สัปดาห์ครูมะปรางได้เริ่มนำข้อมูลคะแนนการบ้านของนักเรียนมาวิเคราะห์ (คะแนนเต็ม 20 คะแนน) ด้านล่างนี้แสดงผลการวิเคราะห์ของครูมะปราง

```{r fig.width = 10, fig.height = 4, echo = F}
exam_data <- read_csv("student-por.csv")
exam_data %>% select(G1, G2, G3) %>% 
  rename(quiz1 = G1, quiz2 = G2, quiz3 = G3) %>%
  pivot_longer(cols = everything(), names_to = "quiz", values_to = "score") %>%
  ggplot(aes(x = score))+
  geom_histogram(bins = 20, col = "white")+
  facet_wrap(~quiz)
```


## Diagnostic Analysis in Classroom {.smaller}

- การประเมินแนวโน้มความสำเร็จหรือล้มเหลวของผู้เรียนในการเรียนรู้

- ระบุตัวนักเรียนที่มีความเสี่ยงในการเรียนรู้

- ออกแบบการสนับสนุนนักเรียนที่มีความเสี่ยงแบบเฉพาะบุคคล


:::: {.columns}

::: {.column width="50%"}

![](img/paper.png){width="80%"}

:::

::: {.column width="50%"}
![](img/tree.png){width="60%"}
:::

::::


<div class="caption">https://onlinelibrary.wiley.com/doi/epdf/10.1111/emip.12470</div>


<br>



## Diagnostic Analysis in Classroom{.smaller}

:::: {.columns}

::: {.column width="50%"}


![](img/bully.jpg)

:::

::: {.column width="50%"}

![](img/network1.png)

![](img/network2.png)
:::

::::


## Process in Diagnistic Analysis {.smaller}

![](img/ASA_framwork1.png)

<div class="caption">https://www.amstat.org/asa/files/pdfs/GAISE/GAISEIIPreK-12_Full.pdf</div>

## Process in Diagnostic Analysis {.smaller}

ลักษณะสำคัญคือเป็นกระบวนการที่มีลักษณะสืบเสาะและทวนซ้ำกัน

:::: {.columns}

::: {.column width="70%"}

<center>

```{mermaid}
%% | echo: false

stateDiagram-v2
    direction LR
    classDef yourState font-style:italic,font-weight:bold,fill:white

[*] --> A
A: Identify \n the Problem
A --> B
B: Frame \n the Problem
B --> C
C: Analyze & \n Validate Causes
C --> D
D: Develop and \n Implement \n Solutions
D --> E
E: Monitoring and \n Evaluation
E --> A: Not Success
E --> [*]: Success
```

</center>

:::

::: {.column width="30%"}

![](img/PAOR1.png){width="80%"}

:::

::::

<div style="font-size: 80%;">

- Identify the Problem: ระบุปัญหาหรือสิ่งที่ต้องการวิเคราะห์เพื่อวินิจฉัย

- Frame the Problem: ระบุสาเหตุหรือปัจจัยที่สัมพันธ์กับปัญหา เป็นการสร้างกรอบการวิเคราะห์/ตั้งสมมุติฐานเกี่ยวกับสาเหตุหรือปัจจัยที่เกี่ยวข้องกับปัญหา

- Analysis & Validate Causes: เก็บรวบรวมข้อมูลตามกรอบและวิเคราะห์ข้อมูลเพื่อระบุสาเหตุหรือปัจจัยที่สัมพันธ์กับปัญหา

- Develop and Implement Solutions: ออกแบบวิธีการแก้ปัญหาและนำไปปฏิบัติ

- Monitoring and Evaluation: ติดตามและประเมินผลการปฏิบัติตามวิธีการแก้ปัญหาที่นำไปปฏิบัติ

</div>

<div class="caption">https://www.siteware.co/blog/methodologies/what-is-the-pdca-cycle/</div>


## Identify the Problem {.smaller}

<br>
<br>
<br>

<center>
```{mermaid}
%% | echo: false

stateDiagram-v2
    direction LR
    classDef yourState font-style:italic,font-weight:bold,fill:white

[*] --> A
A: Identify \n the Problem
A:::yourState --> B
B: Frame \n the Problem
B --> C
C: Analyze & \n Validate Causes
C --> D
D: Develop and \n Implement \n Solutions
D --> E
E: Monitoring and \n Evaluation
E --> A: Not Success
E --> [*]: Success
```

</center>

## Identify the Problem {.smaller}


:::: {.columns}

::: {.column width="30%"}


<center>
```{mermaid}
%% | echo: false

stateDiagram-v2

[*] --> A
A --> B
B --> C
C --> [*]


A: <b>Preliminary Data</b>
B: <b>Descriptive Analysis</b>
C: <b>Define Problems</b>
```
</center>
:::

::: {.column width="70%"}

ข้อมูล quiz ของนักเรียนที่เรียนรายวิชาคณิตศาสตร์

```{r echo = F, fig.height = 4}
p <- data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  #mutate_at(vars(starts_with("quiz")), scale) %>% 
  pivot_longer(cols = -stu_id, names_to = "quiz", values_to = "score") %>%
  ggplot(aes(x=score))+
  geom_histogram(bins =20, fill = "steelblue", col ="white")+
  geom_violin(aes(y = 0), bw = 0.5, width = 10, alpha = 0.4)+
  geom_boxplot(aes(y = 0), vjust = 2, width = 2)+
  facet_wrap(~quiz, scales = "free_x")+
  theme_light()
p
```
<div style="font-size: 80%;">

```{r echo = F}
data %>% 
  select(quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  summary()
```

</div>

:::

::::

<br>

## Identify the Problem {.smaller}


:::: {.columns}

::: {.column width="30%"}


<center>
```{mermaid}
%% | echo: false

stateDiagram-v2

[*] --> A
A --> B
B --> C
C --> [*]


A: <b>Preliminary Data</b>
B: <b>Descriptive Analysis</b>
C: <b>Define Problems</b>
```
</center>
:::

::: {.column width="70%"}

ข้อมูล quiz ของนักเรียนที่เรียนรายวิชาคณิตศาสตร์

```{r echo = F, fig.height = 4}
p <- data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  #mutate_at(vars(starts_with("quiz")), scale) %>% 
  pivot_longer(cols = -stu_id, names_to = "quiz", values_to = "score") %>%
  ggplot(aes(x=score))+
  geom_histogram(bins =20, fill = "steelblue", col ="white")+
  geom_violin(aes(y = 0), bw = 0.5, width = 10, alpha = 0.4)+
  geom_boxplot(aes(y = 0), vjust = 2, width = 2)+
  facet_wrap(~quiz, scales = "free_x")+
  theme_light()
p
```

:::

::::


อะไรเป็นปัญหาของผู้เรียนกลุ่มนี้บ้าง ?

<div style="font-size: 70%;">

- มัธยฐานของ quiz ครั้งที่ 1 และ 3 ค่อนข้างต่ำ

- ทุก quiz มีนักเรียนที่สอบได้ 0 คะแนนหรือใกล้เคียงเป็นจำนวนที่ค่อนข้างมาก

- quiz 1 และ 2 เหมือนจะมีการแจกแจงแบบสองฐานนิยม 

- ในขณะที่ quiz 3 มีแนวโน้มจะมีฐานนิยมเดียวแต่มัธยฐานและ quartile ที่ 3 ค่อนข้างต่ำ

</div>


## Identify the Problem with Generative AI {.smaller}

- เป็นไปได้ว่าบางกรณีเราสามารถแบ่งผลการวิเคราะห์จาก descriptive statistics ได้แต่ไม่สามารถระบุปัญหาหรือสาเหตุได้ ในกรณีนี้เราสามารถใช้ Generative AI เพื่อช่วยระบุปัญหา (รวมทั้งสาเหตุของปัญหา) ที่อาจเป็นไปได้

- Gen AI คือปัญญาประดิษฐ์ประเภทหนึ่งที่มีความสามารถหลักในการสร้างเนื้อหา (content) ที่หลากหลาย

  - ข้อความ (text)

  - ภาพ (image)

  - วิดีโอ (video)

  - เสียง (audio)


## Generative AI {.smaller}



:::: {.columns}

::: {.column width="50%"}

![](https://datakruroo.github.io/ChatGPT/img/Screenshot%202567-09-20%20at%2019.29.02.png)

![](img/chatgpt1.png){width="90%"}

:::

::: {.column width="50%"}


![](img/chatgpt2.png){width="100%"}


:::

::::

## Generative AI {.smaller}

:::: {.columns}

::: {.column width="50%"}

![](https://datakruroo.github.io/ChatGPT/img/cat1.png)

:::

::: {.column width="50%"}
![](https://datakruroo.github.io/ChatGPT/img/cat2.png)
:::

::::

## Hallucinations {.smaller}



![](img/chatgpt3.png){width="40%"}

<div style="font-size: 90%;">

- Gen AI ในปัจจุบันสร้าง content โดย based on โมเดลความน่าจะเป็น (probabilistic model) 

- การกำหนด prompt ที่ไม่เหมาะสมอาจทำให้เกิดปัญหาที่เรียกว่า hallucinations หรือการสร้างเนื้อหาที่ไม่เป็นจริง

  - ผลลัพธ์ที่ไม่มีพื้นฐานจากข้อมูลที่ถูกต้องหรือเป็นจริง ซึ่งอาจเป็นข้อมูลที่เข้าใจผิดหรือไม่เกี่ยวข้องกับคำถามหรือข้อมูลนำเข้าที่ได้รับ
  
  - บางสถานการณ์ AI อาจให้คำตอบที่ดูเหมือนจะถูก/สมเหตุสมผล หรืออาจจะถูกจริง ๆ แต่ไม่ตรงกับสิ่งที่ผู้ใช้ต้องการ
  
</div>

## Hallucinations {.smaller}

![](img/chatgpt4.png)



## Prompt Design {.smaller}

<div style="font-size: 70%;">

- โดยทั่วไป Generative AI เช่น ChatGPT ถูกฝึกสอนจากฐานข้อมูลขนาดใหญ่มากอยู่แล้ว ดังนั้นในแต่ละ prompt ที่ป้อนเข้าไปจึงมีความเป็นไปได้จำนวนมากของคำตอบ

- Prompt Design คือกระบวนการสร้างคำสั่ง/ข้อมูลนำเข้าสำหรับ Generative AI ที่นำไปสู่การสร้างผลลัพธ์ที่มีความถูกต้อง/สมเหตุสมผล/ตรงกับความต้องการ

</div>

```{mermaid}
%%| echo: false
%%| fig-align: "center"


flowchart LR
subgraph  
B["Task"]-->A(("Prompt"))
C["Context"]-->A(("Prompt"))
end
D["Fine-Tuning"]-.->B
D["Fine-Tuning"]-.->C
```

<div style="font-size: 70%;">


- **Task** คืองานที่ต้องการให้ Chat GPT ทำ ซึ่งอาจอยู่ในรูปของประโยคคำถาม คำ
สั่ง หรือข้อความที่ไม่สมบูรณ์เพื่อให้โมเดลเขียนต่อ

- **Context** คือบริบทหรือข้อมูลเพิ่มเติมสำหรับประกอบการสร้างผลลัพธ์ของโมเดล

- **Fine-Tuning** คือการปรับปรุงคำตอบของโมเดลเพื่อให้มีความแม่นยำ สอดคล้องกับบริบทและเหมาะสมกับความต้องการของผู้ใช้มากขึ้น ผ่านการพิมพ์โต้ตอบกับผู้ใช้

</div>

## Prompt Design: Task


::: {.columns}

:::: {.column width="50%"}

- Describe, Explain

- Classify

- Summarize, Group

- List, Suggest

- Write, Rewrite, Generate

- Design

- Creat

- Ideate

::::


:::: {.column width="50%"}

- Give

- Prepare

- Compare

- Translation

- Correct

- Break down

- What?

- How?

::::


:::



## Prompt = Task + Context {.smaller background-color="black"}

::: {.columns}

:::: {.column width="50%"}

**Task Only**
![](img/Screenshot%202567-09-20%20at%2020.00.11.png){width=80%}

::::

:::: {.column width="50%"}

**Task with Context**
![](img/Screenshot%202567-09-20%20at%2020.01.39.png){width=70%}


::::

:::

## Fine-Tuning Prompt {.smaller background-color="black"}


::: {.columns}

:::: {.column width="50%"}

![](img/Screenshot%202567-09-20%20at%2020.15.21.png)
::::

:::: {.column width="50%"}

![](img/Screenshot%202567-09-20%20at%2020.15.27.png){width=80%}


::::

:::


## ตัวอย่างการใช้ ChatGPT เพื่อระบุปัญหาโดยใช้ข้อมูลจริงเป็นฐาน

![](img/problem1.png)

<div style="font-size: 70%;">

[https://chatgpt.com/share/66fa28eb-52a0-8003-b743-0e3fe3fd0173](https://chatgpt.com/share/66fa28eb-52a0-8003-b743-0e3fe3fd0173)

</div>




## Analysis using Gen AI {background-color="black"}


![](img/Screenshot%202567-09-20%20at%2020.23.24.png)


## Analysis using Gen AI {background-color="black"}



![](img/Screenshot%202567-09-20%20at%2020.25.01.png)


## Analysis using Gen AI {background-color="black"}

::: {.columns}

:::: {.column width="50%"}

![](img/Screenshot%202567-09-20%20at%2020.26.14.png)
::::

:::: {.column width="50%"}
![](img/Screenshot%202567-09-20%20at%2020.27.53.png){width=85%}
::::

:::

## Analysis using Gen AI: Final Output {background-color="black"}

![](img/Screenshot%202567-09-20%20at%2020.34.27.png)




## จุดเด่นข้อจำกัดของ Gen AI

![](img/pros-and-cons-of-ai-11102022.webp)





## Identify the Problem {.smaller}

เราสามารถ filter ข้อมูลนักเรียนที่ได้ 0 คะแนน ในการ quiz แต่ละครั้งขึ้นมาดูได้

:::: {.columns}

::: {.column width="30%"}


ได้ quiz1 = 0 (37 คน)

```{r echo = F}
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  filter(quiz1 == 0) %>% data.frame() 


```

:::

::: {.column width="30%"}

ได้ quiz2 = 0 (17 คน)


```{r echo = F}
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  filter(quiz2 == 0)  %>% data.frame() 
```


:::


::: {.column width="30%"}

ได้ quiz3 = 0 (17 คน)


```{r echo = F}
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  filter(quiz3 == 0)  %>% data.frame() 
```



:::


::::



## Frame the Problem {.smaller}

<br>
<br>
<br>


<center>

```{mermaid}
%% | echo: false

stateDiagram-v2
    direction LR
    classDef yourState font-style:italic,font-weight:bold,fill:white

[*] --> A
A: Identify the Problem
A: นักเรียนจำนวนหนึ่งมีปัญหา \n ในการทำความเข้าใจเนื้อหา
A --> B:::yourState
B: Frame \n the Problem
B --> C
C: Analyze & \n Validate Causes
C --> D
D: Develop and \n Implement \n Solutions
D --> E
E: Monitoring and \n Evaluation
E --> A: Not Success
E --> [*]: Success
```

</center>





## Frame the Problem {.smaller}

```{mermaid}
%%| echo: false
flowchart LR

A((Factors?)) --> B[Problems]
```


<div style="font-size: 70%;">

- ขั้นตอนนี้มีวัตถุประสงค์หลักคือเพื่อกำหนดกรอบในการอธิบายปัญหาหรือสถานการณ์ที่เกิดขึ้น

  - Fishbone Diagram (Ishikawa Diagram)

  - Five Whys Analysis
  
</div>

:::: {.columns}

::: {.column width="50%"}

![](https://upload.wikimedia.org/wikipedia/commons/thumb/5/52/Ishikawa_Fishbone_Diagram.svg/2880px-Ishikawa_Fishbone_Diagram.svg.png)

:::

::: {.column width="50%"}

![](https://www.lean.org/wp-content/uploads/2020/07/5-Why-Funnel-1536x1321.jpg){width="80%"}
:::

::::


## Fishbone Diagram (Ishikawa Diagram) {.smaller}

- เป็นเครื่องมือที่ใช้ในการวิเคราะห์สาเหตุของปัญหา โดยมีลักษณะคล้ายโครงกระดูกปลา จึงเรียกว่า “Fishbone” หรือที่รู้จักอีกชื่อหนึ่งว่า Cause-and-Effect Diagram การวิเคราะห์นี้มีวัตถุประสงค์เพื่อระบุและจัดกลุ่มปัจจัยที่เป็นสาเหตุของปัญหาต่าง ๆ อย่างเป็นระบบ เพื่อให้เห็นภาพรวมของสาเหตุที่อาจก่อให้เกิดปัญหาหรือความไม่พึงประสงค์ที่เกิดขึ้น และช่วยให้สามารถแก้ไขปัญหาได้ตรงจุดมากขึ้น

- ส่วนประกอบของ Fishbone Diagram 

  - ปัญหาหรือสถานการณ์ที่เกิดขึ้น (Problem)
  
  - สาเหตุหลัก (Main Cause)
  
  - สาเหตุย่อย (Sub-Cause)



## 5M model Fishbone Diagram (Ishikawa Diagram) {.smaller}

<div style="font-size: 90%;">

<p style="text-indent: 2em;">

- Manpower / Mindpower (physical or knowledge work, includes: kaizens, suggestions)

- Machine (equipment, technology)

- Material (includes raw material, consumables, and information)

- Method (process)

- Measurement / medium (inspection, environment)

</p>
</div>

<div class="caption">https://en.wikipedia.org/wiki/Ishikawa_diagram</div>

## Classroom Fishbone Diagram (Ishikawa Diagram) {.smaller}


<div style="font-size: 90%;">

<p style="text-indent: 2em;">


- นักเรียน

- ครู

- บ้าน

- เพื่อน

- สภาพแวดล้อม

- ...
</p>

</div>

## Classroom Fishbone Diagram (Ishikawa Diagram) {.smaller}

![](img/fish0.png)


## Classroom Fishbone Diagram (Ishikawa Diagram) {.smaller}


![](img/fish1.png)


## Classroom Fishbone Diagram (Ishikawa Diagram) {.smaller}

![](img/fish2.png)



## Classroom Fishbone Diagram (Ishikawa Diagram) {.smaller}

![](img/fish3.png)


## Classroom Fishbone Diagram (Ishikawa Diagram) {.smaller}

![](img/fish4.png)

## Classroom Fishbone Diagram (Ishikawa Diagram) {.smaller}

![](img/fish6.png)

## Analysis Framework (1)


<center>

```{mermaid}
%% | echo: false
%% | fig-align: "center"


flowchart LR


B(("แรงจูงใจ"))-->A["การเข้าเรียน"]

C(("ความขยัน/รับผิดชอบ"))--> A

B-->D["มาสาย"]
C-->D


F(("ความรู้พื้นฐาน"))-->E["ผลการเรียน Math ในอดีต"] 


subgraph analysis_framework ["Analysis Framework"]
A-->G["เรียนไม่รู้เรื่อง"]
D-->G
E-->G
end


```

</center>


## Analysis Framework (2)


<center>

```{mermaid}
%% | echo: false
%% | fig-align: "center"
%% | fig-height: 100



flowchart LR

B(("แรงจูงใจ"))-->A["การเข้าเรียน"]
B-->J["ปฏิสัมพันธ์ในชั้นเรียน"]
C(("ความขยัน/รับผิดชอบ"))--> A
C-->L["การทำการบ้าน/งานฯ"]

B-->D["มาสาย"]
C-->D

F(("ความรู้พื้นฐาน"))-->E["ผลการเรียน Math ในอดีต"] 

H(("ปัญหาด้านอารมณ์สังคม")) --> A
H(("ปัญหาด้านอารมณ์สังคม")) --> D
H --> I["ไม่มีเพื่อน"]
H --> M["โดนกลั่นแกล้ง"]
H --> L



subgraph analysis_framework ["Analysis Framework"]
A-->G["เรียนไม่รู้เรื่อง"]
D-->G
E-->G
I-.->G
J-->G
L-->G
M-->G

end
```

</center>



## Analysis Framework (3)


<center>

```{mermaid}
%% | echo: false
%% | fig-align: "center"
%% | fig-height: 100



flowchart LR

B(("แรงจูงใจ"))-->A["การเข้าเรียน"]
B-->J["ปฏิสัมพันธ์ในชั้นเรียน"]
C(("ความขยัน/รับผิดชอบ"))--> A
C-->L["การทำการบ้าน/งานฯ"]

B-->D["มาสาย"]
C-->D

F(("ความรู้พื้นฐาน"))-->E["ผลการเรียน Math ในอดีต"] 

H(("ปัญหาด้านอารมณ์สังคม")) --> A
H(("ปัญหาด้านอารมณ์สังคม")) --> D
H --> I["ไม่มีเพื่อน"]
H --> M["โดนกลั่นแกล้ง"]
H --> L


N(("ปัญหาทางบ้าน"))-->H
N-->B
N-->C
N-->F

subgraph analysis_framework ["Analysis Framework"]
A-->G["เรียนไม่รู้เรื่อง"]
D-->G
E-->G
I-.->G
J-->G
L-->G
M-->G

end
```

</center>



## Data Analysis {.smaller}

<center>

```{mermaid}
%% | echo: false

stateDiagram-v2
    direction LR
    classDef yourState font-style:italic,font-weight:bold,fill:white

[*] --> A
A: Identify the Problem
A: นักเรียนจำนวนหนึ่งมีปัญหา \n ในการทำความเข้าใจเนื้อหา
A --> B
B: Frame \n the Problem
B --> C:::yourState
C: Analyze & \n Validate Causes
C --> D
D: Develop and \n Implement \n Solutions
D --> E
E: Monitoring and \n Evaluation
E --> A: Not Success
E --> [*]: Success
```

</center>

![](img/ASA_framwork1.png)

## Data Analysis {.smaller}


ก่อนการวิเคราะห์สาเหตุ/ปัจจัยที่สัมพันธ์กับปัญหา คุณครูอาจจำเป็นต้องเก็บรวบรวมข้อมูลเพิ่มเติมตามกรอบแนวคิดที่ได้สร้างไว้

```{r echo = F}
#data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
#  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
#  glimpse()

data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz1, quiz2, quiz3, percent_attend, percent_late_inclass,
         percent_goout, percent_answer_inclass, practice, time_do_homework1,
         time_do_homework2, percent_time_start1, percent_time_start2,
         late_assignment, incomplete_assignment, pre_grade_inmath) %>% 
  glimpse()
```

## Data Analysis

- Descriptive Analysis

- Pareto Analysis

- Generative AI

- Drill Down Analysis

- Correlation Analysis

- Regression Analysis

- Decision Tree

- Root Cause Analysis (RCA) เช่น five whys

- ...

## Data Analysis: Descriptive Analysis {.smaller}

- เป็นขั้นตอนเบื้องต้นของการวิเคราะห์ diagnostic

- วัตถุประสงค์คือเพื่อทำความเข้าใจลักษณะเบื้องต้นของความสัมพันธ์ระหว่างปัจจัยกับปัญหา

- การวิเคราะห์ที่อาจดำเนินการได้

  - บรรยายสภาพข้อมูลปัจจัยต่าง ๆ ตามกรอบแนวคิดที่ได้สร้างขึ้น
  
  - เปรียบเทียบสภาพของปัจจัยต่าง ๆ ระหว่างกลุ่มนักเรียนที่มีปัญหา/สนใจ กับกลุ่มนักเรียนที่ไม่มีปัญหาหรือไม่ได้สนใจ
  
  - วิเคราะห์ความสัมพันธ์เบื้องต้นระหว่างปัจจัยกับสภาพปัญหา


## Descriptive: สภาพปัจจัยที่คาดว่าน่าจะสัมพันธ์กับปัญหา {.smaller}

ลองคัดกรองเฉพาะผู้เรียนที่มีปัญหาเรียนไม่รู้เรื่อง จากนั้นวิเคราะห์สภาพของปัจจัยที่คาดว่าน่าจะสัมพันธ์กับปัญหา (quiz1 = 0)


```{r echo = F}
library(patchwork)
p1<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  filter(quiz1 ==0) %>% 
  select(percent_attend, percent_late_inclass,
         percent_goout, percent_answer_inclass, practice,
         percent_time_start1, percent_time_start2,
         late_assignment, incomplete_assignment, pre_grade_inmath) %>% 
  pivot_longer(cols = is.numeric) %>% 
  ggplot(aes(x=value))+
  geom_histogram(fill = "steelblue")+
  facet_wrap(~name, scale="free_x")+
  theme_light()

p2<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  filter(quiz1 ==0) %>% 
  select(percent_attend, percent_late_inclass,
         percent_goout, percent_answer_inclass, practice,
         percent_time_start1, percent_time_start2,
         late_assignment, incomplete_assignment, pre_grade_inmath) %>% 
  pivot_longer(cols = is.character) %>% 
  ggplot(aes(x=value))+
  geom_bar(fill = "steelblue")+
  facet_wrap(~name, scale="free_x")+
  theme_light()

p1
```


## Descriptive: สภาพปัจจัยที่คาดว่าน่าจะสัมพันธ์กับปัญหา {.smaller}

ลองคัดกรองเฉพาะผู้เรียนที่มีปัญหาเรียนไม่รู้เรื่อง จากนั้นวิเคราะห์สภาพของปัจจัยที่คาดว่าน่าจะสัมพันธ์กับปัญหา

```{r echo = F}
p2
```

## Descriptive: เปรียบเทียบสภาพปัจจัยระหว่างกลุ่ม {.smaller}

```{r echo = F, fig.width = 12, fig.height = 5}

p1<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz1, practice, pre_grade_inmath) %>%
  filter(quiz1 ==0) %>% 
  ggplot(aes(x = practice))+
  geom_bar(fill = "maroon")+
  ggtitle("quiz1= 0")


p2<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz1, practice, pre_grade_inmath) %>%
  filter(quiz1 >= 5) %>% 
  ggplot(aes(x = practice))+
  geom_bar(fill = "steelblue")+
  ggtitle("quiz1 >= 5")

p1+p2

```


## Descriptive: เปรียบเทียบสภาพปัจจัยระหว่างกลุ่ม {.smaller}


```{r echo = F}
p1<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz1, practice, pre_grade_inmath) %>%
  filter(quiz1 ==0) %>% 
  ggplot(aes(x = pre_grade_inmath))+
  geom_bar(fill = "maroon")+
  ggtitle("quiz1= 0")


p2<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz1, practice, pre_grade_inmath) %>%
  filter(quiz1 >= 5) %>% 
  ggplot(aes(x = pre_grade_inmath))+
  geom_bar(fill = "steelblue")+
  ggtitle("quiz1 >= 5")

p1+p2

```


## Descriptive: เปรียบเทียบสภาพปัจจัยระหว่างกลุ่ม {.smaller}


```{r echo = F, fig.width = 12, fig.height = 5}
p1<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz1, practice, pre_grade_inmath) %>%
  filter(quiz1 ==0) %>% 
  ggplot(aes(x = practice, fill = pre_grade_inmath))+
  geom_bar()+
  ggtitle("quiz1= 0")

p2<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz1, practice, pre_grade_inmath) %>%
  filter(quiz1 >=5) %>% 
  ggplot(aes(x = practice, fill = pre_grade_inmath))+
  geom_bar()+
  ggtitle("quiz1 >= 5")

p1+p2

```

## Descriptive: เปรียบเทียบสภาพปัจจัยระหว่างกลุ่ม {.smaller}

```{r echo = F, fig.width = 12, fig.height = 5}
p1<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz2, practice, pre_grade_inmath) %>%
  filter(quiz2 ==0) %>% 
  ggplot(aes(x = practice, fill = pre_grade_inmath))+
  geom_bar()+
  ggtitle("quiz2= 0")

p2<-data %>% 
  #select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15, pre_grade_inmath = grade) %>% 
  select(quiz2, practice, pre_grade_inmath) %>%
  filter(quiz2 >=5) %>% 
  ggplot(aes(x = practice, fill = pre_grade_inmath))+
  geom_bar()+
  ggtitle("quiz2 >= 5")

p1+p2

```


## Data Analysis

- Descriptive Analysis

- Pareto Analysis

- Generative AI

- Drill Down Analysis

- Correlation Analysis

- Regression Analysis

- Decision Tree

- Root Cause Analysis (RCA) เช่น five whys

- ...

## Descriptive Analysis {.smaller}

ผลการวิเคราะห์ด้วยสถิติบรรยายในเบื้องต้นบ่งชี้ว่า

- ความรู้พื้นฐานทางคณิตศาสตร์ น่าจะเป็นปัจจัยหนึ่งที่สัมพันธ์กับปัญหา

- การทบทวนบทเรียน ก็อาจจเป็นปัจจัยหนึ่งแต่ไม่ค่อยชัดเจนนัก


# Diagnostic Analysis II




## ทบทวน : ปัญหาที่เกิดขึ้น {.smaller}


นักเรียนบางส่วนมีความเข้าใจในเนื้อหาไม่เพียงพอ

- ทุก quiz มีนักเรียนที่สอบได้ 0 คะแนนหรือใกล้เคียงเป็นจำนวนพอสมควร

- ทุก quiz มีนักเรียนที่ได้คะแนนต่ำกว่าครึ่งค่อนข้างมาก


```{r echo = F, fig.height = 4}
p <- data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  #mutate_at(vars(starts_with("quiz")), scale) %>% 
  pivot_longer(cols = -stu_id, names_to = "quiz", values_to = "score") %>%
  ggplot(aes(x=score))+
  geom_histogram(bins =20, fill = "steelblue", col ="white")+
  geom_violin(aes(y = 0), bw = 0.5, width = 10, alpha = 0.4)+
  geom_boxplot(aes(y = 0), vjust = 2, width = 2)+
  facet_wrap(~quiz, scales = "free_x")+
  theme_light()
p
```





## Data Analysis

<div style="font-size: 70%;">

- ~~Descriptive Analysis~~

- Pareto Analysis

- Generative AI

- Drill Down Analysis

- Correlation Analysis

- Regression Analysis

- Decision Tree

- Root Cause Analysis (RCA) เช่น five whys

- ...

</div>

## Pareto Chart (0) {.smaller}

![https://www.investopedia.com/terms/p/pareto-analysis.asp](https://www.investopedia.com/thmb/ghkkjkMF_jlsEl269OZu5A_dWME=/750x0/filters:no_upscale():max_bytes(150000):strip_icc()/ParetoExample2-e075b949a3af4751a329954498103d1b.JPG)

## Pareto Chart (1) {.smaller}

> "roughly 80% of consequences come from 20% of causes" 


![](https://th.hrnote.asia/storage/2021/01/1.18.jpg)

- เป็นแผนภูมิที่ใช้แสดงการแจกแจงของปัจจัยที่คาดว่าจะสัมพันธ์กับปัญหา

- แนวคิดเบื้องหลังมาจาก Pareto Principle 



<div class="caption3">https://th.hrnote.asia/orgdevelopment/8020rule-paretoprinciple-01182021/</div>


## Pareto Chart (2) {.smaller}

วัตถุประสงค์ : ระบุปัจจัยที่สำคัญที่สุดที่คาดว่าจะสัมพันธ์กับปัญหานักเรียนบางส่วนมีความเข้าใจในเนื้อหาไม่เพียงพอ

```{mermaid}
%%| echo: false
%%| fig-align: "center"

flowchart LR

A[Data]-->B["คัดกรองนักเรียนที่เป็นปัญหา"]
B-->C["สร้าง Pareto Chart"]
C-->D(("ระบุปัจจัยสำคัญ"))

```



## Pareto Chart (3) {.smaller}

คัดกรองนักเรียนที่เป็นปัญหา

:::: {.columns}

::: {.column width="50%}

```{mermaid}
%%| echo: false
%%| fig-align: "center"

flowchart TD
A["Data: \n
  - quiz1 (7.5)
  - quiz2 (7.5)
  - quiz3 (15)"] --> B["Standardized"]
B --> C["รวมคะแนน quiz เข้าด้วยกัน"]
C --> D["คัดกรองนักเรียนที่มีปัญหา"]

style A fill:#ffffff, stroke: black, stroke-width: 2px
```



:::

::: {.column width="50%}

<div style="font-size: 80%;">

- รวมคะแนนทั้ง 3 quiz เป็นคะแนนรวมของนักเรียนก่อนจากนั้นค่อยเลือกนักเรียนที่มีปัญหาจากคะแนนรวม จะช่วยให้เราคัดกรองนักเรียนได้ง่ายขึ้น

- การรวมคะแนนทำได้หลายวิธี เช่น ใช้ค่าเฉลี่ย หรืออาจใช้มัธยฐาน หรือผลสอบครั้งที่ดีที่สุด การเลือกใช้วิธีการไหนขึ้นอยู่กับความเหมาะสมและบริบท

  - quiz1 เต็ม 7.5 คะแนน
  
  - quiz2 เต็ม 7.5 คะแนน
  
  - quiz3 เต็ม 15 คะแนน
  

</div>
:::

::::


## Pareto Chart (4) {.smaller}

คัดกรองนักเรียนที่เป็นปัญหา


:::: {.columns}

::: {.column width="50%}

```{mermaid}
%%| echo: false
%%| fig-align: "center"

flowchart TD

A["Data: \n
  - quiz1 (7.5)
  - quiz2 (7.5)
  - quiz3 (15)"] --> B["Standardized"]
B --> C["รวมคะแนน quiz เข้าด้วยกัน"]
C --> D["คัดกรองนักเรียนที่มีปัญหา"]

style B fill:#ffffff, stroke: black, stroke-width: 2px

```



:::

::: {.column width="50%}

<div style="font-size: 80%;">

จะเห็นว่าแต่ละ quiz คะแนนเต็มไม่เท่ากัน ก่อนการรวมคะแนนจึงควรปรับคะแนนให้เท่ากันก่อน

- ทำเป็นคะแนนที่เต็มเท่ากัน เช่น ร้อยละ หรืออื่น ๆ 

- แปลงเป็นคะแนนมาตรฐาน $Z = \frac{x-M}{SD}$ (standardization)

- แปลงเป็นคะแนนมาตรฐาน $d = \frac{x-min}{max-min}$ (normalization)



</div>
:::

::::


## Pareto Chart (5) {.smaller}

คัดกรองนักเรียนที่เป็นปัญหา


```{r}

p1 <- data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  #mutate_at(vars(starts_with("quiz")), scale) %>% 
  pivot_longer(cols = -stu_id, names_to = "quiz", values_to = "score") %>%
  ggplot(aes(x=score))+
  geom_histogram(bins =20, fill = "steelblue", col ="white")+
  geom_violin(aes(y = 0), bw = 0.5, width = 10, alpha = 0.4)+
  geom_boxplot(aes(y = 0), vjust = 2, width = 2)+
  facet_wrap(~quiz, scales = "free_x")+
  theme_light()+
  ggtitle("original score")

p2<-data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  pivot_longer(cols = -stu_id, names_to = "quiz", values_to = "score") %>%
  ggplot(aes(x=score))+
  geom_histogram(bins =20, fill = "steelblue", col ="white")+
  geom_violin(aes(y = 0), bw = 5, width = 10, alpha = 0.4)+
  geom_boxplot(aes(y = 0), vjust = 2, width = 2)+
  facet_wrap(~quiz, scales = "free_x")+
  theme_light()+
  ggtitle("percentage score")

p1/p2

minmax <- function(x){
  z <- (x-min(x))/(max(x)-min(x))
  return(z)
}
```


## Pareto Chart (6) {.smaller}

คัดกรองนักเรียนที่เป็นปัญหา

<center>

```{r fig.height= 5, fig.width = 10}

p3 <- data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate_at(vars(starts_with("quiz")), scale) %>% 
  pivot_longer(cols = -stu_id, names_to = "quiz", values_to = "score") %>%
  ggplot(aes(x=score))+
  geom_histogram(bins =20, fill = "steelblue", col ="white")+
  geom_violin(aes(y = 0), bw = 0.2, width = 10, alpha = 0.4)+
  geom_boxplot(aes(y = 0), vjust = 2, width = 2)+
  facet_wrap(~quiz, scales = "free_x")+
  theme_light()+
  ggtitle("Standardized Score Z")



p4<-data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate_at(vars(starts_with("quiz")), minmax) %>% 
  pivot_longer(cols = -stu_id, names_to = "quiz", values_to = "score") %>%
  ggplot(aes(x=score))+
  geom_histogram(bins =20, fill = "steelblue", col ="white")+
  geom_violin(aes(y = 0), bw = 0.1, width = 10, alpha = 0.4)+
  geom_boxplot(aes(y = 0), vjust = 2, width = 2)+
  facet_wrap(~quiz, scales = "free_x")+
  theme_light()+
  ggtitle("Normalized Score")

p3/p4
```

</center>


## Pareto Chart (7) {.smaller}

คัดกรองนักเรียนที่เป็นปัญหา

:::: {.columns}

::: {.column width="50%}

```{mermaid}
%%| echo: false
%%| fig-align: "center"

flowchart TD

A["Data: \n
  - quiz1 (7.5)
  - quiz2 (7.5)
  - quiz3 (15)"] --> B["Standardized"]
B --> C["รวมคะแนน quiz เข้าด้วยกัน"]
C --> D["คัดกรองนักเรียนที่มีปัญหา"]

style C fill:#ffffff, stroke: black, stroke-width: 2px

```



:::

::: {.column width="50%}


```{mermaid}
%%| echo: false
%%| fig-align: "center"

flowchart LR
A["Percent quiz1"]-->D["total score"]
B["Percent quiz2"]-->D
C["Percent quiz3"]-->D

```


<div style="font-size: 80%;">

การรวมคะแนน quiz1, quiz2 และ quiz3 เข้าด้วยกันก็สามารถทำได้หลายวิธีการ

- ค่าเฉลี่ย

- มัธยฐาน

- ผลสอบที่ดีที่สุด

- ผลสอบที่แย่ที่สุด


</div>
:::

::::



## Pareto Chart (8) {.smaller}

คัดกรองนักเรียนที่เป็นปัญหา

:::: {.columns}

::: {.column width="20%}

```{mermaid}
%%| echo: false
%%| fig-align: "center"

flowchart TD

A["Data: \n
  - quiz1 (7.5)
  - quiz2 (7.5)
  - quiz3 (15)"] --> B["Standardized"]
B --> C["รวมคะแนน quiz เข้าด้วยกัน"]
C --> D["คัดกรองนักเรียนที่มีปัญหา"]

style C fill:#ffffff, stroke: black, stroke-width: 2px

```


:::

::: {.column width="80%}


<div style="font-size: 80%;">

การรวมคะแนน quiz1, quiz2 และ quiz3 เข้าด้วยกันก็สามารถทำได้หลายวิธีการ

- ค่าเฉลี่ย

- มัธยฐาน

- ผลสอบที่ดีที่สุด

- ผลสอบที่แย่ที่สุด

</div>



<div style="font-size: 70%;">


```{r}
library(gt)
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  mutate(avg_score = (quiz1+quiz2+quiz3)/3) %>% 
  rowwise() %>% 
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>%
  mutate(max_score = max(c(quiz1, quiz2, quiz3))) %>%
  head() %>% 
  gt()
```

</div>

:::

::::

## Pareto Chart (9) {.smaller}

<div style="font-size: 70%;">

นักเรียนที่เป็นปัญหาคือนักเรียนที่ทำ quiz จำนวน  3 ครั้งแล้ว ...

- ได้คะแนนเฉลี่ยต่ำกว่าร้อยละ 25 

- มีมัธยฐานต่ำกว่าร้อยละ 25

- ได้ค่าสูงต่ำกว่าร้อยละ 25

- ได้ค่าต่ำสุดต่ำกว่าร้อยละ 25

</div>

```{r fig.width=8, fig.height = 4}
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  mutate(avg_score = (quiz1+quiz2+quiz3)/3) %>% 
  rowwise() %>% 
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>%
  mutate(max_score = max(c(quiz1, quiz2, quiz3))) %>% 
  mutate(min_score = min(c(quiz1, quiz2, quiz3))) %>%
  pivot_longer(cols = c(avg_score, med_score, max_score, min_score)) %>%
  mutate(name = fct_relevel(name, "avg_score", "med_score", "max_score","min_score")) %>%
  ggplot(aes(x = value))+
  geom_histogram()+
  geom_boxplot(y = 0, width = 4)+
  facet_wrap(~name)
```



## Pareto Chart (10) {.smaller}


<div style="font-size: 70%;">

นักเรียนที่เป็นปัญหาคือนักเรียนที่ทำ quiz จำนวน  3 ครั้งแล้ว ...

- ~~ได้คะแนนเฉลี่ยต่ำกว่าร้อยละ 25~~ 

- มีมัธยฐานต่ำกว่าร้อยละ 25

- ~~ได้ค่าสูงต่ำกว่าร้อยละ 25~~

- ~~ได้ค่าต่ำสุดต่ำกว่าร้อยละ 25~~

</div>


:::: {.columns}

::: {.column width="50%"}


<div style="font-size: 40%;">

```{r}
library(DT)
temp <- data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  rowwise() %>%
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>% 
  filter(med_score < 25) %>% 
  mutate_at(vars(starts_with("quiz")), round,2)  %>% 
  mutate(med_score = round(med_score,2))

temp %>% datatable()
```
</div>

:::

::: {.column width="50%"}

<div style="font-size: 80%;">

```{r}
temp %>% select(med_score) %>% summary()

temp %>% 
  ggplot(aes(x=med_score))+
  geom_histogram(bins = 10, col = "white", fill = "steelblue")+
  geom_boxplot()+
  theme_light()
```

</div>
:::


::::

## Pareto Chart (11) {.smaller}


```{mermaid}
%%| echo: false
%%| fig-align: "center"

flowchart LR

A[Data]-->B["คัดกรองนักเรียนที่เป็นปัญหา"]
B-->C["สร้าง Pareto Chart"]
C-->D(("ระบุปัจจัยสำคัญ"))

style C fill:#ffffff, stroke: black, stroke-width: 2px
```


การสร้าง Pareto Chart มีขั้นตอนสำคัญต่อไปนี้

- เก็บรวบรวมข้อมูลของปัจจัยที่คาดว่าจะมีความสัมพันธ์กับปัญหา

- ลักษณะของข้อมูลที่จะนำมาสร้าง Pareto Chart ควรประกอบด้วย

    - ประเภทของปัญหา (category of problem)
  
    - ความถี่/ความรุนแรงของปัญหา (frequency/severity of problem)

- จัดเรียงปัจจัยตามความถี่ (ความสำคัญ) จากมากไปน้อย

- คำนวณความถี่ (ร้อยละ) สะสมของปัจจัย

- สร้างแผนภูมิ Pareto 


## Pareto Chart (12) {.smaller}

```{r}
factor_data <- data %>% 
  rename(pre_grade_inmath = grade) %>% 
  select(stu_id, percent_attend, percent_late_inclass,
         percent_goout, percent_answer_inclass, practice,
         percent_time_start1, percent_time_start2,
         late_assignment, incomplete_assignment, pre_grade_inmath) %>% 
  mutate(avg_time_start = (percent_time_start1 + percent_time_start2)/2) %>% 
  select(-percent_time_start1, -percent_time_start2)

temp %>% inner_join(factor_data, by="stu_id") %>% 
  select(-quiz1, -quiz2, -quiz3) %>% 
  glimpse(90)

temp <- temp %>% inner_join(factor_data, by="stu_id") %>% 
  select(-quiz1, -quiz2, -quiz3)

```


## Pareto Chart (13) {.smaller}

<div style="font-size: 70%;">

- `percent_attend` --> จำนวนนักเรียนที่เข้าเรียนน้อยกว่า 80%

- `percent_late_inclass` --> จำนวนนักเรียนที่เข้าเรียนสายมากกว่า 50%

- `percent_goout` --> จำนวนนักเรียนที่ออกไปนอกห้องเรียนมากกว่า 50%

- `percent_answer_inclass` --> จำนวนนักเรียนที่ตอบคำถามในห้องเรียนน้อยกว่า 50%

- `practice` --> จำนวนนักเรียนที่ไม่ทบทวนบทเรียน

- `late_assignment` --> จำนวนนักเรียนที่ส่งงานช้า

- `incomplete_assignment` --> จำนวนนักเรียนที่ส่งงานไม่สมบูรณ์

- `pre_grade_inmath` --> จำนวนนักเรียนที่ความรู้พื้นฐานไม่ดี

- `avg_time_start` --> จำนวนนักเรียนที่เริ่มทำการบ้านช้ากว่าร้อยละ 80% ของเวลาที่กำหนด

</div>

## Pareto Chart (14) {.smaller}

<div style="font-size: 80%;">

Original Data

```{r}
temp %>% 
  select(-med_score) %>% 
  glimpse(90)
```

Transformed Data

```{r}
temp %>% 
  mutate(less_attend = percent_attend < 0.8,
         late_inclass = percent_late_inclass > 0.5,
         frequently_goout = percent_goout > 0.5,
         less_interaction = percent_answer_inclass < 0.5,
         no_practice = practice == "no_pratice",
         late_submit_hw = late_assignment == "late",
         incomplete_assign = incomplete_assignment == "incomplete",
         less_preknowledge = pre_grade_inmath != "success",
         late_start_hw = avg_time_start > 0.8) %>% 
  select(stu_id,12:20) %>% glimpse(90)
```
</div>

## Pareto Chart (15) {.smaller}

<br>

<div style="font-size: 80%;">

```{r}

library(kableExtra)
temp %>% 
  mutate(less_attend = percent_attend < 0.8,
         late_inclass = percent_late_inclass > 0.5,
         frequently_goout = percent_goout > 0.5,
         less_interaction = percent_answer_inclass < 0.5,
         no_practice = practice == "no_pratice",
         late_submit_hw = late_assignment == "late",
         incomplete_assign = incomplete_assignment == "incomplete",
         less_preknowledge = pre_grade_inmath != "success",
         late_start_hw = avg_time_start > 0.8) %>% 
  select(stu_id,12:20) %>% 
  pivot_longer(cols = -stu_id, names_to = "factor", values_to = "problem") %>% 
  group_by(factor, problem) %>% 
  count() %>% 
  filter(problem == TRUE) %>% 
  arrange(desc(n)) %>%
  ungroup() %>% 
  mutate(cumsum = cumsum(n)) %>% 
  mutate(percent_cumsum = round(cumsum*100/485,2)) %>%
  kbl() %>%
  kable_classic(full_width = F)

```

</div>

## Pareto Chart (16) {.smaller}

> "roughly 80% of consequences come from 20% of causes" 

<div style="font-size: 80%;">

- Vital Few (20%) ปัจจัยจำนวนน้อยที่มีความสำคัญมากที่สุด

- Useful Many (80%) ปัจจัยจำนวนมากที่มีความสำคัญน้อยกว่า อาจพิจารณาให้ความสำคัญเป็นอันดับรองลงมา

</div>

```{r fig.height=4, fig.width = 8}
temp %>% 
  mutate(less_attend = percent_attend < 0.8,
         late_inclass = percent_late_inclass > 0.5,
         frequently_goout = percent_goout > 0.5,
         less_interaction = percent_answer_inclass < 0.5,
         no_practice = practice == "no_pratice",
         late_submit_hw = late_assignment == "late",
         incomplete_assign = incomplete_assignment == "incomplete",
         less_preknowledge = pre_grade_inmath != "success",
         late_start_hw = avg_time_start > 0.8) %>% 
  select(stu_id,12:20) %>% 
  pivot_longer(cols = -stu_id, names_to = "factor", values_to = "problem") %>% 
  group_by(factor, problem) %>% 
  count() %>% 
  filter(problem == TRUE) %>% 
  arrange(desc(n)) %>%
  ungroup() %>% 
  mutate(cumsum = cumsum(n)) %>% 
  mutate(percent_cumsum = round(cumsum*100/485,2)) %>% 
  ggplot(aes(x = reorder(factor, desc(n)), y=n)) +
  geom_col(aes(fill = percent_cumsum > 60)) +
  geom_line(aes(y=percent_cumsum, group = 1), col = "orange", linewidth = 1.5) +
  geom_point(aes(y=percent_cumsum, group = 1), col ="orange", size = 3)+
  ylab("Frequency \n") +
  xlab("") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 0, size = 6),
        legend.position = "none") +
  scale_y_continuous(
    sec.axis = sec_axis(~. , name = "Cumulative Percentage (%) \n")
  )
```


## Correlation Analysis (1) {.smaller}

<div style="font-size: 80%;">

- Correlation analysis คือการวิเคราะห์ความสัมพันธ์เชิงเส้น (linear association) ระหว่างตัวแปรสองตัว

  - ตัวแปรทั้งสองมีทิศทางของความสัมพันธ์เป็นอย่างไร

  - ความสัมพันธ์ที่เป็นเชิงเส้นระหว่างตัวแปรทั้งสองมีความชัดเจนมากไปแค่ไหน ---> ขนาดความสัมพันธ์

ดัชนีหรือค่าสถิติที่ใช้สะท้อนสภาพข้างต้นเรียกว่า ค่าสัมประสิทธิ์สหสัมพันธ์ (correlation coefficient) 

</div>

![https://en.wikipedia.org/wiki/Correlation#/media/File:Correlation_examples2.svg](img/correlation_concept.png)


## Correlation Analysis (2) {.smaller}


โดยทั่วไป Correlation Coefficient จะมีค่าอยู่ในช่วง [-1,1]

![](img/correlation.jpg)


  - ถ้าใกล้ 1 --> Strong positive correlation
  
  - ถ้าใกล้ -1 --> Strong negative correlation
  
  - ถ้าใกล้ 0 --> No correlation หมายความว่ามีความสัมพันธ์ไม่ชัดเจน/ไม่มีความสัมพันธ์/มีความสัมพันธ์แบบไม่ใช่เส้นตรง

## Correlation Analysis (4) {.smaller}

<div style="font-size: 80%;">


Correlation มีหลายประเภท แต่ละตัวถูกพัฒนาขึ้นเพื่อใช้กับข้อมูลที่แตกต่างประเภทกัน

- Pearson's Correlation Coefficient ใช้วัดสหสัมพันธ์ระหว่างตัวแปรเชิงปริมาณสองตัว [-1,1]

- Spearman's Rank Correlation Coefficient ใช้วัดสหสัมพันธ์ระหว่างตัวแปรเชิงลำดับ (ranking) สองตัว [-1,1]

- Kendall's Tau ใช้วัดสหสัมพันธ์ระหว่างตัวแปรเชิงลำดับ (ranking) สองตัว [-1,1]

- Point-Biserial Correlation Coefficient ใช้วัดสหสัมพันธ์ระหว่างตัวแปรเชิงปริมาณและตัวแปรจัดประเภทที่มี 2 ประเภท [-1,1]

- Phi Coefficient ใช้วัดสหสัมพันธ์ระหว่างตัวแปรจัดประเภท 2 ตัว โดยที่แต่ละตัวมีค่าที่เป็นไปได้ 2 ระดับ [0,1]

- Cramer's V ใช้วัดสหสัมพันธ์ระหว่างตัวแปรจัดประเภท 2 ตัว [0,1]

...

</div>


## Correlation Analysis (5) {.smaller}

ตัวอย่าง Pearson's Correlation

:::: {.columns}

::: {.column width="50%"}


```{r}
exam <- read_csv("exam.csv")
exam %>% ggplot(aes(learning_performance, ach))+
  geom_point()+
  geom_smooth()+
  ggtitle("ความสัมพันธ์ระหว่าง ach กับ learning performance มีแนวโน้มเป็นเส้นตรง")+
  theme(text = element_text(family = "ChulaCharasNew"))
```

:::


::: {.column width="50%"}

<div style="font-size: 70%;">

เนื่องจากตัวแปร ach กับ learning performance เป็นตัวแปรเชิงปริมาณ สัมประสิทธิ์สหสัมพันธ์ที่เหมาะในกรณีนี้คือ Pearson' correlation

```{r}
exam %>% 
  select(learning_performance, ach) %>% 
  cor()
```

ach กับ learning performance มีสหสัมพันธ์กันทิศทางบวกในระดับที่สูง แสดงว่าการเปลี่ยนแปลงในตัวแปรทั้งสองมีความสอดคล้องกันค่อนข้างมาก

</div>
:::

::::




## Correlation Analysis (5) {.smaller}

ตัวอย่าง Spearman's Correlation

:::: {.columns}

::: {.column width="50%"}


```{r}
exam %>%
  arrange(learning_performance) %>%  # จัดเรียงข้อมูลตามตัวแปรหนึ่งก่อน
  mutate(
    rank_learning_performance = row_number(),  # จัดอันดับตามลำดับแถวของข้อมูลที่ถูกจัดเรียง
    rank_ach = rank(ach)  # ใช้ rank() ตามค่าของ ach
  ) %>%
  ggplot(aes(rank_learning_performance, rank_ach)) +
  geom_point() +
  geom_smooth() +
  ggtitle("ความสัมพันธ์ระหว่าง ach กับ learning performance มีแนวโน้มเป็นเส้นตรง (หลังจากแปลงเป็น rank)") +
  theme(text = element_text(family = "ChulaCharasNew"))
```

:::


::: {.column width="50%"}

<div style="font-size: 70%;">

กรณีนี้ลองปรับตัวแปรทั้งสองให้เป็นลำดับ


```{r}
exam %>%
  arrange(learning_performance) %>%  # จัดเรียงข้อมูลตามตัวแปรหนึ่งก่อน
  mutate(
    rank_learning_performance = row_number(),  # จัดอันดับตามลำดับแถวของข้อมูลที่ถูกจัดเรียง
    rank_ach = rank(ach)  # ใช้ rank() ตามค่าของ ach
  ) %>% 
  select(rank_learning_performance, rank_ach) %>% 
  cor(method = "spearman")
```

ach กับ learning performance มีสหสัมพันธ์กันทิศทางบวกในระดับที่สูง แสดงว่าการเปลี่ยนแปลงในตัวแปรทั้งสองมีความสอดคล้องกันค่อนข้างมาก

</div>
:::

::::




## Correlation Analysis (6) {.smaller}

ตัวอย่าง Point-Biserial Correlation

:::: {.columns}

::: {.column width="50%"}


```{r}
exam %>% 
  ggplot(aes(practice,  ach)) +
  geom_boxplot()+
  geom_jitter(width = 0.1, alpha = 0.4)+
  ggtitle("ach กับ practice มีแนวโน้มสัมพันธ์กัน")+
  theme(text = element_text(family = "ChulaCharasNew"))
```

:::


::: {.column width="50%"}

<div style="font-size: 70%;">

- แปลงตัวแปร `practice` โดยให้มีค่าเท่ากับ 1 ถ้าเป็น do practice และมีค่าเท่ากับ 0 ถ้าเป็น do not practice

- นำ practice ที่แปลงแล้วกับ ach มีหาสหสัมพันธ์แบบ Pearson จะเรียกสหสัมพันธ์ตัวนี้ว่า point-biserial correlation

```{r}
exam %>% 
  mutate(practice = ifelse(practice == "do practice", 1, 0)) %>% 
  select(practice, ach) %>% 
  cor(method = "pearson")
```

ach กับ learning performance มีสหสัมพันธ์กันทิศทางบวกในระดับที่สูง แสดงว่าการเปลี่ยนแปลงในตัวแปรทั้งสองมีความสอดคล้องกันค่อนข้างมาก

</div>
:::

::::




## Correlation Analysis (7) {.smaller}

ความสัมพันธ์ระหว่างตัวแปรจัดประเภท


:::: {.columns}

::: {.column width="50%"}


```{r}
exam %>% 
  ggplot(aes(x = practice,  fill = ach > 50)) +
  geom_bar(position = "fill")+
  scale_y_continuous(labels = scales::percent)+
  scale_fill_discrete(labels=c("Fail", "Pass"))
```

:::


::: {.column width="50%"}

<div style="font-size: 70%;">

- แปลง ach เป็นตัวแปรจัดประเภทแบบ 2 ค่า คือ สอบผ่าน >=50 คะแนน และสอบตก < 50 คะแนน

- หาสัมประสิทธิ์ Phi เพื่อวิเคราะห์ขนาดความสัมพันธ์ระหว่างตัวแปรทั้งสอง

```{r}
library(psych)
exam_temp <- exam %>% 
  mutate(ach_group = ifelse(ach >= 50, "Pass", "Fail"))

table_data<- table(exam_temp$practice, exam_temp$ach_group)
table_data
paste("Phi coefficient = ",phi(table_data))
```

ach กับ learning performance มีสหสัมพันธ์กันทิศทางบวกในระดับที่สูง แสดงว่าการเปลี่ยนแปลงในตัวแปรทั้งสองมีความสอดคล้องกันค่อนข้างมาก

</div>
:::

::::


## Performance-Importance Matrix (1) {.smaller}

<div style="font-size: 80%;">

เป็นเครื่องมือที่ใช้ในการวิเคราะห์และวางแผนเพื่อปรับปรุงประสิทธิภาพ โดยในบริบทของ ห้องเรียน สามารถนำมาใช้เพื่อประเมินและวางแผนการพัฒนาการเรียนการสอนของครูและการเรียนรู้ของนักเรียนได้อย่างมีประสิทธิภาพ

1.	**แกน Y: Performance (ประสิทธิภาพ)**

- แกน Y แสดงถึง ประสิทธิภาพ หรือ ผลลัพธ์ ที่เกิดขึ้นจริงในห้องเรียน ซึ่งอาจจะเป็น ผลการเรียนรู้ของนักเรียน เช่น คะแนนสอบ ความสนใจในการเรียน การมีส่วนร่วมในกิจกรรม หรือพฤติกรรมการเรียนรู้

- ตัวแปรนี้วัดได้จากการประเมินผลเชิงปฏิบัติ เช่น คะแนน การประเมินเชิงพฤติกรรม หรือการสังเกตความก้าวหน้าของนักเรียน หรือคะแนนปัจจัยที่คาดว่ามีความสัมพันธ์กับผลลัพธ์การเรียนรู้ก็ได้ แล้วแต่จะออกแบบ

2.	**แกน X: Importance (ความสำคัญ)**

- แกน X แสดงถึง ความสำคัญ ของตัวแปรที่ส่งผลต่อการเรียนรู้ในห้องเรียน เช่น ปัจจัยการสอนของครู, สภาพแวดล้อมการเรียนรู้, การสนับสนุนจากเพื่อน, การเตรียมตัวก่อนเรียน ฯลฯ

- ค่าความสำคัญนี้อาจวัดจาก Correlation ระหว่างตัวแปรที่เกี่ยวข้องกับประสิทธิภาพการเรียนรู้ เช่น คะแนนสอบกับพฤติกรรมการเตรียมตัว, หรือความสัมพันธ์ระหว่างการทำการบ้านกับการมีส่วนร่วมในชั้นเรียน

</div>

## Performance-Importance Matrix (2) {.smaller}

วัตถุประสงค์ จะสร้าง  Performance Matrix เพื่อวิเคราะห์ว่าปัจจัยในเป็นปัจจัยที่ควรจะต้องปรับปรุงเพื่อเพ่ิมประสิทธิภาพในการเรียนรู้ของนักเรียน

- แกน y เป็นสัดส่วนการพบปัจจัยที่คาดว่าสัมพันธ์กับปัญหา

- แกน x เป็น correlation ระหว่างปัจจัยกับผลการเรียนรู้ของนักเรียน (`med_score`)


```{r}
perform_data <- data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  rowwise() %>%
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>% 
  select(stu_id, med_score) %>% 
  ungroup() %>% 
  inner_join(factor_data %>% 
  mutate(more_attend = percent_attend > 0.8,
         ontime_inclass = percent_late_inclass < 0.5,
         rarely_goout = percent_goout < 0.5,
         frequently_interaction = percent_answer_inclass > 0.5,
         frequently_practice = practice != "no_pratice",
         ontime_submit_hw = late_assignment != "late",
         complete_assign = incomplete_assignment != "incomplete",
         have_preknowledge = pre_grade_inmath == "success",
         quick_start_hw = avg_time_start < 0.8) %>% 
  select(stu_id,more_attend:quick_start_hw), by = "stu_id") %>% 
  mutate_if(is.logical, as.numeric) %>%
  select(-stu_id)

perform_data %>% glimpse(90)
```

## Performance-Importance Matrix (3) {.smaller}

correlation matrix ระหว่างตัวแปรทั้งหมด


```{r}
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  rowwise() %>%
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>% 
  select(stu_id, med_score) %>% 
  ungroup() %>% 
  inner_join(factor_data %>% 
  mutate(more_attend = percent_attend > 0.8,
         ontime_inclass = percent_late_inclass < 0.5,
         rarely_goout = percent_goout < 0.5,
         frequently_interaction = percent_answer_inclass > 0.5,
         frequently_practice = practice != "no_pratice",
         ontime_submit_hw = late_assignment != "late",
         complete_assign = incomplete_assignment != "incomplete",
         have_preknowledge = pre_grade_inmath == "success",
         quick_start_hw = avg_time_start < 0.8) %>% 
  select(stu_id,more_attend:quick_start_hw), by = "stu_id") %>% 
  mutate_if(is.logical, as.numeric) %>%
  select(-stu_id) %>% 
  cor(use = "complete.obs")
```

## Performance-Importance Matrix (4) {.smaller}


```{r}
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  rowwise() %>%
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>% 
  select(stu_id, med_score) %>% 
  ungroup() %>% 
  inner_join(factor_data %>% 
  mutate(more_attend = percent_attend > 0.8,
         ontime_inclass = percent_late_inclass < 0.5,
         rarely_goout = percent_goout < 0.5,
         frequently_interaction = percent_answer_inclass > 0.5,
         frequently_practice = practice != "no_pratice",
         ontime_submit_hw = late_assignment != "late",
         complete_assign = incomplete_assignment != "incomplete",
         have_preknowledge = pre_grade_inmath == "success",
         quick_start_hw = avg_time_start < 0.8) %>% 
  select(stu_id,more_attend:quick_start_hw), by = "stu_id") %>% 
  mutate_if(is.logical, as.numeric) %>%
  select(-stu_id) %>% 
  pivot_longer(cols = more_attend:quick_start_hw) %>% 
  group_by(name) %>% 
  mutate(performance = mean(value),
         importance = cor(value, med_score, use = "complete.obs")) %>% 
  group_by(name) %>%
  summarise(performance = sum(performance, na.rm = T)/404,
            importance = mean(importance)) 
```

## Performance-Importance Matrix (5) {.smaller}


ปัจจัยใดที่น่าจะมีความสำคัญและควรเร่งพัฒนาเพื่อช่วยให้นักเรียนมีการเรียนรู้ที่ดีขึ้นมากที่สุด?

```{r}
library(ggrepel)
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  rowwise() %>%
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>% 
  select(stu_id, med_score) %>% 
  ungroup() %>% 
  inner_join(factor_data %>% 
  mutate(more_attend = percent_attend > 0.8,
         ontime_inclass = percent_late_inclass < 0.5,
         rarely_goout = percent_goout < 0.5,
         frequently_interaction = percent_answer_inclass > 0.5,
         frequently_practice = practice != "no_pratice",
         ontime_submit_hw = late_assignment != "late",
         complete_assign = incomplete_assignment != "incomplete",
         have_preknowledge = pre_grade_inmath == "success",
         quick_start_hw = avg_time_start < 0.8) %>% 
  select(stu_id,more_attend:quick_start_hw), by = "stu_id") %>% 
  mutate_if(is.logical, as.numeric) %>%
  select(-stu_id) %>% 
  pivot_longer(cols = more_attend:quick_start_hw) %>% 
  group_by(name) %>% 
  mutate(performance = mean(value),
         importance = cor(value, med_score, use = "complete.obs")) %>% 
  group_by(name) %>%
  summarise(performance = sum(performance, na.rm = T)/404,
            importance = mean(importance))  %>% 
  ggplot(aes(importance, performance))+
  geom_point(alpha = 0.8, col = "steelblue")+
  geom_text_repel(aes(label = name))+
  geom_vline(xintercept = c(0.4,0.6), linetype = 3, col = "grey30")+
  geom_hline(yintercept = c(0.5), linetype = 3, col = "grey30")+
  scale_x_continuous(breaks=c(0,0.2,0.4,0.6,0.8,1.0))+
  theme_light()+
  theme(panel.grid = element_blank())+
  scale_y_continuous(labels = scales::percent_format())+
  ggtitle("Performance-Importance Matrix")
```


## ข้อจำกัดของ Correlation {.smaller}

- **ไม่บอกอัตราการเปลี่ยนแปลง: Correlation วัดเพียงทิศทางและความแข็งแกร่งของความสัมพันธ์ แต่ไม่สามารถบอกขนาดหรืออัตราการเปลี่ยนแปลงของตัวแปรที่สัมพันธ์กันได้**

- ไม่บอกถึงความสัมพันธ์เชิงสาเหตุ (Causation): ค่า correlation ไม่ได้หมายถึงการที่ตัวแปรหนึ่งเป็นสาเหตุของการเปลี่ยนแปลงในอีกตัวแปรหนึ่ง เพียงแค่แสดงความสัมพันธ์เท่านั้น

- การตีความค่าใกล้ 0 อาจทำให้เข้าใจผิด: ค่า correlation ที่ใกล้ 0 อาจถูกมองว่าไม่มีความสัมพันธ์ แต่ในบางกรณีอาจมีความสัมพันธ์ที่ไม่เชิงเส้นหรือซับซ้อนที่ค่า correlation ไม่สามารถวัดได้


## Regression Analysis (1) {.smaller}

- จากข้อจำกัดของ correlation โดยเฉพาะความสามารถในการบอกอัตราการเปลี่ยนแปลงของตัวแปรทำให้การประเมินหรือคาดการณ์แนวโน้มการบรรเทาหรือแก้ปัญหาไม่สามารถทำได้อย่างชัดเจน

- Regression Analysis ถูกพัฒนาขึ้นมาเพื่อแก้ปัญหาดังกล่าว นอกจากนี้ยังมีประสิทธิภาพเหนือว่า correlation อีกหลายประการ


## Regression Analysis (2) {.smaller}

![](img/reg1.png)

## Regression Analysis (3) {.smaller}

![](img/reg2.png){width="80%"}


## Regression Analysis (4) {.smaller}

![](img/reg3.png){width="80%"}


## Simple Regression Analysis (1) {.smaller}

![](img/sim_reg1.png){width="80%"}

## Simple Regression Analysis (2) {.smaller}

![](img/sim_reg2.png){width="80%"}

## Simple Regression Analysis (3) {.smaller}

![](img/sim_reg3.png){width="80%"}

## Simple Regression Analysis (4) {.smaller}

![](img/rsqr.png)

## Simple Regression Analysis (5) {.smaller}

![](img/rsqr2.png)

## Simple Regression Analysis (5) {.smaller}

![](img/reg_output.png){width="50%"}


## Multiple Regression Analysis (1) {.smaller}

![](img/multi_reg1.png)

## Multiple Regression Analysis (2) {.smaller}

![](img/multi_reg2.png){width="80%"}

[https://drive.google.com/file/d/1qk3BvPco3Jd4_xTDfzwW1nKKIsFOxqPB/view?usp=sharing](https://drive.google.com/file/d/1qk3BvPco3Jd4_xTDfzwW1nKKIsFOxqPB/view?usp=sharing)


## Multiple Regression Analysis (3) {.smaller}

![](img/multi_reg3.png){width="80%"}

## Multiple Regression Analysis (4) {.smaller}

<br>

กิจกรรม คลิกที่ลิงค์ด้านล่างเลย

[https://forms.gle/8FMr3JAQPsqxQjjEA](https://forms.gle/8FMr3JAQPsqxQjjEA)


## Multiple Regression Analysis (5) {.smaller}

กลับมาที่ห้องเรียนของอาจารย์มะ เราจะใช้ multiple regression มาช่วยวินิจฉัยปัจจัยที่เป็นปัญหาการเรียนรู้ของนักเรียนได้อย่างไร

- ใช้ผล regression โดยตรง พิจารณาจาก regression coefficient และ standardized regression coefficient

- นำ standardized regression coefficient มาสร้าง performance-importance matrix

```{r}
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  rowwise() %>%
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>% 
  select(stu_id, med_score) %>% 
  ungroup() %>% 
  inner_join(factor_data %>% 
  mutate(less_attend = percent_attend < 0.8,
         late_inclass = percent_late_inclass > 0.5,
         frequently_goout = percent_goout > 0.5,
         less_interaction = percent_answer_inclass < 0.5,
         less_practice = practice == "no_pratice",
         late_submit_hw = late_assignment == "late",
         incomplete_assign = incomplete_assignment == "incomplete",
         no_preknowledge = pre_grade_inmath != "success",
         late_start_hw = avg_time_start > 0.8) %>% 
  select(stu_id, less_attend:late_start_hw), by = "stu_id") %>% 
  mutate_if(is.logical, as.numeric) %>% 
  glimpse()
```


## Multiple Regression Analysis (6) {.smaller}


ใช้ผลการวิเคราะห์ multiple regression โดยตรง ผลที่ได้เป็นอย่างไร ?

<div style="font-size: 90%;">

```{r}
reg_summary <- data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  rowwise() %>%
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>% 
  select(stu_id, med_score) %>% 
  ungroup() %>% 
  inner_join(factor_data %>% 
  mutate(less_attend = percent_attend < 0.8,
         late_inclass = percent_late_inclass > 0.5,
         frequently_goout = percent_goout > 0.5,
         less_interaction = percent_answer_inclass < 0.5,
         less_practice = practice == "no_pratice",
         late_submit_hw = late_assignment == "late",
         incomplete_assign = incomplete_assignment == "incomplete",
         no_preknowledge = pre_grade_inmath != "success",
         late_start_hw = avg_time_start > 0.8) %>% 
  select(stu_id, less_attend:late_start_hw), by = "stu_id") %>% 
  mutate_if(is.logical, as.numeric) %>% 
  with(lm(med_score ~ . -stu_id, data = .)) %>% 
  summary()

reg_summary 
```
</div>


## Performance-Importance Matrix (Revisited) {.smaller}


```{r}
data %>% 
  select(stu_id,quiz1_7.5, quiz2_7.5, quiz3_15) |>
  rename(quiz1 = quiz1_7.5, quiz2 = quiz2_7.5, quiz3 = quiz3_15) %>% 
  mutate(quiz1 = quiz1*100/7.5,
         quiz2 = quiz2*100/7.5,
         quiz3 = quiz3*100/15) %>% 
  rowwise() %>%
  mutate(med_score = median(c(quiz1, quiz2, quiz3))) %>% 
  select(stu_id, med_score) %>% 
  ungroup() %>% 
  inner_join(factor_data %>% 
  mutate(more_attend = percent_attend > 0.8,
         ontime_inclass = percent_late_inclass < 0.5,
         rarely_goout = percent_goout < 0.5,
         frequently_interaction = percent_answer_inclass > 0.5,
         frequently_practice = practice != "no_pratice",
         ontime_submit_hw = late_assignment != "late",
         complete_assign = incomplete_assignment != "incomplete",
         have_preknowledge = pre_grade_inmath == "success",
         quick_start_hw = avg_time_start < 0.8) %>% 
  select(stu_id,more_attend:quick_start_hw), by = "stu_id") %>% 
  mutate_if(is.logical, as.numeric) %>%
  select(-stu_id) %>% 
  pivot_longer(cols = more_attend:quick_start_hw) %>% 
  group_by(name) %>% 
  mutate(performance = mean(value),
         importance = cor(value, med_score, use = "complete.obs")) %>% 
  group_by(name)-> perform_data_temp

imp_reg <- c(0.8863711, 8.6148126, 5.0869316, 40.4440224, 7.1807672, 0.7586597, 0.7774931, 0.7774931, 6.7170155)

perform_data_temp %>% 
  group_by(name) %>% 
  summarise(performance = sum(performance, na.rm = T)/404,
         importance_correlatioin = mean(importance)) %>% 
  ungroup() %>% 
  mutate(importance_regression = imp_reg)->perform_mat

perform_mat
```

## Performance-Importance Matrix (Revisited) {.smaller}


```{r fig.width=12, fig.height= 5}
p1<-perform_mat %>% 
  ggplot(aes(x = importance_correlatioin, y = performance))+
  geom_point(alpha = 0.8, col ="steelblue")+
  geom_text_repel(aes(label = name))+
  geom_hline(yintercept = 0.5, linetype = 3, col = "grey30")+
  geom_vline(xintercept = 0.6, linetype = 3, col = "grey30")+
  theme_light()+
  theme(panel.grid = element_blank())+
  ggtitle("Performance-Importance Matrix (using Correlation)")
  
  
p2<- perform_mat %>% 
  ggplot(aes(x = importance_regression, y = performance))+
  geom_point(alpha = 0.8, col ="steelblue")+
  geom_text_repel(aes(label = name))+
  geom_hline(yintercept = 0.5, linetype = 3, col = "grey30")+
  geom_vline(xintercept = 0.6, linetype = 3, col = "grey30")+
  theme_light()+
  theme(panel.grid = element_blank())+
  ggtitle("Performance-Importance Matrix (using Regression)")


p1+p2
```

