bs_rec <- base_rec %>%
step_bs(x, knots = tune(), degree = tune())
# natural spline
ns_rec <- base_rec %>%
step_ns(x, deg_free = 3)
# basis spline
bs_rec <- base_rec %>%
step_bs(x, knots = tune(), degree = 3)
# natural spline
ns_rec <- base_rec %>%
step_ns(x, deg_free = 3)
fit_spline1<-linear_reg() %>%
set_engine("lm") %>%
set_mode("regression")
folds<-vfold_cv(train, v=5)
folds<-vfold_cv(train, v=5, repeat=3)
folds<-vfold_cv(train, v=5, repeats=3)
tune_results<-workflow()%>%
add_recipe("ns_rec") %>%
add_model(fit_spine1) %>%
tune_grid(resamples=folds,
grid=20,
control = control_grid(verbose = T,
save_pred = T))
fit_spline1<-linear_reg() %>%
set_engine("lm") %>%
set_mode("regression")
folds<-vfold_cv(train, v=5, repeats=3)
tune_results<-workflow()%>%
add_recipe("ns_rec") %>%
add_model(fit_spine1) %>%
tune_grid(resamples=folds,
grid=20,
control = control_grid(verbose = T,
save_pred = T))
tune_results<-workflow()%>%
add_recipe("ns_rec") %>%
add_model("fit_spline1") %>%
tune_grid(resamples=folds,
grid=20,
control = control_grid(verbose = T,
save_pred = T))
tune_results<-workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
tune_grid(resamples=folds,
grid=20,
control = control_grid(verbose = T,
save_pred = T))
# basis spline
bs_rec <- base_rec %>%
step_bs(x, knots = tune(), degree = 3)
folds<-vfold_cv(train, v=5, repeats=3)
tune_results<-workflow()%>%
add_recipe(bs_rec) %>%
add_model(fit_spline1) %>%
tune_grid(resamples=folds,
grid=20,
control = control_grid(verbose = T,
save_pred = T))
# basis spline
bs_rec <- base_rec %>%
step_bs(x, degree = tune())
fit_spline1<-linear_reg() %>%
set_engine("lm") %>%
set_mode("regression")
folds<-vfold_cv(train, v=5, repeats=3)
tune_results<-workflow()%>%
add_recipe(bs_rec) %>%
add_model(fit_spline1) %>%
tune_grid(resamples=folds,
grid=20,
control = control_grid(verbose = T,
save_pred = T))
tune_results %>% collect_metrics()
tune_results %>% autoplot()
# natural spline
ns_rec <- base_rec %>%
step_ns(x, deg_free = tune())
fit_spline1<-linear_reg() %>%
set_engine("lm") %>%
set_mode("regression")
folds<-vfold_cv(train, v=5, repeats=3)
tune_results<-workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
tune_grid(resamples=folds,
grid=20,
control = control_grid(verbose = T,
save_pred = T))
tune_results %>% collect_metrics()
tune_results %>% collect_predictions()
tune_results %>%
finalize_workflow(bestshow(tune_results,1))%>%
last_fit(split) %>%
collect_prediction()
tune_results %>%
finalize_workflow(bestshow(tune_results,1))%>%
last_fit(split)
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(bestshow(tune_results,1))%>%
last_fit(split)
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(showbest(tune_results,1))%>%
last_fit(split)
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1))%>%
last_fit(split)
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split)
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions()
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>%
ggplot(aes(x=y, y=.pred))+
geom_point()
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>%
ggplot(aes(x=x, y=y))+
geom_point()
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions()
test <- testing(split)
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>%
ggplot(aes(x=x, y=.pred))+
geom_point(data=test, aes(x = x, y=y))
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>%
ggplot(aes(x=x, y=.pred))+
geom_point(data=test, aes(x = x, y=y))+
geom_line()
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>%
ggplot()+
geom_point(data=test, aes(x = x, y=y))+
geom_line(aes(x=x, y=.pred))
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>%
ggplot()+
#geom_point(data=test, aes(x = x, y=y))+
geom_line(aes(x=x, y=.pred))
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions()
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>%
bind_cols(data)
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>%
bind_cols(data, pred=.pred)
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() %>% temp
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions() ->  temp
data$pred<-temp$.pred
ggplot(data=data)+
#geom_point(data=test, aes(x = x, y=y))+
geom_line(aes(x=x, y=.pred))
ggplot(data=data)+
#geom_point(data=test, aes(x = x, y=y))+
geom_line(aes(x=x, y=pred))
ggplot(data=data)+
#geom_point(data=test, aes(x = x, y=y))+
geom_line(aes(x=x, y=pred))+
geom_point(aes(x=x,y=y))
workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
finalize_workflow(show_best(tune_results,1, metric = "rsq"))%>%
last_fit(split) %>%
collect_predictions()
tune_results %>% autoplot()
?`fit-workflow`
?fit
fit<-workflow()%>%
add_recipe(ns_rec) %>%
add_model(fit_spline1) %>%
fit(data=train)
step_bs(x, degree = 3
# basis spline
bs_rec <- base_rec %>%
step_bs(x, degree = 3)
fit<-workflow()%>%
add_recipe(bs_rec) %>%
add_model(fit_spline1) %>%
fit(data=train)
fit
pred<-predict(fit)
pred<-predict(fit%>%extract_fit_parsnip())
pred<-predict(fit%>%extract_fit_parsnip(), new_data=train)
pred<-predict(fit, new_data=train)
pred
plot(train$x, pred$.pred)
# basis spline
bs_rec <- base_rec %>%
step_bs(x, degree = 1, knots=1)
fit<-workflow()%>%
add_recipe(bs_rec) %>%
add_model(fit_spline1) %>%
fit(data=train)
# basis spline
bs_rec <- base_rec %>%
step_bs(x, degree = 1, knots=1)
fit<-workflow()%>%
add_recipe(bs_rec) %>%
add_model(fit_spline1) %>%
fit(data=train)
fit<-fit_spline1 %>%
fit(data=bs_rec%>%prep()%>%juice())
fit<-fit_spline1 %>%
fit(y~.,data=bs_rec%>%prep()%>%juice())
bs_rec%>%prep()%>%juice()
base_rec <- recipe(y~., data=train)
fit<-fit_spline1 %>%
fit(y~.,data=bs_rec%>%prep()%>%juice())
library(dplyr)
dat<-read.csv("/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/เอกสารประกอบการสอน/Machine Learning/เอกสาร/ep3_classification/classification.csv")
glimpse(dat)
glimpse(dat, width=50)
?weight_func()
dat<-read.csv("/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/เอกสารประกอบการสอน/Machine Learning/เอกสาร/ep2_regression/criminal.csv")
glimpse(dat)
glimpse(dat, width=5)
glimpse(dat, width=6)
?read.csv()
library(readr)
dat<-read_r("/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/เอกสารประกอบการสอน/Machine Learning/เอกสาร/ep2_regression/criminal.csv")
dat<-read_csv("/Users/siwachoat/Library/Mobile Documents/com~apple~CloudDocs/เอกสารประกอบการสอน/Machine Learning/เอกสาร/ep2_regression/criminal.csv")
glimpse(dat, width=6)
library(ggplot2)
library(dplyr)
set.seed(123)
x<-runif(1000,0,8)
y<-rnorm(1000, sin(x), 0.5)
data <- data.frame(x,y)
data %>% ggplot()+
geom_point(aes(x=x, y=y),col="steelblue", alpha=0.6)+
theme_light()
head(data)
data %>%
mutate(x2 = x^2)
## method
data<-data %>%
mutate(x2 = x^2,
x3 = x^3)
head(data)
fit<-lm(y~x+x2+x3, data=data)
summary(fit)
pred.poly<-predict(fit)
head(pred.poly)
data$pred3<-pred.poly
head(data)
data %>% ggplot(aes(x=x))+
geom_point(aes(y=y),col="steelblue", alpha=0.6)+
theme_light()
data %>% ggplot(aes(x=x))+
geom_point(aes(y=y),col="steelblue", alpha=0.6)+
geom_line(aes(y=pred3),col="orange",linewidth=1.5)+
theme_light()
data %>% ggplot(aes(x=x))+
geom_point(aes(y=y),col="steelblue", alpha=0.6)+
geom_line(aes(y=pred3),col="orange",linewidth=1.5)+
theme_light(
)
?I()
set.seed(123)
x<-runif(1000,0,8)
y<-rnorm(1000, sin(x), 0.5)
data <- data.frame(x,y)
head(data)
lm(y~x+x^2+x^3, data= data)
## method 2
lm(y~x+I(x^2)+I(x^3), data=data)
## method 2
fit<-lm(y~x+I(x^2)+I(x^3), data=data)
summary(fit)
pred.poly<-predict(fit)
head(pred.poly)
data$pred3<-pred.poly
head(data)
data %>% ggplot(aes(x=x))+
geom_point(aes(y=y),col="steelblue", alpha=0.6)+
geom_line(aes(y=pred3),col="orange",linewidth=1.5)+
theme_light()
fit<-lm(y~x+x2+x3, data=data)
summary(fit)
## method 1
data<-data %>%
mutate(x2 = x^2,
x3 = x^3)
fit<-lm(y~x+x2+x3, data=data)
summary(fit)
lm(y~x+I(x^2)+I(x^3), data=data)
head(data)
cor(data%>%select(y,x,x2,x3))
data %>% ggplot(aes(x = x, y= x2))+
geom_point()
data %>% ggplot(aes(x = x, y= x2))+
geom_point()+
geom_smooth()
data %>% ggplot(aes(x = x, y= x2))+
geom_point()+
geom_smooth(method="lm")
data %>% ggplot(aes(x = x, y= x3))+
geom_point()+
geom_smooth(method="lm")
data %>% ggplot(aes(x = x2, y= x3))+
geom_point()+
geom_smooth(method="lm")
library(cars)
library(car)
vif(fit)
data %>% ggplot(aes(x = x, y= x2))+
geom_point()+
geom_smooth(method="lm")
head(data)
## method 3
data %>%
mutate(x_c = x-mean(x),#centering
x_c2 = x_c^2,
x_c3 = x_c^3
) %>%
ggplot(aes(x = x_c, y= x_c2))+
geom_point()+
geom_smooth(method="lm")
## method 3
data %>%
mutate(x_c = x-mean(x),#centering
x_c2 = x_c^2,
x_c3 = x_c^3
) %>%
ggplot(aes(x = x_c, y= x_c3))+
geom_point()+
geom_smooth(method="lm")
## method 3
data<-data %>%
mutate(x_c = x-mean(x),#centering
x_c2 = x_c^2,
x_c3 = x_c^3
)
fit<-lm(y~x_c+x_c2+x_c3, data=data)
summary(fit)
vif(fit)
data %>% ggplot(aes(x=x))+
geom_point(aes(y=y),col="steelblue", alpha=0.6)+
geom_line(aes(y=pred3),col="orange",linewidth=1.5)+
theme_light()
?poly
lm(y~poly(x,3), data=data)
fit<-lm(y~poly(x,3), data=data)
vif(fit)
pred.poly<-predict(fit)
head(pred.poly)
data$pred_orthogonal<-pred.poly
head(data)
data %>% ggplot(aes(x=x))+
geom_point(aes(y=y),col="steelblue", alpha=0.6)+
geom_line(aes(y=pred3),col="orange",linewidth=1.5)+
geom_line(aes(y=pred_orthogonal),col="maroon",linewidth=1.5)+
theme_light()
data %>% ggplot(aes(x=x))+
geom_point(aes(y=y),col="steelblue", alpha=0.6)+
geom_line(aes(y=pred3),col="orange",linewidth=1.5)
data %>% ggplot(aes(x=x))+
geom_point(aes(y=y),col="steelblue", alpha=0.6)+
geom_line(aes(y=pred3),col="orange",linewidth=1.5)+
geom_line(aes(y=pred_orthogonal),col="maroon",linewidth=1.5)+
theme_light()
fit
preproc <- recipe(salary ~ ., data= train) %>%
step_select(-X)%>%
step_poly(yrs.service, yrs.since.phd, degree = tune()) %>%
step_dummy(rank, discipline, sex)
preproc <- recipe(salary ~ ., data= train) %>%
step_select(-X)%>%
step_poly(yrs.service, yrs.since.phd, degree = tune()) %>%
step_dummy(rank, discipline, sex)
preproc <- recipe(salary ~ ., data= train) %>%
step_select(-X)%>%
step_poly(yrs.service, yrs.since.phd, degree = tune()) %>%
step_dummy(rank, discipline, sex)
preproc <- recipe(salary ~ ., data= train) %>%
step_select(-X)%>%
step_poly(yrs.service, yrs.since.phd, degree = tune()) %>%
step_dummy(rank, discipline, sex)
library(ggplot2)
library(dplyr)
set.seed(123)
x<-runif(1000,0,8)
y<-rnorm(1000, sin(x), 0.5)
data <- data.frame(x,y)
data %>% ggplot()+
geom_point(aes(x=x, y=y),col="steelblue", alpha=0.6)+
theme_light()
library(tidyr)
linear.fit <- lm(y~x, data = data)
poly2.fit <- lm(y~x + I(x^2), data = data)
poly3.fit <- lm(y~x+I(x^2)+I(x^3), data=data)
poly4.fit <- lm(y~x+I(x^2)+I(x^3)+I(x^4), data=data)
summary(poly2.fit)
summary(poly3.fit)
summary(poly4.fit)
data %>% bind_cols(linear = predict(linear.fit),
quadratic = predict(poly2.fit),
cubic = predict(poly3.fit),
quartic = predict(poly4.fit)) %>%
gather(linear:quartic, key = "model", value = "pred") %>%
mutate(model = factor(model, levels=c("linear",
"quadratic",
"cubic",
"quartic"))) %>%
ggplot(aes(x=x, y=y))+
geom_point(col = "steelblue", alpha=0.7)+
geom_line(aes(y=pred))+
facet_wrap(vars(model))
library(car)
vif(poly2.fit)
vif(poly3.fit)
data %>%bind_cols(
pred2 = data %>%
mutate(x_c = x-mean(x)) %>%
lm(y~x_c+I(x_c^2),data=.) %>%
predict(.)
)%>%
ggplot(aes(x=x,y=y))+
geom_point(col="steelblue",alpha=0.6)+
geom_line(aes(y=pred2))
data %>%
mutate(x_c = x-mean(x)) %>%
lm(y~x_c+I(x_c^2),data=.) %>%
vif()
data %>%
mutate(x_c = x-mean(x)) %>%
lm(y~x_c+I(x_c^2)+I(x_c^3),data=.) %>%
vif()
poly2.fit <- lm(y~poly(x,2), data=data)
summary(poly2.fit)
data %>% bind_cols(pred = predict(poly2.fit)) %>%
ggplot(aes(x=x, y=y))+
geom_point()+
geom_line(aes(y=pred), col="orange", linewidth = 1.5)
library(tidymodels)
dat <- read.csv("https://raw.githubusercontent.com/ssiwacho/2758688_ML/main/week%201/TeacherSalaryData.csv")
head(dat)
set.seed(1234)
split <- initial_split(dat, prop = 0.8)
train <- training(split)
test <- testing(split)
train<-train %>%
mutate(salary = log(salary))
?collect_predictions
