{"title":"PCR and PLS Regression","markdown":{"yaml":{"title":"PCR and PLS Regression","author":"ผศ.ดร.สิวะโชติ ศรีสุทธิยากร","toc":true,"toc-depth":3,"toc-title":"สารบัญ","theme":"default"},"headingText":"Principal Component Analysis (PCA)","containsRefs":false,"markdown":"\n\nบทเรียนนี้จะกล่าวถึง regression models ที่เป็นตัวขยายจาก linear regression\n\n\nทดลองวิเคราะห์ PCA เพื่อหาจำนวนองค์ประกอบที่เหมาะสมก่อน\n\nPCA เป็นเทคนิคที่ใช้สำหรับลดจำนวนมิติหรือตัวแปรในชุดข้อมูล หลักการคร่าว ๆ คือ PCA จะสร้างตัวแปรใหม่ที่อยู่ในรูปผลรวมเชิงเส้นของตัวแปรเดิม ทั้งนี้น้ำหนักในการรวมผลรวมเชิงเส้นดังกล่าวจะพิจารณาจากความสัมพันธ์เชิงเส้นระหว่างตัวแปรเดิม PCA จะสร้างตัวแปรใหม่ที่มีจำนวนเท่ากับตัวแปรเดิม อย่างไรก็ตามตัวแปรใหม่ที่สร้างขึ้นจะมีความแปรปรวนของตัวแปรเดิมที่ลดหล่นกันลงไป การนำตัวแปรใหม่มาใช้จึงไม่จำเป็นต้องนำมาหลายตัว นำมาเฉพาะตัวแปร ๆ ที่มีความแปรปรวนรวมกันคิดเป็นร้อยละส่วนใหญ่ของตัวแปรเดิมก็เพียงพอจะนำไปใช้เป็นตัวแปรของตัวแปรเดิมได้แล้ว\n\nรูปด้านล่างแสดงตัวอย่างให้เห็นว่าจากเดิมที่มีตัวแปร 2 ตัวได้แก่ x กับ y เนื่องจากตัวแปรทั้งสองมีความสัมพันธ์เชิงเส้นกันค่อยข้างสูง เมื่อนำมาสร้างตัวแปรใหม่ (ที่เรียกว่า องค์ประกอบหลัก) จะได้องค์ประกอบหลักสองตัว โดยที่องค์ประกอบแรกสกัดความแปรปรวนของตัวแปรเดิม x, y ออกมาได้เกือบทั้งหมด ทำให้องค์ประกอบที่สองเหลือความแปรปรวนเพียงนิดเดียว และไม่จำเป็นต้องนำไปใช้ต่อ\n\n![](images/image-452062936.png){width=\"460\"}\n\nในเชิงเทคนิคเราเรียกความแปรปรวนที่องค์ประกอบสกัดได้จากตัวแปรเดิมนี้ว่า eigenvalue\n\nประโยชน์ของ PCA สามารถนำไปประยุกต์ใช้ได้หลากหลาย\n\n1.  Descriptive Technique\n2.  Dimensionality reduction\n3.  Anomaly detection\n4.  Noise reduction\n5.  Decorrelation\n\nPCA สามารถใช้ได้กับข้อมูลเชิงปริมาณเท่านั้น นอกจากนี้ PCA ยังมีความไวต่อหน่วยข้อมูล กล่าวคือข้อมูลที่มีหน่วยแตกต่างกันมีความเป็นไปได้ที่จะทำให้ผลการสกัดองค์ประกอบมีความคลาดเคลื่อน ก่อนการวิเคราะห์จึงควร standardized ข้อมูลเสมอ\n\nเอกสารประกอบเรื่อง PCA [กดเลย](slides/PCA.pdf)\n\n```{r}\nlibrary(FactoMineR)\nlibrary(factoextra)\n```\n\n## Data\n\n```{r}\nlibrary(dplyr)\nlibrary(tidyr)\ndat <- read.csv(\"basket.csv\")\nhead(dat)\ndat<-dat[,-c(1,2)]\nhead(dat)\nglimpse(dat, width=60)\n```\n\n## Standardization\n\nข้อตกลงเบื้องต้นของ PCA คือข้อมูลที่จะนำมาสกัดองค์ประกอบควรจะต้องเป็นข้อมูลที่อยู่ในหน่วยเดียวกัน\n\n```{r}\npca_dat <- scale(dat, center =T, scale =T)\nsummary(pca_dat)\n```\n\n## สำรวจข้อมูล\n\n```{r fig.height=4}\nlibrary(corrr)\nlibrary(ggcorrplot)\ncorr_matrix <- cor(pca_dat)\nggcorrplot(corr_matrix)+\n  theme(text=element_text(family=\"ChulaCharasNew\", size=6))\n```\n\nการวิเคราะห์ PCA ใน R สามารถทำได้หลายวิธีมาก ๆ ในบทเรียนนี้จะใช้ฟังก์ชัน `PCA()` จาก package FactoMineR\n\n```{r fig.width = 6}\nlibrary(FactoMineR)\nlibrary(factoextra)\noutput.pca <- princomp(pca_dat)\nsummary(output.pca)\noutput.pca %>%objects()\noutput.pca$loadings  \n\nfviz_eig(output.pca, addlabels = TRUE)\nfviz_pca_var(output.pca)\n\n```\n\n## Visualizing the Results\n\n-   `get_eigenvalue(res.pca)`: Extract the eigenvalues/variances of principal components\n\n-   `fviz_eig(res.pca)`: Visualize the eigenvalues\n\n-   `get_pca_ind(res.pca)`, `get_pca_var(res.pca)`: Extract the results for individuals and variables, respectively.\n\n-   `fviz_pca_ind(res.pca)`, `fviz_pca_var(res.pca)`: Visualize the results individuals and variables, respectively.\n\n-   `fviz_pca_biplot(res.pca)`: Make a biplot of individuals and variables.\n\n# PCA Regression\n\nPCR (Massy, 1965) เป็นการผสมกันระหว่างเทคนิค PCA กับ OLS regression หลักการนี้ยังสามารถนำไปใช้ร่วมกับ machine learning ตัวอื่น ๆ ได้อีกด้วย\n\n![Boehmke, and Greenwell (2020)](images/image-1396714705.png){width=\"451\"}\n\nวิธีการนี้จะมี hyperparameter 1 ตัวได้แก่ จำนวนองค์ประกอบหลัก ชุดข้อมูลที่ใช้เป็นตัวอย่างจะใช้ชุดข้อมูล [`PCR_PLS.csv`](PCR_PLS.csv)\n\n```{r}\ndat <- read.csv(\"PCR_PLS.csv\")\ndat <- dat[,-1]\nhead(dat)\ndim(dat)\n```\n\n## Spliting data\n\n```{r}\nlibrary(tidymodels)\nsplit<-initial_split(dat, prop = 0.7)\nsplit\ntrain <- training(split)\ntest <- testing(split)\n```\n\n## Preprocessing\n\n```{r}\npreproc <- recipe(y ~. , data=train) %>%\n  step_normalize(all_numeric_predictors()) %>%\n  step_pca(all_numeric_predictors(), num_comp = tune())\n```\n\n## Model specification & Tune Grid\n\nให้เป็นแบบฝึกหัดกับนิสิต\n\nนิสิตคิดว่า PCR มีข้อจำกัดหรือไม่ อย่างไร\n\n# PLS Regression\n\nPLS regression มี concept ที่เกือบจะเหมือน PCR regression แต่มีความแตกต่างกันดังรูปง\n\n![](images/image-377921756.png){width=\"460\"}\n\nการ fit pls regression สามารถทำได้ดังรูปด้านล่าง\n\n![](images/image-301907320.png){width=\"465\"}\n\n![](images/image-731878720.png){width=\"447\"}\n\n## กิจกรรม\n\nสร้างโมเดลทำนาย PLS regression โดยใช้ชุดข้อมูล PCR_PLS.csv เหมือนเดิม\n\n```{r}\npreproc <- recipe(y ~. , data= train) %>%\n  step_normalize(all_numeric_predictors())\n\npls_mod <- parsnip::pls(predictor_prop = tune(),\n               num_comp = tune()) %>%\n  set_engine(\"mixOmics\") %>%\n  set_mode(\"regression\")\n\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"toc-depth":3,"output-file":"07MoreRegs.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.269","editor":"visual","urlcolor":"steelblue","linkcolor":"steelblue","theme":{"light":["pandoc","../theme.scss"]},"mainfont":"Krub","code-copy":true,"title":"PCR and PLS Regression","author":"ผศ.ดร.สิวะโชติ ศรีสุทธิยากร","toc-title":"สารบัญ"},"extensions":{"book":{"multiFile":true}}}}}