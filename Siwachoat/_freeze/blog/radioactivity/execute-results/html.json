{
  "hash": "aaf41fdee888f39327c6e6d5b553f792",
  "result": {
    "engine": "knitr",
    "markdown": "---\ndate: \"2024-10-09\"\ntitle: \"Missing Value Analysis\"\ncategories:\n  - Machine Learning\n  - Missing Values\n  - R Programming\nimage: img/missing_value.png\nmessage: false\nwarning: false\n---\n\n\n\n\n\nที่ผ่านมาเรายังทำงานโดยไม่ได้เจอกับปัญหา missing value เท่าไหร่นัก อย่างไรก็ตามในสถานการณ์จริงปัญหา missing value เป็นปัญหาใหญ่เหมือนกัน และสามารถสร้างผลกระทบเชิงลบต่อโมเดลการวิเคราะห์ได้อย่างมาก ซึ่งส่งผลทั้งความตรงภายในและความตรงภายนอกของผลการวิเตราะห์\n\nการสูญหายของข้อมูลเป็นไปได้จากสาเหตุที่หลากหลาย ขึ้นอยู่กับบริบทหรือวิธีการเก็บรวบรวมข้อมูลที่ผู้วิจัยใช้ด้วย\n\n- ใน survey ผู้ตอบอาจจะลืมตอบบาง item โดยบังเอิญ ไม่ตอบเพราะไม่รู้หรือไม่สนใจ ไม่ตอบเพราะไม่สะดวก หรือไม่ตอบเพราะไม่มีคำตอบที่ตรงกับตัวเลือกที่ต้องการ\n\n- การเก็บรวบรวมข้อมูลผ่านระบบเช่น LMS บางตัวชี้วัดอาจมีข้อมูลขาดหายเพราะพฤติกรรมบางอย่างของนักเรียน เช่น ต้องการวัดระยะเวลาที่นักเรียนแต่ละคนใช้ในการทำ quiz หรือการบ้านที่มอบหมาย แต่นักเรียนไม่เข้ามาทำการบ้าน คะแนนค่านี้ก็จะเป็นค่าสูญหาย\n\n- การเก็บรวบรวมข้อมูลระยะยาวที่จะต้องเก็บข้อมูลจากหน่วยข้อมูลเดียวกันหลาย ๆ ครั้ง หากระหว่างทางมีหน่วยข้อมูลออกจากระบบก็เกิดข้อมูลขาดหายได้เช่นกัน\n\n- การเก็บข้อมูลจากฐานข้อมูลของหน่วยงานต่าง ๆ เช่น สพฐ. สทศ. สมศ. รวมทั้งหน่วยงานภาครัฐอื่น ๆ แล้วนำมารวมกันเพื่อดำเนินการวิเคราะห์ ก็มีโอกาสที่บางหน่วยข้อมูลขาดหายไปเนื่องจากความแตกต่างของการเก็บข้อมูลในแต่ละฐาน\n\n- นอกจากนี้ยังมีสาเหตุอื่น ๆ อีกมากมาย \n\nอัลกอริทึมและโมเดลการวิเคราะห์ข้อมูลส่วนใหญ่มักมีข้อสมมุตินึงที่ผู้สอนส่วนใหญ่ก็มักไม่ได้กล่าวถึงคือ ข้อมูลที่นำมาวิเคราะห์จะต้องเป็นข้อมูลที่ไม่มีค่าสูญหาย (เรียกว่า complete data) อย่างไรก็ตามหากมองย้อนตอนที่เราวิเคราะห์ข้อมูลจริง ๆ มีโอกาสน้อยมากที่เราจะพบกับ complete data ดังกล่าว\n\nกระบวนการปกติที่เรามักใช้ในการจัดการข้อมูลสูญหายคือ\n\n1. ลบหน่วยข้อมูลที่มีค่าสูญหายออกไปจากการวิเคราะห์ (listwise deletion)\n\n2. แทนค่าสูญหายด้วยค่าที่เหมาะสม\n\nทั้งสองวิธีการผลลัพธ์สุดท้ายที่ได้คือข้อมูลสมบูรณ์เหมือนกัน (แต่ ...)\n\nบทเรียนวันนี้เราจะพูดถึงวิธีการที่ใช้แก้ปัญหาค่าสูญหาย โดยจะพยายามกล่าวถึงหลาย ๆ วิธีทั้งวิธีการที่ผู้วิเคราะห์ทั่วไปมักนิยมใช้กัน และวิธีการสมัยใหม่ที่เหมาะสมกับการวิเคราะห์แต่ละวัตถุประสงค์\n\n## ขั้นตอนการวิเคราะห์ข้อมูลที่มีค่าสูญหาย\n\nการวิเคราะห์ข้อมูลเมื่อมีค่าสูญหายนั้นมีแนวทางหรือวิธีดำเนินงานที่หลากหลายขึ้นอยู่กับว่าเราอ้างอิงสำนักไหน นักสถิติหรือนักวิทยาการข้อมูลคนไหน กลุ่มไหน\n\n- Little and Rubin (2002) <-- classic \n\n- Allison (2001)\n\n- [Khun, & Johnson (2019)](http://www.feat.engineering/)\n\n\nอย่างไรก็ตามแนวทางโดยทั่วไปที่เหมือนกันประกอบด้วย\n\n1. การสำรวจและระบุค่าสูญหาย\n\n2. การวิเคราะห์รูปแบบหรือกลไกของค่าสูญหาย\n\n3. การจัดการค่าสูญหาย\n\n## กลไกการเกิดค่าสูญหาย\n\nสำนัก classic คือ Little และ Rubin นำเสนอ framework ของค่าสูญหายที่ปัจจุบันก็มีการใช้อย่างแพร่หลายมาก ๆ โดยทั้งสองจำแนกประเภทของค่าสูญหายออกเป็น 3 ประเภท การอธิบายลักษณะการสูญหายทั้ง 3 นี้ใช้โมเดลความน่าจะเป็น\n\n### Missing Completely at Random (MCAR) \n\nกล่าวคือ ถ้าการมีอยู่ของข้อมูลที่ขาดหายไปในตัวแปรหนึ่ง ๆ ไม่มีความสัมพันธ์กับตัวแปรอื่น ๆ ที่สังเกตเห็นหรือไม่ได้สังเกตเห็น ข้อมูลนั้นจะถือว่าขาดหายไปแบบสุ่มโดยสมบูรณ์ (Missing Completely At Random - MCAR)\n\nกำหนดให้ $m{ij}$ เป็นตัวแปร dummy แสดงการสูญหายของหน่วยข้อมูลที่ i ในตัวแปรที่ j ถ้ามีค่าเท่ากับ 1 คือเป็นค่าสูญหาย และ $X_{obs}$ คือข้อมูลที่ผู้วิเคราะห์สามารถสังเกตได้ในชุดข้อมูล ส่วน $X_{mis}$ คือข้อมูลที่สูญหาย\n\nการสูญหายแบบ MCAR สามารถเขียนอธิบายได้ดังนี้\n\n$$\np(m_{ij} = 1 | X_{obs}, X_{mis}) = p\n$$\n\nการ simulation ด้านล่างแสดงกลไกการเกิดค่าสูญหายแบบ MCAR ได้อย่างชัดเจน\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\ndata <- read_csv(\"/Users/choat/Downloads/exam.csv\")\nglimpse(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 387\nColumns: 5\n$ ach                  <dbl> 52.159780, 30.784999, 39.607737, 55.985351, 31.80…\n$ learning_performance <dbl> 32.666667, 10.666667, 28.000000, 52.666667, 15.55…\n$ ontime_class         <chr> \"used to late\", \"used to late\", \"never late\", \"us…\n$ engage               <chr> \"no engage\", \"much engage\", \"much engage\", \"much …\n$ practice             <chr> \"do practice\", \"do not praction\", \"do not practio…\n```\n\n\n:::\n:::\n\n\nสมมุติว่ามีการสูญหายแบบ MCAR ขึ้นบนตัวแปร `ach` ร้อยละ 20 นั่นเทียบเท่ากับการสุ่มตัวอย่างแบบ SRS ออกจาก vector ของ `ach` ในสัดส่วน 0.2 ดังนี้\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\nset.seed(123)\ndata <- data %>% \n  mutate(ach_mcar = ifelse(runif(387,0,1)<0.4, NA, ach))\np1<-data %>% \n  pivot_longer(cols=starts_with(\"ach\")) %>% \n  ggplot(aes(x=value))+\n  geom_histogram(aes(fill = name))\n\np2<-data %>% \n  pivot_longer(cols=starts_with(\"ach\")) %>% \n  ggplot(aes(x = value, y=name))+\n  geom_boxplot(aes(fill = name))\n\np1+p2\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-2-1.png){width=768}\n:::\n:::\n\n\n\nการสูญหายแบบ MCAR ไม่ได้ทำให้เกิด bias ในการวิเคราะห์ แต่อาจมีผลกับ precision ของการวิเคราะห์ (ทำไม?)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>% \n  ggplot(aes(x=learning_performance))+\n  geom_point(aes(y=ach),alpha=0.1)+\n  geom_point(data = data %>% filter(is.na(ach_mcar)==T), \n             aes(y=ach), col=\"maroon\", shape = 2)+\n  theme_light()+\n  theme(panel.grid = element_blank())\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndata %>% \n  select(learning_performance, ach, ach_mcar) %>% \n  pivot_longer(cols = c(ach, ach_mcar)) %>% \n  group_by(name) %>% \n  summarise(mean = mean(value, na.rm = T),\n            sd = sd(value,na.rm = T),\n            median = median(value,na.rm = T),\n            cor = cor(learning_performance, value, use = \"complete.obs\"),\n            r2 = cor^2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 6\n  name      mean    sd median   cor    r2\n  <chr>    <dbl> <dbl>  <dbl> <dbl> <dbl>\n1 ach       43.6  17.4   43.9 0.846 0.715\n2 ach_mcar  42.6  17.7   42.4 0.855 0.732\n```\n\n\n:::\n:::\n\n\n\n\n### Missing at Random (MAR)\n\nกล่าวคือ ถ้าการมีอยู่ของข้อมูลที่ขาดหายไปในตัวแปรหนึ่ง ๆ มีความสัมพันธ์กับตัวแปรอื่น ๆ ที่ผู้วิเคราะห์มีข้อมูลสามารถสังเกตค่าได้ โดยไม่เกี่ยวข้องกับข้อมูลที่สูญหายไปของตัวแปรนั้น ข้อมูลนั้นจะถือว่าขาดหายไปแบบ MAR\n\n$$\np(m_{ij} = 1 | X_{obs}, X_{mis}) = f(X_{obs})\n$$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ndata <- data %>% \n  mutate(ach_mar = case_when(\n    learning_performance > 70 | learning_performance < 30 ~ ifelse(runif(387,0,1)<0.4,NA, ach) ,\n    .default = ach\n  )\n  )\np1<-data %>% \n  pivot_longer(cols=starts_with(\"ach\")) %>% \n  ggplot(aes(x=value))+\n  geom_histogram(aes(fill = name))\n\np2<-data %>% \n  pivot_longer(cols=starts_with(\"ach\")) %>% \n  ggplot(aes(x = value, y=name))+\n  geom_boxplot(aes(fill = name))\n\np1+p2\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-4-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>% \n  ggplot(aes(x=learning_performance))+\n  geom_point(aes(y=ach),alpha=0.1)+\n  geom_point(data = data %>% filter(is.na(ach_mar)==T), \n             aes(y=ach), col=\"maroon\", shape = 2)+\n  theme_light()+\n  theme(panel.grid = element_blank())\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndata %>% \n  select(learning_performance, ach, ach_mcar, ach_mar) %>% \n  pivot_longer(cols = c(ach, ach_mcar, ach_mar)) %>% \n  group_by(name) %>% \n  summarise(mean = mean(value, na.rm = T),\n            sd = sd(value,na.rm = T),\n            median = median(value,na.rm = T),\n            cor = cor(learning_performance, value, use = \"complete.obs\"),\n            r2 = cor^2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3 × 6\n  name      mean    sd median   cor    r2\n  <chr>    <dbl> <dbl>  <dbl> <dbl> <dbl>\n1 ach       43.6  17.4   43.9 0.846 0.715\n2 ach_mar   43.1  16.3   43.3 0.831 0.690\n3 ach_mcar  42.6  17.7   42.4 0.855 0.732\n```\n\n\n:::\n:::\n\n\n\n\n\n### Missing Not at Random (MNAR)\n\n- หากการสูญหายไม่ใช่ทั้ง MCAR และ MAR การสูญหายนั้นเป็น MNAR กล่าวในเชิงเทคนิคคือ เป็นการสูญหายที่มีความสัมพันธ์กับค่าที่สูญหายไป และอาจมีความสัมพันธ์กับค่าที่สังเกตได้ด้วย\n\n- กล่าวง่าย ๆ เป็นการสูญหายที่เกิดขึ้นโดยสัมพันธ์กับค่าที่สูญหาย การสูญหายแบบนี้ไม่สามารถอธิบายได้ด้วยข้อมูลที่มี  เช่น\n\n  - ผู้ตอบไม่ตอบคำถามเกี่ยวกับรายได้เพราะรายได้ของตนเองสูงเกินไป\n  \n  - นักเรียนที่มีคะแนนต่ำมากไม่ตอบคำถาม ไม่เข้าเรียน หรือไม่ส่งงานทำให้ครูไม่สามารถประเมินคะแนนให้นักเรียนได้\n\n$$\np(m_{ij} = 1 | X_{obs}, X_{mis}) = f(X_{obs}, X_{mis})\n$$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ndata <- data %>% \n  mutate(ach_mnar = case_when(\n    ach > 50  ~ ifelse(runif(387,0,1)<0.4,NA, ach) ,\n    .default = ach\n  )\n  )\np1<-data %>% \n  pivot_longer(cols=starts_with(\"ach\")) %>% \n  ggplot(aes(x=value))+\n  geom_histogram(aes(fill = name))\n\np2<-data %>% \n  pivot_longer(cols=starts_with(\"ach\")) %>% \n  ggplot(aes(x = value, y=name))+\n  geom_boxplot(aes(fill = name))\n\np1+p2\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>% \n  ggplot(aes(x=learning_performance))+\n  geom_point(aes(y=ach),alpha=0.1)+\n  geom_point(data = data %>% filter(is.na(ach_mnar)==T), \n             aes(y=ach), col=\"maroon\", shape = 2)+\n  theme_light()+\n  theme(panel.grid = element_blank())\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\ndata %>% \n  select(learning_performance, ach, ach_mcar, ach_mar, ach_mnar) %>% \n  pivot_longer(cols = c(ach, ach_mcar, ach_mar, ach_mnar)) %>% \n  group_by(name) %>% \n  summarise(mean = mean(value, na.rm = T),\n            sd = sd(value,na.rm = T),\n            median = median(value,na.rm = T),\n            cor = cor(learning_performance, value, use = \"complete.obs\"),\n            r2 = cor^2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 6\n  name      mean    sd median   cor    r2\n  <chr>    <dbl> <dbl>  <dbl> <dbl> <dbl>\n1 ach       43.6  17.4   43.9 0.846 0.715\n2 ach_mar   43.1  16.3   43.3 0.831 0.690\n3 ach_mcar  42.6  17.7   42.4 0.855 0.732\n4 ach_mnar  40.1  16.7   39.4 0.823 0.678\n```\n\n\n:::\n:::\n\n\n\n\n\n## การสำรวจและระบุค่าสูญหาย\n\nทัศนภาพข้อมูลเป็นเครื่องมือสำคัญที่จะช่วยให้ผู้วิเคราะห์ทำความเข้าใจสภาพการสูญหายของข้อมูลในชุดข้อมูลที่ทำงานด้วย โดยปกตินักวิเคราะห์จะใช้ทั้งทัศนภาพข้อมูลควบคู่กับการวิเคราะห์ผลทางสถิติเพื่อทำความเข้าใจและระบุค่าสูญหายในชุดข้อมูล\n\nอย่างไรก็ตามจากประสบการณ์ของผู้สอน เทคนิคการวิเคราะห์เพื่อสำรวจค่าสูญหายที่ใช้อาจมีความแตกต่างกันขึ้นอยู่กับขนาดของชุดข้อมูลด้วย\n\n- การใช้ทัศนภาพข้อมูลและสถิติพื้นฐานเพื่อสำรวจค่าสูญหายเหมาะกับการทำงานบนชุดข้อมูลขนาดเล็ก\n\n- ข้อมูลขนาดปานหลางหรือขนาดใหญ่อาจจะต้องใช้เทคนิคโดยเฉพาะ ML เข้ามาช่วยเพื่อให้แสดงสภาพการสูญหายของข้อมูลของตัวแปรทั้งหมดได้\n\n\n### Tabulating Missing data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(naniar)\nmiss_var_summary(data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 3\n  variable             n_miss pct_miss\n  <chr>                 <int>    <num>\n1 ach_mcar                156     40.3\n2 ach_mar                  80     20.7\n3 ach_mnar                 66     17.1\n4 ach                       0      0  \n5 learning_performance      0      0  \n6 ontime_class              0      0  \n7 engage                    0      0  \n8 practice                  0      0  \n```\n\n\n:::\n:::\n\n\n\n\n### Visualization for Missing data\n\nเทคนิคทั้งหมดในหัวข้อนี้เหมาะสำหรับใช้กับชุดข้อมูลที่มีขนาดไม่ใหญ่มาก\n\n\n- heatmap\n\n- missing data pattern plot\n\n- co-occurence plot\n\n\n- scatter plot\n\nตัวอย่างมีดังนี้\n\n\n\nการสร้าง heatmap สามารถทำได้หลายวิธีการ ตั้งแต่การสร้างแบบ manual (ซึ่งทำบ่อย ๆ ก็เหนื่อย) ไปจนถึงมีฟังก์ชันสำเร็จรูปจากหลาย library\n\n\n#### heatmap\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## install.packages(\"visdat\")\nlibrary(visdat)\n## create shadow matrix\nvis_dat(data)\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1<-vis_miss(data, cluster = TRUE)\np1\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np2<-vis_miss(data, cluster = TRUE, facet = ontime_class)\np2\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n\n#### md plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## install.packages(\"mice)\nlibrary(mice)\nmd.pattern(data, rotate.names = TRUE)\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-12-1.png){width=768}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    ach learning_performance ontime_class engage practice ach_mnar ach_mar\n231   1                    1            1      1        1        1       1\n47    1                    1            1      1        1        1       1\n43    1                    1            1      1        1        1       0\n29    1                    1            1      1        1        0       1\n37    1                    1            1      1        1        0       0\n      0                    0            0      0        0       66      80\n    ach_mcar    \n231        1   0\n47         0   1\n43         0   2\n29         0   2\n37         0   3\n         156 302\n```\n\n\n:::\n:::\n\n\n\n\n\n#### co-occurence plot\n\nco-occurence plot ช่วยแสดงสภาพการสูญหายที่ลึกกว่า heatmap เพราะมีทั้งมิติความถี่ของการสูญหายเป็นรายตัวแปรซึ่งจำแนกเป็นการสูญหายในตัวแปรเดียว และการสูญหายร่วมกัน\n\nการสูญหายร่วมกันที่มากมีผลทำให้การแก้ปัญหาแบบตัดข้อมูลที่ missing ออกจากไปการวิเคราะห์เริ่มไม่ work (ทำไม?)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(naniar)\ngg_miss_upset(data)\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n#### Scatter plot\n\nแผนภาพการกระจายมีประโยชน์มากสำหรับวิเคราะห์กลไกการสูญหายของข้อมูล\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>% \n  bind_shadow() %>% \n  ggplot(aes(x = learning_performance, y=ach_mar))+\n  geom_point()+\n  geom_rug(aes(x=learning_performance ,col = ach_mar_NA), sides = \"b\")+\n  scale_color_manual(values = c(\"!NA\" = NULL, \"NA\" = \"maroon\"),\n                     labels=c(NULL, \"missing in ach\"))+\n  theme_light()\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\nจากรูปจะเห็นได้อย่างชัดเจนว่าการสูญหายที่เกิดขึ้นใน ach มีความสัมพันธ์กับ learning performance ของนักเรียน ซึ่งสะท้อน MAR mechanism\n\n\n\n### การสำรวจค่าสูญหายสำหรับข้อมูลขนาดใหญ่\n\n\nในกรณีที่ชุดข้อมูลมีขนาดใหญ่  โดยเฉพาะเมื่อมีตัวแปรจำนวนมาก การใช้ heatmap หรือ co-occurence plot อาจมีประสิทธิภาพน้อยลง ลองใช้วิธีการข้างต้นวิเคราะห์สภาพการสูญหายในชุดข้อมูลต่อไปนี้\n\n[ดาวน์โหลด](https://bit.ly/2JoKcqX)\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlarge_data <- read_csv(\"/Users/choat/Downloads/onlinelearning_miss.csv\")\nlarge_data <- large_data %>% select(-1) %>% \n  rename(student_id = X)\n\nmiss_var_summary(large_data) %>% \n  arrange(desc(pct_miss))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 49 × 3\n   variable            n_miss pct_miss\n   <chr>                <int>    <num>\n 1 climate.online1         97      9.7\n 2 climate.onsite2         88      8.8\n 3 climate.online3         87      8.7\n 4 climate.onsite3         80      8  \n 5 climate.onsite1         72      7.2\n 6 climate.online2         70      7  \n 7 computer                29      2.9\n 8 interaction.online1     27      2.7\n 9 interaction.onsite1     27      2.7\n10 outcome.onsite3         26      2.6\n# ℹ 39 more rows\n```\n\n\n:::\n:::\n\n\n\nidea คือเราอาจใช้เทคนิค dimensionality reduction เพื่อย่อขนาดข้อมูลก่อนที่จะสร้างทัศนภาพข้อมูล ผลลัพธ์ที่ได้จะช่วยให้ผู้วิเคราะห์สามารถทำความเข้าใจสภาพการสูญหายของข้อมูลได้ง่ายขึ้น\n\nการใช้ PCA ในบริบทนี้สามารถดำเนินการได้ดังนี้\n\n1. แปลงข้อมูลของตัวแปรที่มีค่าสูญหายเป็น dummy variable โดยใช้ 1 แทนค่าสูญหาย และ 0 แทนค่าที่ไม่สูญหาย\n\n2. ใช้ PCA เพื่อสกัดองค์ประกอบหลักจาก matrix ของ dummy ดังกล่าว\n\n3. ลักษณะการทำงานของ PCA คือจะสร้างองค์ประกอบหลักที่สามารถอธิบายความแปรปรวนของตัวแปรต้นฉบับเดิมให้ได้มากที่สุด ดังนั้นเมื่อตัวแปรนำเข้าเป็นแบบ binary 0,1 องค์ประกอบหลักที่ได้จึงจะสะท้อนความแปรปรวนหรือรูปแบบการสูญหายของข้อมูล\n\n\nทดลองดำเนินการดังนี้\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndummy_mat <- large_data %>% \n  bind_shadow() %>% \n  dplyr::select(ends_with(\"NA\")) %>% \n  select(-1) |> \n  mutate_all(as.numeric) %>% \n  mutate_all(~ .-1)\n\nlibrary(tidymodels)\ndummy_mat  %>% \n  recipe(~.) %>% \n  step_pca(all_predictors()) %>% \n  prep() %>%\n  juice() %>% \n  ggplot(aes(PC1, PC2))+\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndummy_mat  %>% \n#  rownames_to_column(var = \"student_id\") %>%  # เก็บ rownames เป็นคอลัมน์ (ถ้าต้องการ)\n#  mutate(student_id = paste0(\"student\", student_id)) %>% \n#  pivot_longer(cols = -student_id, names_to = \"variable\", values_to = \"value\") %>%\n#  pivot_wider(names_from = student_id, values_from = value) %>% \n#  column_to_rownames(\"variable\") %>%\n  recipe(~.) %>% \n  step_pca(all_predictors(), num_comp = 2) %>% \n  prep() -> pca_prep\n\npca_prep %>% \n  tidy(1) %>% \n  filter(component %in% c(\"PC1\",\"PC2\")) %>% \n  ggplot(aes(x=value, y=terms))+\n  geom_col()+\n  facet_wrap(~component)+\n  theme(text = element_text(family = \"ChulaCharasNew\"))\n```\n\n::: {.cell-output-display}\n![](radioactivity_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp <- read_csv(\"/Users/choat/Downloads/CTA_-_Ridership_-__L__Station_Entries_-_Daily_Totals_20241006.csv\")\ntemp %>% summary()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   station_id    stationname            date             daytype         \n Min.   :40010   Length:1228271     Length:1228271     Length:1228271    \n 1st Qu.:40370   Class :character   Class :character   Class :character  \n Median :40760   Mode  :character   Mode  :character   Mode  :character  \n Mean   :40768                                                           \n 3rd Qu.:41160                                                           \n Max.   :41710                                                           \n     rides      \n Min.   :    0  \n 1st Qu.:  934  \n Median : 1942  \n Mean   : 2982  \n 3rd Qu.: 3922  \n Max.   :36323  \n```\n\n\n:::\n:::\n",
    "supporting": [
      "radioactivity_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}