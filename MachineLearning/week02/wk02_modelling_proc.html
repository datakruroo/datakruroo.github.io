<!DOCTYPE html>
<html lang="en"><head>
<script src="wk02_modelling_proc_files/libs/clipboard/clipboard.min.js"></script>
<script src="wk02_modelling_proc_files/libs/quarto-html/tabby.min.js"></script>
<script src="wk02_modelling_proc_files/libs/quarto-html/popper.min.js"></script>
<script src="wk02_modelling_proc_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="wk02_modelling_proc_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="wk02_modelling_proc_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="wk02_modelling_proc_files/libs/quarto-html/quarto-syntax-highlighting-2577ed9d2f9b020f727002863c1eb492.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.17">

  <meta name="author" content="ผศ.ดร.สิวะโชติ ศรีสุทธิยากร">
  <title>Week 2: Modelling Process</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="wk02_modelling_proc_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="wk02_modelling_proc_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="wk02_modelling_proc_files/libs/revealjs/dist/theme/quarto-cb1ed36e8cdf59da670ef55b215fa2c0.css">
  <link rel="stylesheet" href="my_css.css">
  <link href="wk02_modelling_proc_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="wk02_modelling_proc_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="wk02_modelling_proc_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="wk02_modelling_proc_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="img/ML.jpg" data-background-opacity="8%" data-background-size="full" class="quarto-title-block center">
  <h1 class="title">Week 2: Modelling Process</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
ผศ.ดร.สิวะโชติ ศรีสุทธิยากร 
</div>
        <p class="quarto-title-affiliation">
            ภาควิชาวิจัยและจิตวิทยาการศึกษา <br> คณะครุศาสตร์ จุฬาลงกรณ์มหาวิทยาลัย
          </p>
    </div>
</div>

</section>
<section>
<section id="part-1-overview-of-modelling-process" class="title-slide slide level1 center">
<h1>Part 1 : Overview of Modelling Process</h1>

</section>
<section id="modeling-process" class="slide level2 smaller">
<h2>Modeling Process</h2>
<p><br></p>
<div class="columns">
<div class="column" style="width:35%;">
<ul>
<li><p>Data-driven approaches</p></li>
<li><p>Iterative Procedure</p></li>
<li><p>Trial and Error</p></li>
</ul>
</div><div class="column" style="width:65%;">
<p><img data-src="https://datakruroo.github.io/MachineLearning/week01/img/process.png"></p>
</div></div>
</section>
<section id="ml-modelling-cycle" class="slide level2 smaller">
<h2>ML Modelling Cycle</h2>

<img data-src="img/1520230635424.jpeg" class="r-stretch quarto-figure-center"><p class="caption">https://www.linkedin.com/pulse/4-stages-machine-learning-ml-modeling-cycle-maurice-chang</p></section>
<section id="frame-the-problem" class="slide level2 smaller">
<h2>Frame the Problem</h2>
<p>วัตถุประสงค์หลักคือ การสร้างโมเดลสำหรับทำนายแนวโน้มของผลลัพธ์การเรียนรู้ของผู้เรียนแต่ละบุคคล เราอาจจำแนกโมเดลได้เป็น 2 ประเภทหลัก</p>
<ul>
<li><p>Regression: ใช้ G3 - final grade (numeric: from 0 to 20) เป็นตัวแปรตาม</p></li>
<li><p>Binary Classification: ใช้เกณฑ์ <span class="math inline">\(G3 \geq 10\)</span> หมายถึงสอบผ่าน (pass)</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href=""></a>data <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"/Users/choat/Documents/GitHub/datakruroo.github.io/MachineLearning/week02/student/student-mat.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>)</span>
<span id="cb1-3"><a href=""></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 395
Columns: 33
$ school     &lt;chr&gt; "GP", "GP", "GP", "GP", "GP", "GP", "GP", "GP", "GP", "GP",…
$ sex        &lt;chr&gt; "F", "F", "F", "F", "F", "M", "M", "F", "M", "M", "F", "F",…
$ age        &lt;dbl&gt; 18, 17, 15, 15, 16, 16, 16, 17, 15, 15, 15, 15, 15, 15, 15,…
$ address    &lt;chr&gt; "U", "U", "U", "U", "U", "U", "U", "U", "U", "U", "U", "U",…
$ famsize    &lt;chr&gt; "GT3", "GT3", "LE3", "GT3", "GT3", "LE3", "LE3", "GT3", "LE…
$ Pstatus    &lt;chr&gt; "A", "T", "T", "T", "T", "T", "T", "A", "A", "T", "T", "T",…
$ Medu       &lt;dbl&gt; 4, 1, 1, 4, 3, 4, 2, 4, 3, 3, 4, 2, 4, 4, 2, 4, 4, 3, 3, 4,…
$ Fedu       &lt;dbl&gt; 4, 1, 1, 2, 3, 3, 2, 4, 2, 4, 4, 1, 4, 3, 2, 4, 4, 3, 2, 3,…
$ Mjob       &lt;chr&gt; "at_home", "at_home", "at_home", "health", "other", "servic…
$ Fjob       &lt;chr&gt; "teacher", "other", "other", "services", "other", "other", …
$ reason     &lt;chr&gt; "course", "course", "other", "home", "home", "reputation", …
$ guardian   &lt;chr&gt; "mother", "father", "mother", "mother", "father", "mother",…
$ traveltime &lt;dbl&gt; 2, 1, 1, 1, 1, 1, 1, 2, 1, 1, 1, 3, 1, 2, 1, 1, 1, 3, 1, 1,…
$ studytime  &lt;dbl&gt; 2, 2, 2, 3, 2, 2, 2, 2, 2, 2, 2, 3, 1, 2, 3, 1, 3, 2, 1, 1,…
$ failures   &lt;dbl&gt; 0, 0, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3, 0,…
$ schoolsup  &lt;chr&gt; "yes", "no", "yes", "no", "no", "no", "no", "yes", "no", "n…
$ famsup     &lt;chr&gt; "no", "yes", "no", "yes", "yes", "yes", "no", "yes", "yes",…
$ paid       &lt;chr&gt; "no", "no", "yes", "yes", "yes", "yes", "no", "no", "yes", …
$ activities &lt;chr&gt; "no", "no", "no", "yes", "no", "yes", "no", "no", "no", "ye…
$ nursery    &lt;chr&gt; "yes", "no", "yes", "yes", "yes", "yes", "yes", "yes", "yes…
$ higher     &lt;chr&gt; "yes", "yes", "yes", "yes", "yes", "yes", "yes", "yes", "ye…
$ internet   &lt;chr&gt; "no", "yes", "yes", "yes", "no", "yes", "yes", "no", "yes",…
$ romantic   &lt;chr&gt; "no", "no", "no", "yes", "no", "no", "no", "no", "no", "no"…
$ famrel     &lt;dbl&gt; 4, 5, 4, 3, 4, 5, 4, 4, 4, 5, 3, 5, 4, 5, 4, 4, 3, 5, 5, 3,…
$ freetime   &lt;dbl&gt; 3, 3, 3, 2, 3, 4, 4, 1, 2, 5, 3, 2, 3, 4, 5, 4, 2, 3, 5, 1,…
$ goout      &lt;dbl&gt; 4, 3, 2, 2, 2, 2, 4, 4, 2, 1, 3, 2, 3, 3, 2, 4, 3, 2, 5, 3,…
$ Dalc       &lt;dbl&gt; 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1,…
$ Walc       &lt;dbl&gt; 1, 1, 3, 1, 2, 2, 1, 1, 1, 1, 2, 1, 3, 2, 1, 2, 2, 1, 4, 3,…
$ health     &lt;dbl&gt; 3, 3, 3, 5, 5, 5, 3, 1, 1, 5, 2, 4, 5, 3, 3, 2, 2, 4, 5, 5,…
$ absences   &lt;dbl&gt; 6, 4, 10, 2, 4, 10, 0, 6, 0, 0, 0, 4, 2, 2, 0, 4, 6, 4, 16,…
$ G1         &lt;dbl&gt; 5, 5, 7, 15, 6, 15, 12, 6, 16, 14, 10, 10, 14, 10, 14, 14, …
$ G2         &lt;dbl&gt; 6, 5, 8, 14, 10, 15, 12, 5, 18, 15, 8, 12, 14, 10, 16, 14, …
$ G3         &lt;dbl&gt; 6, 6, 10, 15, 10, 15, 11, 6, 19, 15, 9, 12, 14, 11, 16, 14,…</code></pre>
</div>
</div>
</section>
<section id="frame-the-problem-1" class="slide level2 smaller">
<h2>Frame the Problem</h2>
<p>เนื้อหาในวันนี้เราเน้นความเข้าใจภาพรวมของกระบวนการ ส่วนที่เกี่ยวกับ feature engineering และการจัดการกับข้อมูลที่ไม่สมบูรณ์ต่าง ๆ จะกล่าวในบทเรียนถัด ๆ ไป</p>
<p>เราวางแผนการสร้างโมเดลในวันนี้ออกเป็น 3 โมเดล ได้แก่</p>
<ul>
<li><p>Model A: ใช้ทุกตัวแปรเป็นตัวแปรทำนาย</p></li>
<li><p>Model B: ตัด G2-second period grade (numeric: from 0 to 20) ออกจากตัวแปรทำนาย</p></li>
<li><p>Model C: ตัด G1-first period grade (numeric: from 0 to 20) ออกจากตัวแปรทำนายเพิ่ม</p></li>
</ul>
</section>
<section id="manage-data" class="slide level2 smaller">
<h2>Manage Data</h2>
<p>เพื่อให้การฝึกสอนและประเมินประสิทธิภาพของโมเดลเป็นไปได้อย่างถูกต้อง ผู้วิเคราะห์จำเป็นต้องแบ่งข้อมูลออกเป็นสองส่วน</p>
<ul>
<li><p><strong>Training data</strong>: ใช้สำหรับพัฒนาชุดของตัวแปรอิสระ และโมเดลการเรียนรู้ ผลลัพธ์สุดท้ายที่จะได้จากชุดข้อมูลนี้คือ โมเดลการเรียนรู้ที่ดีที่สุด (final models) ที่คาดว่าจะนำไปใช้งานจริง</p></li>
<li><p><strong>Test data</strong>: ใช้ประเมินประสิทธิภาพของ final models อย่างเป็นกลาง ผลการประเมินที่ได้จากชุดข้อมูลนี้จะสะท้อนคุณสมบัติด้าน generaliability ของโมเดล กล่าวคือ โมเดลการเรียนรู้แต่ละตัวมีความสามารถที่จะนำไปใช้กับข้อมูลใหม่ได้ดีมากน้อยเพียงใด</p></li>
</ul>
<p>สัดส่วนการแบ่งชุดข้อมูลโดยทั่วไปคือ 60:40, 70:30, 80:20 ปัจจัยที่ใช้ประกอบการพิจารณา</p>
<ul>
<li><p>จำนวนข้อมูลทั้งหมดที่มี</p></li>
<li><p>จำนวนตัวแปรอิสระ</p></li>
</ul>
</section>
<section id="manage-data-data-leakage" class="slide level2 smaller">
<h2>Manage Data: Data Leakage</h2>
<p>ปัญหาที่ข้อมูลในอนาคตหรือจากชุดข้อมูลทดสอบปนเข้ามาในกระบวนการเรียนรู้ของโมเดล ซึ่งทำให้ performance ของโมเดลระหว่างการฝึกสอนดูสูงเกินจริง แต่เมื่อนำโมเดลไปใช้พบว่าได้ผลลัพธ์ที่แย่</p>
<ul>
<li><p><strong>Target Leakage:</strong> ข้อมูลตัวแปรตามหรือตัวบ่่งชี้ของตัวแปรตามหรือ proxy ของตัวแปรตามถูกใช้เป็นตัวแปรอิสระในการสร้างโมเดล</p></li>
<li><p><strong>Train-Test Contamination:</strong> ข้อมูลจาก test data ปนเข้ามาใน training data ทั้งทางตรงและทางอ้อม</p>
<ul>
<li><p>นำ test data มารวมใน training data</p></li>
<li><p>กระบวนการ data preprocessing ที่ fit preprocessing model จากข้อมูลที่มี test data ด้วย ตัวอย่างกระบวนการพวกนี้ เช่น normalization, imputation, feature selection, imbalanced class handling, etc.</p></li>
</ul></li>
<li><p><strong>Temporal Leakage:</strong> เกิดจากการละเมิดลำดับของข้อมูลหรือเวลา เช่น ใช้ข้อมูลอนาคตไปทำนายอดีต หรือสลับลำดับข้อมูลอนุกรมเวลา</p></li>
<li><p><strong>Identifier Leakage:</strong> นำ id ของ observation เข้ามาเป็น feature ทำให้โมเดลจำคนแทนที่จะเรียนรู้ pattern ความสัมพันธ์ระหว่างตัวแปรอิสระกับตัวแปรตาม</p></li>
</ul>
</section>
<section id="กจกรรม-1-data-splitting" class="slide level2 smaller">
<h2>กิจกรรม 1: Data Splitting</h2>
<div class="columns">
<div class="column" style="width:15%;">
<p><img data-src="img/rsample.png"></p>
</div><div class="column" style="width:85%;">
<ul>
<li>Simple random sampling</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a><span class="do">## install.packages("rsample")</span></span>
<span id="cb3-2"><a href=""></a><span class="fu">library</span>(rsample)</span>
<span id="cb3-3"><a href=""></a><span class="do">## SRS</span></span>
<span id="cb3-4"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-5"><a href=""></a>srs_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> data, <span class="at">prop =</span> <span class="fl">0.7</span>)</span>
<span id="cb3-6"><a href=""></a>train_srs <span class="ot">&lt;-</span> <span class="fu">training</span>(srs_split)</span>
<span id="cb3-7"><a href=""></a>test_srs <span class="ot">&lt;-</span> <span class="fu">testing</span>(srs_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Stratified random sampling</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="do">## Stratified</span></span>
<span id="cb4-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb4-3"><a href=""></a>strat_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> data, <span class="at">prop =</span> <span class="fl">0.7</span>, </span>
<span id="cb4-4"><a href=""></a>                           <span class="at">strata =</span> G3, <span class="at">breaks =</span> <span class="dv">4</span>)</span>
<span id="cb4-5"><a href=""></a>train_strat <span class="ot">&lt;-</span> <span class="fu">training</span>(strat_split)</span>
<span id="cb4-6"><a href=""></a>test_strat <span class="ot">&lt;-</span> <span class="fu">testing</span>(strat_split)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="data-splitting-distribution-consistency" class="slide level2 smaller">
<h2>Data Splitting: Distribution Consistency</h2>
<p>การแบ่งชุดข้อมูลเป็น training data และ test data ควรคำนึงถึงการรักษาการแจกแจงของตัวแปรตาม (target variable) ให้สอดคคล้องกันระหว่าง training data และ test data</p>
<p>การเปรียบเทียบด้วย histogram</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a><span class="fu">library</span>(patchwork)</span>
<span id="cb5-2"><a href=""></a>p1 <span class="ot">&lt;-</span> train_srs <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> G3, <span class="at">y =</span> <span class="fu">after_stat</span>(density)))<span class="sc">+</span></span>
<span id="cb5-4"><a href=""></a>  <span class="fu">geom_histogram</span>(<span class="at">col =</span> <span class="st">"white"</span>, </span>
<span id="cb5-5"><a href=""></a>                 <span class="at">fill =</span> <span class="st">"black"</span>,</span>
<span id="cb5-6"><a href=""></a>                 <span class="at">bins =</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb5-7"><a href=""></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb5-8"><a href=""></a>  <span class="fu">ggtitle</span>(<span class="st">"training data (SRS)"</span>)<span class="sc">+</span></span>
<span id="cb5-9"><a href=""></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">0.2</span>)</span>
<span id="cb5-10"><a href=""></a></span>
<span id="cb5-11"><a href=""></a>p2 <span class="ot">&lt;-</span> test_srs <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> G3, <span class="at">y =</span> <span class="fu">after_stat</span>(density)))<span class="sc">+</span></span>
<span id="cb5-13"><a href=""></a>  <span class="fu">geom_histogram</span>(<span class="at">col =</span> <span class="st">"white"</span>, </span>
<span id="cb5-14"><a href=""></a>                 <span class="at">fill =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb5-15"><a href=""></a>                 <span class="at">bins =</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb5-16"><a href=""></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb5-17"><a href=""></a>  <span class="fu">ggtitle</span>(<span class="st">"test data (SRS)"</span>)<span class="sc">+</span></span>
<span id="cb5-18"><a href=""></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">0.2</span>)</span>
<span id="cb5-19"><a href=""></a></span>
<span id="cb5-20"><a href=""></a></span>
<span id="cb5-21"><a href=""></a>p3 <span class="ot">&lt;-</span> train_strat <span class="sc">%&gt;%</span> </span>
<span id="cb5-22"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> G3, <span class="at">y =</span> <span class="fu">after_stat</span>(density)))<span class="sc">+</span></span>
<span id="cb5-23"><a href=""></a>  <span class="fu">geom_histogram</span>(<span class="at">col =</span> <span class="st">"white"</span>, </span>
<span id="cb5-24"><a href=""></a>                 <span class="at">fill =</span> <span class="st">"black"</span>,</span>
<span id="cb5-25"><a href=""></a>                 <span class="at">bins =</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb5-26"><a href=""></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb5-27"><a href=""></a>  <span class="fu">ggtitle</span>(<span class="st">"training data (STR)"</span>)<span class="sc">+</span></span>
<span id="cb5-28"><a href=""></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">0.25</span>)</span>
<span id="cb5-29"><a href=""></a></span>
<span id="cb5-30"><a href=""></a>p4 <span class="ot">&lt;-</span> test_strat <span class="sc">%&gt;%</span> </span>
<span id="cb5-31"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> G3, <span class="at">y =</span> <span class="fu">after_stat</span>(density)))<span class="sc">+</span></span>
<span id="cb5-32"><a href=""></a>  <span class="fu">geom_histogram</span>(<span class="at">col =</span> <span class="st">"white"</span>, </span>
<span id="cb5-33"><a href=""></a>                 <span class="at">fill =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb5-34"><a href=""></a>                 <span class="at">bins =</span> <span class="dv">20</span>)<span class="sc">+</span></span>
<span id="cb5-35"><a href=""></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb5-36"><a href=""></a>  <span class="fu">ggtitle</span>(<span class="st">"test data (STR)"</span>)<span class="sc">+</span></span>
<span id="cb5-37"><a href=""></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fl">0.25</span>)</span>
<span id="cb5-38"><a href=""></a></span>
<span id="cb5-39"><a href=""></a>(p1<span class="sc">+</span>p2)<span class="sc">/</span>(p3<span class="sc">+</span>p4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-splitting-distribution-consistency-1" class="slide level2 smaller">
<h2>Data Splitting: Distribution Consistency</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-5-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-6-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-splitting-distribution-consistency-2" class="slide level2 smaller">
<h2>Data Splitting: Distribution Consistency</h2>
<p>การเปรียบเทียบด้วย CDF ร่วมกับ Komogorov-Smirnov test วิธีการนี้ช่วยให้ได้ทัศนภาพของการแจกแจงในเชิงการเปรียบเทียบที่ชัดเจนกว่า histogram</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href=""></a>p3 <span class="ot">&lt;-</span> train_srs <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href=""></a>  <span class="fu">mutate</span>(<span class="at">dataset =</span> <span class="st">"training"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href=""></a>  <span class="fu">bind_rows</span>(test_srs <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">dataset =</span> <span class="st">"test"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-4"><a href=""></a>  <span class="fu">select</span>(dataset, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> G3))<span class="sc">+</span></span>
<span id="cb6-6"><a href=""></a>  <span class="fu">stat_ecdf</span>(<span class="fu">aes</span>(<span class="at">col =</span> dataset))</span>
<span id="cb6-7"><a href=""></a><span class="fu">ks.test</span>(train_srs<span class="sc">$</span>G3, test_srs<span class="sc">$</span>G3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic two-sample Kolmogorov-Smirnov test

data:  train_srs$G3 and test_srs$G3
D = 0.10626, p-value = 0.3048
alternative hypothesis: two-sided</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a>p3 <span class="do">## print CDF plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-7-1.png" width="960" class="r-stretch"><p>การแบ่งชุดข้อมูลแบบ stratified มีความสอดคล้องที่แตกต่างไปจาก simple random sampling อย่างไร ?</p>
</section>
<section id="data-splitting-class-imbalances" class="slide level2 smaller">
<h2>Data Splitting: Class Imbalances</h2>
<ul>
<li><p>เกิดขึ้นในปัญหาแบบ classification เมื่อตัวแปรตามมีการแจกแจงที่ไม่สมดุล</p></li>
<li><p>มีผลกระทบสูงต่อประสิทธิภาพการเรียนรู้และการทำนายของโมเดล</p></li>
<li><p>ระมัดระวังมาก ๆ กับ class ที่หายไปจาก test data เลย</p></li>
<li><p>stratified sampling ช่วยลดปัญหานี้ได้</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a>binary_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">result =</span> <span class="fu">ifelse</span>(G3<span class="sc">&gt;=</span><span class="dv">10</span>,<span class="st">"pass"</span>,<span class="st">"fail"</span>)) <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>G3)</span>
<span id="cb9-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb9-3"><a href=""></a>strat_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(<span class="at">data =</span> binary_data, <span class="at">prop =</span> <span class="fl">0.7</span>, </span>
<span id="cb9-4"><a href=""></a>                           <span class="at">strata =</span> result)</span>
<span id="cb9-5"><a href=""></a>train_strat <span class="ot">&lt;-</span> <span class="fu">training</span>(strat_split)</span>
<span id="cb9-6"><a href=""></a>test_strat <span class="ot">&lt;-</span> <span class="fu">testing</span>(strat_split)</span>
<span id="cb9-7"><a href=""></a></span>
<span id="cb9-8"><a href=""></a>p1 <span class="ot">&lt;-</span> train_strat <span class="sc">%&gt;%</span> </span>
<span id="cb9-9"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>result))<span class="sc">+</span><span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb9-10"><a href=""></a>  <span class="fu">ggtitle</span>(<span class="st">"training data"</span>)</span>
<span id="cb9-11"><a href=""></a></span>
<span id="cb9-12"><a href=""></a>p2 <span class="ot">&lt;-</span> test_strat <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>result))<span class="sc">+</span><span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb9-14"><a href=""></a>  <span class="fu">ggtitle</span>(<span class="st">"test data"</span>)</span>
<span id="cb9-15"><a href=""></a></span>
<span id="cb9-16"><a href=""></a>p1<span class="sc">+</span>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-splitting-class-imbalances-1" class="slide level2 smaller">
<h2>Data Splitting: Class Imbalances</h2>

<img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-9-1.png" width="960" class="r-stretch"></section></section>
<section>
<section id="part-2-exploring-data" class="title-slide slide level1 center">
<h1>Part 2 : Exploring Data</h1>

</section>
<section id="explore-the-training-data" class="slide level2 smaller">
<h2>Explore the (Training) Data</h2>
<ul>
<li><p>ทำความเข้าใจตัวแปรตาม (target variable)</p>
<ul>
<li><p>ลักษณะการแจกแจงของตัวแปรตามเป็นอย่างไร</p></li>
<li><p>summary stat ของตัวแปรตาม</p></li>
<li><p>ความผิดปกติหรือความไม่สมบูรณ์ของข้อมูลตัวแปรตาม</p></li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li><p>ทำความเข้าใจตัวแปรอิสระ (features)</p>
<ul>
<li><p>มีตัวแปรอิสระจำนวนกี่ตัว จำแนกเป็นตัวแปรเชิงปริมาณและจัดประเภทอย่างไร?</p></li>
<li><p>การลงรหัสตัวแปรอิสระมีความเหมาะสมแล้วหรือไม่</p></li>
<li><p>การแจกแจงของตัวแปรอิสระและ summary stat</p></li>
</ul></li>
</ul>
</div>
</section>
<section id="explore-the-training-data-1" class="slide level2 smaller">
<h2>Explore the (Training) Data</h2>
<ul>
<li><p>วิเคราะห์ความสัมพันธ์เบื้องต้นระหว่างตัวแปรตามกับตัวแปรอิสระ</p>
<ul>
<li><p>Scatter plot</p></li>
<li><p>Correlation coefficients</p></li>
<li><p>Boxplot/Violin plot</p></li>
<li><p>ANOVA</p></li>
<li><p>Interaction Effects</p></li>
</ul></li>
</ul>
</section>
<section id="กจกรรม-2-สำรวจขอมล-training-data" class="slide level2 smaller">
<h2>กิจกรรม 2: สำรวจข้อมูล training data</h2>
<p>ขอให่้นิสิตดำเนินการสำรวจข้อมูล training data ประกอบด้วย</p>
<ul>
<li><p>สำรวจตัวแปรตาม (regression task)</p></li>
<li><p>ตัวแปรอิสระ</p></li>
<li><p>ความสัมพันธ์ระหว่างตัวแปรตามกับตัวแปรอิสระ</p></li>
</ul>
<p>ผลการสำรวจเป็นอย่างไร?</p>
</section>
<section id="syntax-สำหรบกจกรรม-2" class="slide level2 smaller">
<h2>Syntax สำหรับกิจกรรม 2</h2>
<h4 id="แปลงขอมลจดประเภทใหเปน-factor">1. แปลงข้อมูลจัดประเภทให้เป็น factor</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a>train_str2 <span class="ot">&lt;-</span> train_strat <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href=""></a>  <span class="fu">mutate_at</span>(<span class="fu">vars</span>(school, sex, address, famsize, Pstatus, </span>
<span id="cb10-3"><a href=""></a>                 Medu, Fedu, Mjob, Fjob, reason, guardian,</span>
<span id="cb10-4"><a href=""></a>                 traveltime, studytime, schoolsup,</span>
<span id="cb10-5"><a href=""></a>                 famsup, paid, activities, nursery, higher,internet,</span>
<span id="cb10-6"><a href=""></a>                 romantic, famrel, freetime, goout, Dalc, Walc, health), </span>
<span id="cb10-7"><a href=""></a>            factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<h4 id="สำรวจตวแปรอสระแบบจดประเภท">2. สำรวจตัวแปรอิสระแบบจัดประเภท</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a>train_str2 <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href=""></a><span class="fu">select_if</span>(is.factor) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href=""></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value))<span class="sc">+</span></span>
<span id="cb11-5"><a href=""></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb11-6"><a href=""></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb11-7"><a href=""></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>name, <span class="at">scale =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="syntax-สำหรบกจกรรม-2-1" class="slide level2 smaller">
<h2>Syntax สำหรับกิจกรรม 2</h2>
<h4 id="สำรวจความสมพนธระหวาง-y-กบ-x">3. สำรวจความสัมพันธ์ระหว่าง y กับ x</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a>features_name <span class="ot">&lt;-</span> <span class="fu">names</span>(train_str2 <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>G3))</span>
<span id="cb12-2"><a href=""></a></span>
<span id="cb12-3"><a href=""></a><span class="co"># สร้าง tibble ว่างเพื่อเก็บผลลัพธ์</span></span>
<span id="cb12-4"><a href=""></a>results <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb12-5"><a href=""></a>  <span class="at">predictor =</span> <span class="fu">character</span>(),</span>
<span id="cb12-6"><a href=""></a>  <span class="at">rsq =</span> <span class="fu">numeric</span>()</span>
<span id="cb12-7"><a href=""></a>)</span>
<span id="cb12-8"><a href=""></a></span>
<span id="cb12-9"><a href=""></a><span class="co"># ใช้ for loop เพื่อวนลูปคำนวณ</span></span>
<span id="cb12-10"><a href=""></a><span class="cf">for</span> (x <span class="cf">in</span> features_name) {</span>
<span id="cb12-11"><a href=""></a>  <span class="co"># สร้างสูตรโมเดล</span></span>
<span id="cb12-12"><a href=""></a>  formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"G3 ~"</span>, x))</span>
<span id="cb12-13"><a href=""></a>  </span>
<span id="cb12-14"><a href=""></a>  <span class="co"># เทรนโมเดล</span></span>
<span id="cb12-15"><a href=""></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, <span class="at">data =</span> train_strat)</span>
<span id="cb12-16"><a href=""></a>  </span>
<span id="cb12-17"><a href=""></a>  <span class="co"># ดึงค่า R-squared</span></span>
<span id="cb12-18"><a href=""></a>  rsq <span class="ot">&lt;-</span> <span class="fu">summary</span>(model)<span class="sc">$</span>r.squared</span>
<span id="cb12-19"><a href=""></a>  </span>
<span id="cb12-20"><a href=""></a>  <span class="co"># เพิ่มผลลัพธ์ลงใน tibble</span></span>
<span id="cb12-21"><a href=""></a>  results <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span></span>
<span id="cb12-22"><a href=""></a>    <span class="fu">add_row</span>(<span class="at">predictor =</span> x, <span class="at">rsq =</span> rsq)</span>
<span id="cb12-23"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="syntax-สำหรบกจกรรม-2-2" class="slide level2 smaller">
<h2>Syntax สำหรับกิจกรรม 2</h2>
<h4 id="สำรวจความสมพนธระหวาง-y-กบ-x-ตอ">สำรวจความสัมพันธ์ระหว่าง y กับ x (ต่อ)</h4>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href=""></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href=""></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rsq))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 2
   predictor    rsq
   &lt;chr&gt;      &lt;dbl&gt;
 1 G2        0.801 
 2 G1        0.596 
 3 failures  0.117 
 4 Medu      0.0375
 5 Mjob      0.0336
 6 romantic  0.0298
 7 higher    0.0277
 8 age       0.0214
 9 reason    0.0168
10 famsize   0.0156
# ℹ 22 more rows</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a>results <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(rsq)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rsq, </span>
<span id="cb15-3"><a href=""></a>             <span class="at">y=</span> <span class="fu">reorder</span>(predictor, rsq)))<span class="sc">+</span></span>
<span id="cb15-4"><a href=""></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>)<span class="sc">+</span></span>
<span id="cb15-5"><a href=""></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb15-6"><a href=""></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>))<span class="sc">+</span></span>
<span id="cb15-7"><a href=""></a>  <span class="fu">ylab</span>(<span class="st">""</span>)<span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"</span><span class="sc">\n</span><span class="st"> R-Square"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-14-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="part-3-train-model" class="title-slide slide level1 center">
<h1>Part 3: Train Model</h1>

</section>
<section id="creating-models" class="slide level2 smaller">
<h2>Creating Models</h2>
<ul>
<li><p>Base library</p></li>
<li><p>tidymodels</p></li>
<li><p>caret</p></li>
<li><p>mlr3</p></li>
<li><p>H2O</p></li>
<li><p>autoML</p></li>
<li><p>scikit-learn</p></li>
</ul>
</section>
<section id="tidymodels" class="slide level2 smaller">
<h2>Tidymodels</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="do">## install.packages("tidymodels")</span></span>
<span id="cb16-2"><a href=""></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>

<img data-src="img/tidymodels.jpeg" class="r-stretch"><div class="caption">
https://rpubs.com/chenx/tidymodels_tutorial
</div>
</section>
<section id="tidymodels-1" class="slide level2 smaller">
<h2>Tidymodels</h2>

<img data-src="img/tidymodel_functions.png" style="width:60.0%" class="r-stretch"><div class="caption">
https://rpubs.com/chenx/tidymodels_tutorial
</div>
</section>
<section id="tidymodels-parsnip" class="slide level2 smaller">
<h2>Tidymodels: parsnip</h2>
<div class="columns">
<div class="column" style="width:15%;">
<p><img data-src="img/parsnip.png"></p>
</div><div class="column" style="width:85%;">
<p>ส่วนประกอบจำเป็นสำหรับการระบุโมเดล</p>
<ul>
<li><p><strong>model type</strong> อัลกอริทึมที่จะใช้สร้างโมเดลทำนาย</p></li>
<li><p><strong>engine</strong> เลือก library ที่ใช้สำหรับประมวลผล</p></li>
<li><p><strong>mode</strong> กำหนดประเภทของโมเดล</p></li>
</ul>
<p>นอกจากนี้หลายอัลกอริทึมจะมี hyperparameters ที่ใช้ปรับแต่งลักษณะการเรียนรู้ของโมเดล ซึ่งอาจปรับแต่งอย่างเหมาะสมอาจช่วยเพิ่มประสิทธิภาพของโมเดลได้ (จะกล่าวภายหลัง)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a><span class="do">## linear regression model</span></span>
<span id="cb17-2"><a href=""></a>lm_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-4"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb17-5"><a href=""></a><span class="do">## k-nearest neighbor</span></span>
<span id="cb17-6"><a href=""></a>knn_spec <span class="ot">&lt;-</span> <span class="fu">nearest_neighbor</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-7"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"kknn"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-8"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
<div class="caption">
<a href="https://www.tidymodels.org/find/parsnip/">https://www.tidymodels.org/find/parsnip/</a>
</div>
</section>
<section id="tidymodels-model-fitting" class="slide level2 smaller">
<h2>Tidymodels: Model Fitting</h2>
<ul>
<li><code>fit()</code> เป็นฟังก์ชันหลักตัวหนึ่งของ <code>parsnip</code> สำหรับ train โมเดลทำนายที่ต้องการด้วยอัลกอริทึมและชุดข้อมูลที่กำหนด</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a>lm_fit <span class="ot">&lt;-</span> lm_spec <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href=""></a>  <span class="fu">fit</span>(G3 <span class="sc">~</span> ., <span class="at">data =</span> train_strat)</span>
<span id="cb18-3"><a href=""></a></span>
<span id="cb18-4"><a href=""></a>knn_fit <span class="ot">&lt;-</span> knn_spec <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href=""></a>  <span class="fu">fit</span>(G3 <span class="sc">~</span> ., <span class="at">data =</span> train_strat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>บางโมเดลมีความสามารถในการอธิบายความสัมพันธ์ในตัวเอง เช่น linear regression หรือ decision tree ผู้วิเคราะห์สามารถดึงผลการประมาณค่าพารามิเตอร์ หรือผลการวิเคราะห์ที่เกี่ยวข้องเพื่อนำไปใช้ได้ เช่น</p>
<ul>
<li><code>extract_fit_engine()</code> เป็นฟังก์ชันใน <code>parsnip</code> ใช้สำหรับดึง model object จากผลการสร้างโมเดลด้วย <code>parsnip</code> หรือ <code>workflow</code> ใน tidymodels</li>
</ul>
<p>ลองพิมพ์คำสั่งต่อไปนี้แล้วพิจารณาผลลัพธ์ที่ได้</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a>raw_lm_model <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(lm_fit)</span>
<span id="cb19-2"><a href=""></a><span class="fu">summary</span>(raw_lm_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidymodels-model-evaluation" class="slide level2 smaller">
<h2>Tidymodels: Model Evaluation</h2>
<p>โดยปกติวัตถุประสงค์ของการสร้างโมเดลทำนายคือการทำนาย ดังนั้นการประเมินประสิทธิภาพของโมเดลทำนายจึงเน้นไปที่การตรวจสอบความถูกต้องของการทำนายเป็นหลัก</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><p>คำนวณค่าทำนายใน test data</p></li>
<li><p>คำนวณค่าของ evaluation metrices</p></li>
</ul>
<h4 id="regression-models">Regression models</h4>
<ul>
<li><p>MSE</p></li>
<li><p>RMSE</p></li>
<li><p>MAE</p></li>
<li><p>Rsq</p></li>
</ul>
</div><div class="column" style="width:50%;">
<h4 id="classification-models">Classification models</h4>
<ul>
<li><p>Confusion Matrix</p>
<ul>
<li><p>Accuracy (hit rate)</p></li>
<li><p>Misclassification rate</p></li>
<li><p>Precision</p></li>
<li><p>Sensitivity (or recall)</p></li>
<li><p>Specificity</p></li>
<li><p>AUC</p></li>
</ul></li>
<li><p>Brier score</p></li>
<li><p>Cross-entropy</p></li>
</ul>
</div></div>
</section>
<section id="tidymodels-model-evaluation-1" class="slide level2 smaller">
<h2>Tidymodels: Model Evaluation</h2>
<p>การคำนวณค่าประสิทธิภาพของโมเดลทำนายแบบ regression ภายใต้ tidymodels framework สามารถทำได้ง่าย ๆ โดยใช้ฟังก์ชันจาก package yardstick ได้แก่ <code>rmse()</code> และ <code>rsq()</code></p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-20-1.png" width="384"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href=""></a>test_dataset_lm <span class="ot">&lt;-</span> lm_fit <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> test_strat) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href=""></a>  <span class="fu">rename</span>(<span class="at">lm_pred =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href=""></a>  <span class="fu">bind_cols</span>(test_strat)</span>
<span id="cb20-5"><a href=""></a></span>
<span id="cb20-6"><a href=""></a>metric <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse,</span>
<span id="cb20-7"><a href=""></a>                     yardstick<span class="sc">::</span>rsq,</span>
<span id="cb20-8"><a href=""></a>                     yardstick<span class="sc">::</span>mae)</span>
<span id="cb20-9"><a href=""></a></span>
<span id="cb20-10"><a href=""></a>test_dataset_lm <span class="sc">%&gt;%</span> </span>
<span id="cb20-11"><a href=""></a>  <span class="fu">metric</span>(<span class="at">truth =</span> G3, <span class="at">estimate =</span> lm_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard       2.01 
2 rsq     standard       0.815
3 mae     standard       1.46 </code></pre>
</div>
</div>
</div></div>
</section>
<section id="classification" class="slide level2 smaller scrollable">
<h2>Classification</h2>
<p>Binary Classification: ใช้เกณฑ์ <span class="math inline">\(G3 \geq 10\)</span> หมายถึงสอบผ่าน (pass)</p>
<p>ขอให้นิสิตดำเนินการต่อไปนี้</p>
<ol type="1">
<li><p>สร้างตัวแปรตามชื่อ <code>result</code> ในชุดข้อมูล <code>data</code></p></li>
<li><p>แบ่งชุดข้อมูล <code>train_data</code> และ <code>test_data</code> โดยใช้ <code>result</code></p></li>
<li><p>สำรวจการแจกแจงของตัวแปร <code>result</code></p></li>
<li><p>กำหนด classification model สำหรับจำแนกผลการเรียนของนักเรียน ในที่นี้ให้เลิือกใช้ binary logistic regression</p></li>
<li><p>ทดลอง fit model กับข้อมูล มีข้อสังเกตอะไรหรือไม่</p></li>
<li><p>และคำนวณเกณฑ์สำหรับพิจารณาประสิทธิภาพโมเดล ได้แก่ brier score, confusion matrix, accuracy, misclassification rate, sensitivity (recall), specificity, precision, F1</p></li>
</ol>
</section>
<section id="divergent-perfect-separation-problem" class="slide level2 smaller">
<h2>Divergent &amp; Perfect Separation Problem</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a><span class="do">## model specification</span></span>
<span id="cb22-2"><a href=""></a>logit_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb22-5"><a href=""></a></span>
<span id="cb22-6"><a href=""></a><span class="do">## fitting</span></span>
<span id="cb22-7"><a href=""></a>fit_logit <span class="ot">&lt;-</span> logit_mod <span class="sc">%&gt;%</span> </span>
<span id="cb22-8"><a href=""></a>  <span class="fu">fit</span>(result <span class="sc">~</span> ., <span class="at">data =</span> train_strat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: algorithm did not converge</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>แนวทางแก้ปัญหา</strong></p>
<ul>
<li><p>เพิ่ม iteration</p></li>
<li><p>ทำ regularization L1/L2</p></li>
<li><p>ตรวจสอบและลบตัวแปรอิสระที่ทำให้เกิด perfect seperation ออก</p></li>
<li><p>แก้ปัญหา Imbalanced class</p></li>
<li><p>แก้ปัญหา outlier</p></li>
<li><p>แก้ปัญหา multicollinearity (สำหรับบางโมเดล)</p></li>
<li><p>ปรับค่า Tolerance</p></li>
<li><p>เปลี่ยนอัลกอริทึม</p></li>
</ul>
</div></div>
</section>
<section id="roc-auc" class="slide level2 smaller">
<h2>Roc &amp; AUC</h2>
<p>ROC (Receiver Operating Characteristic) และ AUC (Area Under the Curve) เป็นเครื่องมือที่ใช้วัดและประเมินประสิทธิภาพของ classification model โดยเฉพาะการจำแนกแบบ binary classification จุดเด่นคือเป็นการพิจารณาความสามารถของโมเดลจากทุก threshold</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a>predicted_value <span class="ot">&lt;-</span> fit_logit <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> test_strat,</span>
<span id="cb25-3"><a href=""></a>          <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-4"><a href=""></a>  <span class="fu">bind_cols</span>(test_strat) <span class="sc">%&gt;%</span> </span>
<span id="cb25-5"><a href=""></a>  <span class="fu">select</span>(.pred_pass, result)</span>
<span id="cb25-6"><a href=""></a>predicted_value  <span class="sc">%&gt;%</span> </span>
<span id="cb25-7"><a href=""></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> <span class="st">"result"</span>, .pred_pass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
    .threshold specificity sensitivity
         &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
1 -Inf               0           1    
2    2.22 e-16       0           1    
3    8.79 e- 9       0.846       0.938
4    3.08 e- 3       0.846       0.925
5    1.000e+ 0       0.872       0.925
6    1    e+ 0       0.872       0.912
7  Inf               1           0    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a>predicted_value  <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href=""></a>  <span class="fu">roc_auc</span>(<span class="at">truth =</span> <span class="st">"result"</span>, .pred_pass)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.902</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-26-1.png" width="432"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="syntax-for-roc-auc-plot" class="slide level2 smaller">
<h2>Syntax for ROC &amp; AUC plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a>fit_logit <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> test_strat,</span>
<span id="cb29-3"><a href=""></a>          <span class="at">type =</span> <span class="st">"prob"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href=""></a>  <span class="fu">bind_cols</span>(test_strat) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href=""></a>  <span class="fu">select</span>(.pred_pass, result) <span class="sc">%&gt;%</span> </span>
<span id="cb29-6"><a href=""></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> <span class="st">"result"</span>, .pred_pass) <span class="sc">%&gt;%</span> </span>
<span id="cb29-7"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">y=</span>sensitivity))<span class="sc">+</span></span>
<span id="cb29-8"><a href=""></a>  <span class="fu">geom_path</span>(<span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb29-9"><a href=""></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb29-10"><a href=""></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb29-11"><a href=""></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fl">0.35</span>, <span class="at">y=</span> <span class="fl">0.6</span>, <span class="at">label =</span> <span class="st">"AUC = 0.902"</span>), <span class="at">size =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb29-12"><a href=""></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb29-13"><a href=""></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-14"><a href=""></a>        <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb29-15"><a href=""></a>  <span class="fu">xlab</span>(<span class="st">"</span><span class="sc">\n</span><span class="st"> False Positive Rate"</span>)<span class="sc">+</span></span>
<span id="cb29-16"><a href=""></a>  <span class="fu">ylab</span>(<span class="st">"True Positive Rate </span><span class="sc">\n</span><span class="st">"</span>)<span class="sc">+</span></span>
<span id="cb29-17"><a href=""></a>  <span class="fu">coord_obs_pred</span>()<span class="sc">+</span></span>
<span id="cb29-18"><a href=""></a>  <span class="fu">ggtitle</span>(<span class="st">"ROC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="f1-score" class="slide level2 smaller">
<h2>F1 Score</h2>
<p>F1 Score เป็นตัวชี้วัดประสิทธิภาพการจำแนกของโมเดล classification โดยพิจารณาด้านความไวและความน่าเชื่อถือไปพร้อมกัน ในเชิงคณิตศาสตร์ F1 เป็นค่าเฉลี่ย Harmonic ระหว่าง sensitivity กับ precision</p>
<p><span class="math display">\[
F_1 = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href=""></a>fit_logit <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href=""></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> test_strat,</span>
<span id="cb30-3"><a href=""></a>          <span class="at">type =</span> <span class="st">"class"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href=""></a>  <span class="fu">bind_cols</span>(test_strat) <span class="sc">%&gt;%</span> </span>
<span id="cb30-5"><a href=""></a>  <span class="fu">select</span>(.pred_class, result) <span class="sc">%&gt;%</span> </span>
<span id="cb30-6"><a href=""></a>  <span class="fu">f_meas</span>(<span class="at">truth =</span> result, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 f_meas  binary         0.931</code></pre>
</div>
</div>
</section></section>
<section>
<section id="part-4-fine-tuning-models" class="title-slide slide level1 smaller center">
<h1>Part 4: Fine-Tuning Models</h1>
<p>Supervised learning models มักจะมี hyperparameters ที่ต้องปรับแต่งเพื่อเพิ่มประสิทธิภาพของโมเดล การปรับแต่ง hyperparameters เป็นกระบวนการที่สำคัญในการสร้างโมเดลที่มีประสิทธิภาพสูง</p>
</section>
<section id="hyperparameters-and-fine-tuning" class="slide level2 smaller">
<h2>Hyperparameters and Fine-Tuning</h2>
<ul>
<li><strong>Hyperparameters</strong> → ค่าที่ควบคุมกระบวนการเรียนรู้ เช่น
<ul>
<li>ค่า (k) ใน k-NN<br>
</li>
<li>ค่า depth ของ decision tree<br>
</li>
<li>ค่า regularization strength () ใน LASSO<br>
</li>
</ul></li>
<li><strong>Fine-tuning</strong> → กระบวนการเลือกค่า hyperparameters ที่ทำให้โมเดลมีประสิทธิภาพดีที่สุดกับข้อมูล<br>
</li>
<li>การปรับ hyperparameters ที่เหมาะสมช่วยเพิ่มทั้ง <strong>accuracy </strong> และ <strong>generaliability</strong> ของโมเดล</li>
</ul>
</section>
<section id="fine-tuning-methods" class="slide level2 smaller">
<h2>Fine-tuning methods</h2>
<ul>
<li><p>กระบวนการปรับแต่ง hyperparameters เป็นกระบวนการเฟ้นหาค่าที่เหมาะสมที่สุดสำหรับ hyperparameters ของโมเดลโดยใช้ตัวชี้วัดประสิทธิภาพของโมเดลเป็นเกณฑ์</p></li>
<li><p>hyperparameters ไม่สามารถประมาณค่าโดยตรงจากข้อมูลได้เหมือนกับพารามิเตอร์ของโมเดล ดังนั้นกระบวนการเฟ้นหาดังกล่าวจึงเป็นลักษณะของการค้นหาแบบมีกลยุทธ์ เช่น</p>
<ul>
<li><p>grid search</p></li>
<li><p>random search</p></li>
<li><p>optimization methods</p></li>
</ul></li>
</ul>
</section>
<section id="lasso-regression" class="slide level2 smaller">
<h2>LASSO Regression</h2>
<p>Lasso Regression (Least Absolute Shrinkage and Selection Operator) เป็นรูปแบบหนึ่งของ regularized regression ที่ใช้ในการลดความซับซ้อนของโมเดลและป้องกันปัญหา overfitting โดยเพิ่ม penalty term ที่จะเพิ่ม bias อย่างเหมาะสมให้กับโมเดลเพื่อให้ variance ของโมเดลต่ำลงลดการเกิดปัญหา overfitting</p>
<h4 id="regression">regression</h4>
<p><span class="math display">\[
\text{Minimize: } \frac{1}{n} \sum_{i=1}^{n} \left( y_i - \beta_0 - \sum_{j=1}^{p} \beta_j x_{ij} \right)^2 + \lambda \sum_{j=1}^{p} |\beta_j|
\]</span></p>
<h4 id="binary-logistic-regression">binary logistic regression</h4>
<p><span class="math display">\[
\text{Minimize: } - \frac{1}{n} \sum_{i=1}^{n} \left[ y_i \log(\hat{p}_i) + (1 - y_i) \log(1 - \hat{p}_i) \right] + \lambda \sum_{j=1}^{p} |\beta_j|
\]</span></p>
</section>
<section id="lasso-regression-1" class="slide level2 smaller">
<h2>LASSO Regression</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="img/lasso.png"></p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-29-1.png" width="960"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-29-2.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="validation-approach-k-fold-cv" class="slide level2 smaller">
<h2>Validation Approach: K-fold CV</h2>
<ul>
<li><p>train-test strategy แบบดั้งเดิมไม่เพียงพอที่จะทำให้กระบวนการปรับแต่ง hyperparameters ดำเนินไปได้อย่างมีประสิทธิภาพและมีความน่าเชื่อถือ</p></li>
<li><p>Cross-validation techniques (CV) จึงถูกนำมาใช้ภายใต้กระบวนการ train model (คนละส่วนกับ test model) เพื่อปรับแต่งโมเดลและประเมินประสิทธิภาพของโมเดลที่ผ่านการปรับแต่ง</p></li>
<li><p>เทคนิค CV จะมีการแบ่งส่วน training data ออกเป็นอีกสองส่วนย่อย ได้แก่</p>
<ul>
<li><p>ชุด training folds ที่ใช้สำหรับ train โมเดล</p></li>
<li><p>ชุด validation folds (หรือเรียกว่า holdout set) อย่างไรก็ตามการใช้ validation set เพียงชุดเดียวมีโอกาสสูงที่ผลการประเมินจะขาดความเสถียร มีอคติ ไม่น่าเชื่อถือ</p></li>
</ul></li>
</ul>

<img data-src="img/kfold.png" class="r-stretch"></section>
<section id="validation-approach-k-fold-cv-1" class="slide level2 smaller">
<h2>Validation Approach: K-fold CV</h2>

<img data-src="img/cv.png" class="r-stretch"></section>
<section id="validation-approach-k-fold-cv-2" class="slide level2 smaller">
<h2>Validation Approach: K-fold CV</h2>
<p>ค่า k ใหญ่ขึ้น:</p>
<ul>
<li><p>ความแตกต่างระหว่างประสิทธิภาพที่ประเมินได้และประสิทธิภาพจริงจะลดลง</p></li>
<li><p>เพิ่มทรัพยากรที่ต้องใช้ในการประมวลผล</p></li>
</ul>
<p>ค่า k = 10 :</p>
<ul>
<li><p>มีผลลัพธ์คล้ายกับ Leave-One-Out Cross Validation (LOOCV) ซึ่งเป็นกรณีที่ k = n (Molinaro et al.&nbsp;,2005)</p></li>
<li><p>การทำ k-Fold CV ซ้ำ (repeated k-Fold CV) สามารถเพิ่มความแม่นยำของการประเมินผล เช่น ใช้ 10-Fold CV ทำซ้ำ 5-10 ครั้งเพื่อเพิ่มความน่าเชื่อถือ</p></li>
</ul>
</section>
<section id="model-workflow-in-tidymodels" class="slide level2">
<h2>Model Workflow in Tidymodels</h2>
<ul>
<li><p>ป้องกันความผิดพลาดเชิงกระบวนการ เพราะเป็นการ wrapping ทั้งส่วน data preprocessing และ model fitting ใน training data ไว้ใน workflow เดียวกัน ลดความเสี่ยงการเกิด data leakage โดยไม่ได้ตั้งใจ</p></li>
<li><p>Modularity มีส่วนประกอบสองส่วนหลัก ได้แก่ preprocessing (recipe) และ model ซึ่งทำให้การปรับเปลี่ยนรายละเอียดในกระบวนการทำได้ง่าย</p></li>
<li><p>ช่วยให้ syntax สามารถ reproducible ได้ง่าย</p></li>
<li><p>สนับสนุนทั้งด้านการวิเคราะห์/ปรับแต่งและประเมินผลโมเดล (CV, resampling, tuning) การนำโมเดลไปใช้ในอนาคต และการบำรุงรักษาโมเดล</p></li>
</ul>

<img data-src="https://www.tmwr.org/premade/proper-workflow.svg" class="r-stretch"></section>
<section id="syntax" class="slide level2 smaller">
<h2>Syntax</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href=""></a><span class="co"># สร้าง model specification</span></span>
<span id="cb32-2"><a href=""></a>logit_mod <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(</span>
<span id="cb32-3"><a href=""></a>  <span class="at">penalty =</span> <span class="fu">tune</span>(),   </span>
<span id="cb32-4"><a href=""></a>  <span class="at">mixture =</span> <span class="dv">1</span>       </span>
<span id="cb32-5"><a href=""></a>) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href=""></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-7"><a href=""></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb32-8"><a href=""></a></span>
<span id="cb32-9"><a href=""></a><span class="co"># สร้าง workflow!!!</span></span>
<span id="cb32-10"><a href=""></a>logit_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href=""></a>  <span class="fu">add_formula</span>(result <span class="sc">~</span>.) <span class="sc">%&gt;%</span></span>
<span id="cb32-12"><a href=""></a>  <span class="do">## workflow นี้ยังขาดการระบุ recipe ที่เป็นส่วน data preprocessing</span></span>
<span id="cb32-13"><a href=""></a>  <span class="fu">add_model</span>(logit_mod)</span>
<span id="cb32-14"><a href=""></a></span>
<span id="cb32-15"><a href=""></a>logit_wf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Formula
Model: logistic_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
result ~ .

── Model ───────────────────────────────────────────────────────────────────────
Logistic Regression Model Specification (classification)

Main Arguments:
  penalty = tune()
  mixture = 1

Computational engine: glmnet </code></pre>
</div>
</div>
</section>
<section id="syntax-1" class="slide level2 smaller">
<h2>Syntax</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href=""></a><span class="co"># สร้าง resamples สำหรับ Cross-Validation</span></span>
<span id="cb34-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb34-3"><a href=""></a>cv_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_strat, <span class="at">v =</span> <span class="dv">10</span>, <span class="at">repeats =</span> <span class="dv">3</span>)</span>
<span id="cb34-4"><a href=""></a></span>
<span id="cb34-5"><a href=""></a><span class="co"># สร้าง grid สำหรับ lambda</span></span>
<span id="cb34-6"><a href=""></a>lambda_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb34-7"><a href=""></a>  <span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">1</span>)),  <span class="co"># lambda ตั้งแต่ 10^-3 ถึง 10^1</span></span>
<span id="cb34-8"><a href=""></a>  <span class="at">levels =</span> <span class="dv">30</span></span>
<span id="cb34-9"><a href=""></a>)</span>
<span id="cb34-10"><a href=""></a></span>
<span id="cb34-11"><a href=""></a><span class="co"># ใช้ tune_grid() เพื่อปรับ lambda</span></span>
<span id="cb34-12"><a href=""></a>tune_results <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb34-13"><a href=""></a>  logit_wf,</span>
<span id="cb34-14"><a href=""></a>  <span class="at">resamples =</span> cv_folds,</span>
<span id="cb34-15"><a href=""></a>  <span class="at">grid =</span> lambda_grid,</span>
<span id="cb34-16"><a href=""></a>  <span class="at">metrics =</span> <span class="fu">metric_set</span>(roc_auc, accuracy, sens, spec, precision)</span>
<span id="cb34-17"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cross-validation-results" class="slide level2 smaller">
<h2>Cross-validation results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href=""></a><span class="fu">autoplot</span>(tune_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-32-1.png" width="960" class="r-stretch"></section>
<section id="cross-validation-results-1" class="slide level2 smaller">
<h2>Cross-validation results</h2>
<p><code>collect_metrics()</code> เป็นฟังก์ชันที่ช่วยให้ผู้วิเคราะห์เข้าถึงผลที่ได้จากการทดลอง fit model ในเงื่อนไขต่าง ๆ พร้อมค่าบ่งชี้ประสิทธิภาพ</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href=""></a>tune_results <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 7
   penalty .metric   .estimator  mean     n std_err .config              
     &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
 1 0.001   accuracy  binary     0.914    30 0.00855 Preprocessor1_Model01
 2 0.001   precision binary     0.936    30 0.0130  Preprocessor1_Model01
 3 0.001   roc_auc   binary     0.975    30 0.00380 Preprocessor1_Model01
 4 0.001   sens      binary     0.937    30 0.0102  Preprocessor1_Model01
 5 0.001   spec      binary     0.885    30 0.0194  Preprocessor1_Model01
 6 0.00137 accuracy  binary     0.911    30 0.00846 Preprocessor1_Model02
 7 0.00137 precision binary     0.934    30 0.0124  Preprocessor1_Model02
 8 0.00137 roc_auc   binary     0.975    30 0.00377 Preprocessor1_Model02
 9 0.00137 sens      binary     0.933    30 0.0110  Preprocessor1_Model02
10 0.00137 spec      binary     0.880    30 0.0195  Preprocessor1_Model02
# ℹ 140 more rows</code></pre>
</div>
</div>
</section>
<section id="finalized-workflows" class="slide level2 smaller">
<h2>Finalized Workflows</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href=""></a><span class="do">## select best</span></span>
<span id="cb38-2"><a href=""></a>best_params <span class="ot">&lt;-</span> tune_results <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href=""></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">"roc_auc"</span>)</span>
<span id="cb38-4"><a href=""></a></span>
<span id="cb38-5"><a href=""></a><span class="do">## finalizing</span></span>
<span id="cb38-6"><a href=""></a>final_wf <span class="ot">&lt;-</span> logit_wf <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href=""></a>  <span class="fu">finalize_workflow</span>(best_params)</span>
<span id="cb38-8"><a href=""></a></span>
<span id="cb38-9"><a href=""></a><span class="do">## last fit</span></span>
<span id="cb38-10"><a href=""></a>lasso_final <span class="ot">&lt;-</span> final_wf <span class="sc">%&gt;%</span></span>
<span id="cb38-11"><a href=""></a>  <span class="fu">fit</span>(<span class="at">data =</span> train_strat)</span>
<span id="cb38-12"><a href=""></a></span>
<span id="cb38-13"><a href=""></a>lasso_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Formula
Model: logistic_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
result ~ .

── Model ───────────────────────────────────────────────────────────────────────

Call:  glmnet::glmnet(x = maybe_matrix(x), y = y, family = "binomial",      alpha = ~1) 

    Df  %Dev  Lambda
1    0  0.00 0.34150
2    1  7.00 0.31120
3    1 12.82 0.28350
4    1 17.80 0.25830
5    1 22.13 0.23540
6    1 25.99 0.21450
7    1 29.45 0.19540
8    1 32.61 0.17810
9    1 35.51 0.16220
10   2 38.19 0.14780
11   2 40.78 0.13470
12   2 43.15 0.12270
13   2 45.33 0.11180
14   2 47.35 0.10190
15   2 49.22 0.09284
16   2 50.95 0.08459
17   2 52.56 0.07708
18   2 54.05 0.07023
19   2 55.43 0.06399
20   2 56.71 0.05830
21   2 57.90 0.05313
22   4 59.24 0.04841
23   4 60.75 0.04411
24   5 62.14 0.04019
25   6 63.46 0.03662
26   6 64.67 0.03336
27   6 65.78 0.03040
28   7 66.87 0.02770
29   9 68.08 0.02524
30  10 69.24 0.02300
31  10 70.33 0.02095
32  12 71.48 0.01909
33  14 72.62 0.01740
34  14 73.82 0.01585
35  16 74.96 0.01444
36  17 76.04 0.01316
37  18 77.06 0.01199
38  21 78.05 0.01093
39  21 79.00 0.00996
40  22 79.89 0.00907
41  24 80.76 0.00826
42  24 81.58 0.00753
43  25 82.33 0.00686
44  26 83.03 0.00625
45  28 83.71 0.00570
46  29 84.36 0.00519

...
and 54 more lines.</code></pre>
</div>
</div>
</section>
<section id="finalized-workflows-last_fit" class="slide level2 smaller">
<h2>Finalized Workflows: <code>last_fit</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href=""></a>lasso_final <span class="ot">&lt;-</span> final_wf <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href=""></a>  <span class="fu">last_fit</span>(strat_split,</span>
<span id="cb40-3"><a href=""></a>           <span class="at">metrics =</span> <span class="fu">metric_set</span>(accuracy, roc_auc, </span>
<span id="cb40-4"><a href=""></a>                                sens, spec, precision)) </span>
<span id="cb40-5"><a href=""></a><span class="do">## performance metrics บน test data</span></span>
<span id="cb40-6"><a href=""></a>lasso_final <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  .metric   .estimator .estimate .config             
  &lt;chr&gt;     &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 accuracy  binary         0.933 Preprocessor1_Model1
2 sens      binary         0.938 Preprocessor1_Model1
3 spec      binary         0.923 Preprocessor1_Model1
4 precision binary         0.962 Preprocessor1_Model1
5 roc_auc   binary         0.979 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
<section id="extract_fit_engine" class="slide level2 smaller">
<h2><code>Extract_fit_engine()</code></h2>
<p>เราอาจเรียกดูผลลัพธ์ของโมเดลสุดท้าย ที่ได้จาก <code>last_fit()</code> ได้โดยใช้ <code>extract_fit_engine()</code> ซึ่งจะให้โมเดลที่ถูก fit ด้วยข้อมูล training set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href=""></a>best_lambda <span class="ot">&lt;-</span> best_params<span class="sc">$</span>penalty</span>
<span id="cb42-2"><a href=""></a>extract_lasso <span class="ot">&lt;-</span> lasso_final <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href=""></a>  <span class="fu">extract_fit_engine</span>()</span>
<span id="cb42-4"><a href=""></a></span>
<span id="cb42-5"><a href=""></a>coefs_mat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">coef</span>(extract_lasso, <span class="at">s =</span> best_lambda))  <span class="co"># s = lambda ที่อยากได้</span></span>
<span id="cb42-6"><a href=""></a></span>
<span id="cb42-7"><a href=""></a>coefs_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-8"><a href=""></a>  <span class="at">term =</span> <span class="fu">rownames</span>(coefs_mat),</span>
<span id="cb42-9"><a href=""></a>  <span class="at">estimate =</span> <span class="fu">as.numeric</span>(coefs_mat)</span>
<span id="cb42-10"><a href=""></a>) <span class="sc">%&gt;%</span></span>
<span id="cb42-11"><a href=""></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>, estimate <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb42-12"><a href=""></a></span>
<span id="cb42-13"><a href=""></a>relative_importance_plot <span class="ot">&lt;-</span> coefs_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb42-14"><a href=""></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate, <span class="at">y =</span> <span class="fu">reorder</span>(term, <span class="fu">abs</span>(estimate))))<span class="sc">+</span></span>
<span id="cb42-15"><a href=""></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> estimate <span class="sc">&gt;</span> <span class="dv">0</span> ))<span class="sc">+</span></span>
<span id="cb42-16"><a href=""></a>  <span class="fu">theme_light</span>()<span class="sc">+</span></span>
<span id="cb42-17"><a href=""></a>  <span class="fu">ylab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb42-18"><a href=""></a>  <span class="fu">xlab</span>(<span class="st">"</span><span class="sc">\n</span><span class="st"> estimated coefficients (LASSO)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="relative_importance_plot" class="slide level2 smaller">
<h2>relative_importance_plot</h2>


<img data-src="wk02_modelling_proc_files/figure-revealjs/unnamed-chunk-37-1.png" width="960" class="r-stretch"></section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="https://github.com/ssiwacho/picture/blob/main/datakruroo.png?raw=true" class="slide-logo"></p>
<div class="footer footer-default">
<p>week 2: 2758623 Machine Learning Principles and Application<br> ผศ.ดร.สิวะโชติ ศรีสุทธิยากร</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="wk02_modelling_proc_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="wk02_modelling_proc_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'fade',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>